{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-26T17:30:29.350Z","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-26T17:30:29.401Z","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3"}
{"type":"file-history-snapshot","messageId":"1770ce46-92ab-4440-93fb-b245925f4d39","snapshot":{"messageId":"1770ce46-92ab-4440-93fb-b245925f4d39","trackedFileBackups":{},"timestamp":"2026-02-26T17:30:29.531Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file Untitled-2 in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"out of the serach endpoint describe in this json file, which data are we using in the spec?\n\n/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json"}]},"uuid":"1770ce46-92ab-4440-93fb-b245925f4d39","timestamp":"2026-02-26T17:30:29.523Z","permissionMode":"default"}
{"parentUuid":"1770ce46-92ab-4440-93fb-b245925f4d39","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","message":{"model":"claude-sonnet-4-6","id":"msg_012Pgp3idvXL4F4sfS16LgkC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to know which data from the search endpoint (described in the JSON file) is being used in the spec. Let me read the JSON file and also look at the spec files in the project.","signature":"EuUCCkYICxgCKkAQY1KHbjSsh1Az7NNwLmIrRKyslRORi09cf5oxHXmgddnvr7OrlNuJ1nqm5mBzDsvbk6lyF+GmRENoO7lSn9lMEgzS6BT2uyxR9oPBPmsaDL7aPisbjNHlsgw59iIw/cu8fuAhgp/JXU+XNEdFnySRwqnJVL3OtKyZi45BR24fhTsBkZ6+cEr0FHmx5vo6KswBBTJDEPXRQa3NvrR87bJidtdxvUC5sHnHUSste7BEaxiNEGHC945v/mCZfRNMcB1Nz/hitiJ55OGa3D9Eo+3L6C2ljRwHdYftvzZ90XlLBOLTVg42KbK7aHlRaePKyk2MeyKQ6gPmgntxqg9gyEoNEqUKC5u2QpDs2y2qEig7LxGE6wZSQbONKHWDH8YAqa4bI8yazIficVaH8HtQRHm/+hMTzLgPn1iTSlHKhcxKA69TZ/28+PQOpJ3gEy1r5I1R3dm/JQ57hBbVgXSqGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2349,"cache_read_input_tokens":18822,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2349},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5TewAnsRQCYJuYezZc","type":"assistant","uuid":"d8da6968-e627-4d3b-b3d4-16e51f90de79","timestamp":"2026-02-26T17:30:32.716Z"}
{"parentUuid":"d8da6968-e627-4d3b-b3d4-16e51f90de79","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","message":{"model":"claude-sonnet-4-6","id":"msg_012Pgp3idvXL4F4sfS16LgkC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011xvcps7ePWMz4URxccfTeP","name":"Read","input":{"file_path":"/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2349,"cache_read_input_tokens":18822,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2349},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5TewAnsRQCYJuYezZc","type":"assistant","uuid":"e7ac6e92-b5cd-4186-a8d8-de825a2cbcfa","timestamp":"2026-02-26T17:30:33.216Z"}
{"parentUuid":"e7ac6e92-b5cd-4186-a8d8-de825a2cbcfa","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (536.2KB) exceeds maximum allowed size (256KB). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_011xvcps7ePWMz4URxccfTeP"}]},"uuid":"65f9dd01-9d30-427f-831b-627cd4836dca","timestamp":"2026-02-26T17:30:33.398Z","toolUseResult":"Error: File content (536.2KB) exceeds maximum allowed size (256KB). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","sourceToolAssistantUUID":"e7ac6e92-b5cd-4186-a8d8-de825a2cbcfa"}
{"parentUuid":"65f9dd01-9d30-427f-831b-627cd4836dca","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_012Pgp3idvXL4F4sfS16LgkC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VwFz3w6xVJYGYsvXsyDMG2","name":"Read","input":{"file_path":"/Users/agurodriguez/.claude/projects/-Users-agurodriguez-Code-torre-ca/memory/MEMORY.md"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2349,"cache_read_input_tokens":18822,"output_tokens":193,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2349,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5TewAnsRQCYJuYezZc","type":"assistant","uuid":"b4583aac-ba81-4f51-9b71-f36069cb083f","timestamp":"2026-02-26T17:30:33.983Z"}
{"parentUuid":"b4583aac-ba81-4f51-9b71-f36069cb083f","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01VwFz3w6xVJYGYsvXsyDMG2"}]},"uuid":"2a543430-f069-4118-aa8f-e3087285883f","timestamp":"2026-02-26T17:30:33.983Z","toolUseResult":"Sibling tool call errored","sourceToolAssistantUUID":"b4583aac-ba81-4f51-9b71-f36069cb083f"}
{"parentUuid":"2a543430-f069-4118-aa8f-e3087285883f","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01DyjxjWzg646GVXxqsx211R","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","name":"Read","input":{"file_path":"/Users/agurodriguez/.claude/projects/-Users-agurodriguez-Code-torre-ca/memory/MEMORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":316,"cache_read_input_tokens":21171,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":316},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5TwgUrgoNfEBcHdZq9","type":"assistant","uuid":"fe182edb-df8c-4abe-b48d-c4ebc824d19e","timestamp":"2026-02-26T17:30:35.993Z"}
{"parentUuid":"fe182edb-df8c-4abe-b48d-c4ebc824d19e","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","type":"tool_result","content":"     1â†’# Torre Tinder-like App - Project Memory\n     2â†’\n     3â†’## Project Overview\n     4â†’Building a Tinder-like job swiping experience using Torre.ai's public API.\n     5â†’Working dir: `/Users/agurodriguez/Code/torre-ca`\n     6â†’\n     7â†’## Torre API\n     8â†’- Base URL: `https://search.torre.co`\n     9â†’- Opportunities endpoint: `POST /opportunities/_search`\n    10â†’- Query params: `currency`, `periodicity`, `lang`, `size`, `contextFeature`\n    11â†’- Body: `{ \"and\": [ { \"keywords\": ... }, { \"status\": { \"code\": \"open\" } } ] }`\n    12â†’- See `swagger.json` for full spec, `opportunities-search-response.json` for sample\n    13â†’\n    14â†’## Job Card Data Available\n    15â†’- `objective` (title), `organizations[0].name/picture` (company logo)\n    16â†’- `locations[]`, `remote` (bool), `commitment` (full-time/part-time)\n    17â†’- `compensation.data.minAmount/maxAmount/currency/periodicity`\n    18â†’- `skills[]` with name/proficiency\n    19â†’- `tagline` (short description), `type`, `externalApplicationUrl`\n    20â†’\n    21â†’## Tech Stack (decided)\n    22â†’- See torre-app.md for details\n    23â†’\n    24â†’## Key UX Principles (from research)\n    25â†’- Show 3 cards stacked (scale each ~3% smaller + 8-10px offset)\n    26â†’- Overlay labels: green LIKE (right), red NOPE (left), blue SUPER (up)\n    27â†’- Spring physics animations, not linear easing\n    28â†’- Always provide X/Heart button controls (not gesture-only)\n    29â†’- Undo button (at least once)\n    30â†’- Daily limit or scarcity mechanic for \"super likes\"\n    31â†’- Minimum card info: company logo, title, salary, location, 2-3 skill tags\n    32â†’- Match celebration screen on super like or mutual interest\n    33â†’\n    34â†’## Files\n    35â†’- `swagger.json` - Torre API OpenAPI spec\n    36â†’- `opportunities-search-response.json` - Sample API response\n    37â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"963fbe66-41e6-4706-bc07-f10fdc125985","timestamp":"2026-02-26T17:30:36.011Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/agurodriguez/.claude/projects/-Users-agurodriguez-Code-torre-ca/memory/MEMORY.md","content":"# Torre Tinder-like App - Project Memory\n\n## Project Overview\nBuilding a Tinder-like job swiping experience using Torre.ai's public API.\nWorking dir: `/Users/agurodriguez/Code/torre-ca`\n\n## Torre API\n- Base URL: `https://search.torre.co`\n- Opportunities endpoint: `POST /opportunities/_search`\n- Query params: `currency`, `periodicity`, `lang`, `size`, `contextFeature`\n- Body: `{ \"and\": [ { \"keywords\": ... }, { \"status\": { \"code\": \"open\" } } ] }`\n- See `swagger.json` for full spec, `opportunities-search-response.json` for sample\n\n## Job Card Data Available\n- `objective` (title), `organizations[0].name/picture` (company logo)\n- `locations[]`, `remote` (bool), `commitment` (full-time/part-time)\n- `compensation.data.minAmount/maxAmount/currency/periodicity`\n- `skills[]` with name/proficiency\n- `tagline` (short description), `type`, `externalApplicationUrl`\n\n## Tech Stack (decided)\n- See torre-app.md for details\n\n## Key UX Principles (from research)\n- Show 3 cards stacked (scale each ~3% smaller + 8-10px offset)\n- Overlay labels: green LIKE (right), red NOPE (left), blue SUPER (up)\n- Spring physics animations, not linear easing\n- Always provide X/Heart button controls (not gesture-only)\n- Undo button (at least once)\n- Daily limit or scarcity mechanic for \"super likes\"\n- Minimum card info: company logo, title, salary, location, 2-3 skill tags\n- Match celebration screen on super like or mutual interest\n\n## Files\n- `swagger.json` - Torre API OpenAPI spec\n- `opportunities-search-response.json` - Sample API response\n","numLines":37,"startLine":1,"totalLines":37}},"sourceToolAssistantUUID":"fe182edb-df8c-4abe-b48d-c4ebc824d19e"}
{"parentUuid":"963fbe66-41e6-4706-bc07-f10fdc125985","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01DyjxjWzg646GVXxqsx211R","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015t9P83m4stqD91MargGDyq","name":"Read","input":{"file_path":"/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json","limit":100},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":316,"cache_read_input_tokens":21171,"output_tokens":153,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":316,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5TwgUrgoNfEBcHdZq9","type":"assistant","uuid":"4da0bff0-8082-4429-a8bd-d671a0a1c8dc","timestamp":"2026-02-26T17:30:36.114Z"}
{"parentUuid":"4da0bff0-8082-4429-a8bd-d671a0a1c8dc","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015t9P83m4stqD91MargGDyq","type":"tool_result","content":"     1â†’{\n     2â†’    \"total\": 42,\n     3â†’    \"size\": 10,\n     4â†’    \"results\": [\n     5â†’        {\n     6â†’            \"id\": \"QwejvMMd\",\n     7â†’            \"objective\": \"Staff Product Designer, Platform/Design Systems\",\n     8â†’            \"slug\": \"floqast-staff-product-designer-platformdesign-systems\",\n     9â†’            \"tagline\": \"You'll architect AI-driven experiences & lead design system innovation.\",\n    10â†’            \"theme\": \"default\",\n    11â†’            \"type\": \"full-time-employment\",\n    12â†’            \"opportunity\": \"employee\",\n    13â†’            \"organizations\": [\n    14â†’                {\n    15â†’                    \"id\": 745456,\n    16â†’                    \"hashedId\": \"0Za46R4q\",\n    17â†’                    \"name\": \"FloQast\",\n    18â†’                    \"status\": \"approved\",\n    19â†’                    \"size\": 839,\n    20â†’                    \"publicId\": \"FloQast\",\n    21â†’                    \"picture\": \"https://res.cloudinary.com/torre-technologies-co/image/upload/v1769419214/origin/bio/crawled-organizations/floqast_logo_skfwft.jpg\",\n    22â†’                    \"theme\": \"default\"\n    23â†’                }\n    24â†’            ],\n    25â†’            \"locations\": [\n    26â†’                \"United States\"\n    27â†’            ],\n    28â†’            \"timezones\": null,\n    29â†’            \"remote\": true,\n    30â†’            \"external\": true,\n    31â†’            \"deadline\": null,\n    32â†’            \"created\": \"2025-11-16T02:19:18.000Z\",\n    33â†’            \"status\": \"open\",\n    34â†’            \"commitment\": \"full-time\",\n    35â†’            \"externalApplicationUrl\": \"https://jobs.lever.co/floqast/bcc57f28-6f6f-407f-9248-84b78ed15dbc\",\n    36â†’            \"compensation\": {\n    37â†’                \"data\": {\n    38â†’                    \"code\": \"range\",\n    39â†’                    \"currency\": \"USD\",\n    40â†’                    \"minAmount\": 164000.0,\n    41â†’                    \"minHourlyUSD\": 85.41666666666667,\n    42â†’                    \"maxAmount\": 246000.0,\n    43â†’                    \"maxHourlyUSD\": 128.125,\n    44â†’                    \"periodicity\": \"yearly\",\n    45â†’                    \"negotiable\": false,\n    46â†’                    \"conversionRateUSD\": 1.0\n    47â†’                },\n    48â†’                \"visible\": true,\n    49â†’                \"additionalCompensationDetails\": {}\n    50â†’            },\n    51â†’            \"skills\": [\n    52â†’                {\n    53â†’                    \"name\": \"CSS\",\n    54â†’                    \"experience\": \"potential-to-develop\",\n    55â†’                    \"proficiency\": \"proficient\"\n    56â†’                },\n    57â†’                {\n    58â†’                    \"name\": \"Figma\",\n    59â†’                    \"experience\": \"potential-to-develop\",\n    60â†’                    \"proficiency\": \"expert\"\n    61â†’                },\n    62â†’                {\n    63â†’                    \"name\": \"Git\",\n    64â†’                    \"experience\": \"potential-to-develop\",\n    65â†’                    \"proficiency\": \"proficient\"\n    66â†’                },\n    67â†’                {\n    68â†’                    \"name\": \"GitHub\",\n    69â†’                    \"experience\": \"potential-to-develop\",\n    70â†’                    \"proficiency\": \"proficient\"\n    71â†’                },\n    72â†’                {\n    73â†’                    \"name\": \"HTML\",\n    74â†’                    \"experience\": \"potential-to-develop\",\n    75â†’                    \"proficiency\": \"proficient\"\n    76â†’                },\n    77â†’                {\n    78â†’                    \"name\": \"Package manager\",\n    79â†’                    \"experience\": \"potential-to-develop\",\n    80â†’                    \"proficiency\": \"proficient\"\n    81â†’                },\n    82â†’                {\n    83â†’                    \"name\": \"React.js\",\n    84â†’                    \"experience\": \"potential-to-develop\",\n    85â†’                    \"proficiency\": \"proficient\"\n    86â†’                },\n    87â†’                {\n    88â†’                    \"name\": \"Storybook\",\n    89â†’                    \"experience\": \"potential-to-develop\",\n    90â†’                    \"proficiency\": \"proficient\"\n    91â†’                },\n    92â†’                {\n    93â†’                    \"name\": \"Version control\",\n    94â†’                    \"experience\": \"potential-to-develop\",\n    95â†’                    \"proficiency\": \"proficient\"\n    96â†’                }\n    97â†’            ],\n    98â†’            \"members\": [],\n    99â†’            \"place\": {\n   100â†’                \"remote\": true,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2dc39a21-8375-4501-8698-57d12f1d9914","timestamp":"2026-02-26T17:30:36.124Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json","content":"{\n    \"total\": 42,\n    \"size\": 10,\n    \"results\": [\n        {\n            \"id\": \"QwejvMMd\",\n            \"objective\": \"Staff Product Designer, Platform/Design Systems\",\n            \"slug\": \"floqast-staff-product-designer-platformdesign-systems\",\n            \"tagline\": \"You'll architect AI-driven experiences & lead design system innovation.\",\n            \"theme\": \"default\",\n            \"type\": \"full-time-employment\",\n            \"opportunity\": \"employee\",\n            \"organizations\": [\n                {\n                    \"id\": 745456,\n                    \"hashedId\": \"0Za46R4q\",\n                    \"name\": \"FloQast\",\n                    \"status\": \"approved\",\n                    \"size\": 839,\n                    \"publicId\": \"FloQast\",\n                    \"picture\": \"https://res.cloudinary.com/torre-technologies-co/image/upload/v1769419214/origin/bio/crawled-organizations/floqast_logo_skfwft.jpg\",\n                    \"theme\": \"default\"\n                }\n            ],\n            \"locations\": [\n                \"United States\"\n            ],\n            \"timezones\": null,\n            \"remote\": true,\n            \"external\": true,\n            \"deadline\": null,\n            \"created\": \"2025-11-16T02:19:18.000Z\",\n            \"status\": \"open\",\n            \"commitment\": \"full-time\",\n            \"externalApplicationUrl\": \"https://jobs.lever.co/floqast/bcc57f28-6f6f-407f-9248-84b78ed15dbc\",\n            \"compensation\": {\n                \"data\": {\n                    \"code\": \"range\",\n                    \"currency\": \"USD\",\n                    \"minAmount\": 164000.0,\n                    \"minHourlyUSD\": 85.41666666666667,\n                    \"maxAmount\": 246000.0,\n                    \"maxHourlyUSD\": 128.125,\n                    \"periodicity\": \"yearly\",\n                    \"negotiable\": false,\n                    \"conversionRateUSD\": 1.0\n                },\n                \"visible\": true,\n                \"additionalCompensationDetails\": {}\n            },\n            \"skills\": [\n                {\n                    \"name\": \"CSS\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"Figma\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"expert\"\n                },\n                {\n                    \"name\": \"Git\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"GitHub\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"HTML\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"Package manager\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"React.js\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"Storybook\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                },\n                {\n                    \"name\": \"Version control\",\n                    \"experience\": \"potential-to-develop\",\n                    \"proficiency\": \"proficient\"\n                }\n            ],\n            \"members\": [],\n            \"place\": {\n                \"remote\": true,","numLines":100,"startLine":1,"totalLines":9000}},"sourceToolAssistantUUID":"4da0bff0-8082-4429-a8bd-d671a0a1c8dc"}
{"parentUuid":"2dc39a21-8375-4501-8698-57d12f1d9914","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01Ui441tJFERmDCJFFNFgvc2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me look at the spec files to understand what data is being used. Let me search for the spec files in the project.","signature":"EqICCkYICxgCKkBOKkpR6wrh1PQjL6WWlS8TLA7FOcvvqTgi5DYNXfxZqr4/Up0KUPLy2aH/E8VsvQeDbYyx/L6t8c1S4q5qa7/lEgxjYBe1K9bycLs0aQEaDA2iWomgoQpZv3rooSIw3Jfp8gw6qNqgQGdOY7doL3WdU8hb9jdoqzK0Muaj6feB0EJXG3DXGz0j+739L5G+KokBwpzRyVGELNcF5zILuJy/uxYehYvuddMM2C/jrHcliQmw/d1VRFr80y03fbE/ZtNG/nnTqUf4Axm4n85c+rRK2s6gFKuDdTg/Vq3v0LkbGSpxBGbngEZSzWcDM5Ch8+SM/GZ27AaJWDF4yDdU5F0q35MWh5f8OkSAWJHWTwSwTyl4F9juOVAAmY0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2181,"cache_read_input_tokens":21487,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2181},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5U6uN5KqVkkT6nbMEb","type":"assistant","uuid":"5a01de51-fc37-40bb-9840-7f972ea9e81e","timestamp":"2026-02-26T17:30:38.612Z"}
{"parentUuid":"5a01de51-fc37-40bb-9840-7f972ea9e81e","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01Ui441tJFERmDCJFFNFgvc2","type":"message","role":"assistant","content":[{"type":"text","text":"Let me look at the spec file and see a bit more of the JSON structure."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2181,"cache_read_input_tokens":21487,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2181},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5U6uN5KqVkkT6nbMEb","type":"assistant","uuid":"e2c0fa62-5027-48e1-9039-50f837e3ab32","timestamp":"2026-02-26T17:30:39.373Z"}
{"parentUuid":"e2c0fa62-5027-48e1-9039-50f837e3ab32","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01Ui441tJFERmDCJFFNFgvc2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Wf4RbgrdvbrZ39kBQ4CkwE","name":"Glob","input":{"pattern":"**/*.md","path":"/Users/agurodriguez/Code/torre-ca"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2181,"cache_read_input_tokens":21487,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2181},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5U6uN5KqVkkT6nbMEb","type":"assistant","uuid":"e2a009aa-e615-4c98-844b-860bd5798423","timestamp":"2026-02-26T17:30:40.157Z"}
{"parentUuid":"e2a009aa-e615-4c98-844b-860bd5798423","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01Ui441tJFERmDCJFFNFgvc2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015vudtXfZkVa3metzSVtQAC","name":"Read","input":{"file_path":"/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json","offset":100,"limit":100},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2181,"cache_read_input_tokens":21487,"output_tokens":231,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2181,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5U6uN5KqVkkT6nbMEb","type":"assistant","uuid":"280f767d-6180-4380-a8b9-169fa797e3c6","timestamp":"2026-02-26T17:30:40.951Z"}
{"parentUuid":"280f767d-6180-4380-a8b9-169fa797e3c6","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015vudtXfZkVa3metzSVtQAC","type":"tool_result","content":"   100â†’                \"remote\": true,\n   101â†’                \"anywhere\": false,\n   102â†’                \"timezone\": false,\n   103â†’                \"locationType\": \"remote_countries\",\n   104â†’                \"location\": [\n   105â†’                    {\n   106â†’                        \"id\": \"United States\",\n   107â†’                        \"timezone\": -6.0,\n   108â†’                        \"countryCode\": null,\n   109â†’                        \"latitude\": 37.09024,\n   110â†’                        \"longitude\": -95.712891\n   111â†’                    }\n   112â†’                ]\n   113â†’            },\n   114â†’            \"questions\": [],\n   115â†’            \"context\": {\n   116â†’                \"signaled\": [],\n   117â†’                \"applicationStatus\": null\n   118â†’            },\n   119â†’            \"additionalCompensation\": [],\n   120â†’            \"additionalCompensationDetails\": {},\n   121â†’            \"_meta\": {\n   122â†’                \"rank\": {\n   123â†’                    \"position\": 1,\n   124â†’                    \"value\": 0.8000000000000002,\n   125â†’                    \"boostedValue\": 0.9766089965397925\n   126â†’                },\n   127â†’                \"scorer\": {\n   128â†’                    \"@type\": \"and\",\n   129â†’                    \"score\": 0.9882352941176471,\n   130â†’                    \"min\": 0.9882352941176471,\n   131â†’                    \"max\": 1.0,\n   132â†’                    \"uncertain\": true,\n   133â†’                    \"rank\": 17.0,\n   134â†’                    \"and\": [\n   135â†’                        {\n   136â†’                            \"@type\": \"and\",\n   137â†’                            \"score\": 1.0,\n   138â†’                            \"min\": 1.0,\n   139â†’                            \"max\": 1.0,\n   140â†’                            \"uncertain\": true,\n   141â†’                            \"rank\": 11.0,\n   142â†’                            \"and\": [\n   143â†’                                {\n   144â†’                                    \"@type\": \"or\",\n   145â†’                                    \"score\": 1.0,\n   146â†’                                    \"min\": 1.0,\n   147â†’                                    \"max\": 1.0,\n   148â†’                                    \"uncertain\": true,\n   149â†’                                    \"rank\": 13.0,\n   150â†’                                    \"or\": [\n   151â†’                                        {\n   152â†’                                            \"@type\": \"concrete\",\n   153â†’                                            \"id\": \"proficiency\",\n   154â†’                                            \"input\": {\n   155â†’                                                \"criteria\": {\n   156â†’                                                    \"skills\": [\n   157â†’                                                        {\n   158â†’                                                            \"name\": \"Design systems\",\n   159â†’                                                            \"skillRef\": null\n   160â†’                                                        }\n   161â†’                                                    ],\n   162â†’                                                    \"proficiencies\": {\n   163â†’                                                        \"Design systems\": \"expert\"\n   164â†’                                                    },\n   165â†’                                                    \"experiences\": [],\n   166â†’                                                    \"queryContext\": \"search\",\n   167â†’                                                    \"skillsForMatching\": null\n   168â†’                                                },\n   169â†’                                                \"opportunity\": {\n   170â†’                                                    \"skills\": [\n   171â†’                                                        {\n   172â†’                                                            \"name\": \"Figma\"\n   173â†’                                                        },\n   174â†’                                                        {\n   175â†’                                                            \"name\": \"CSS\"\n   176â†’                                                        },\n   177â†’                                                        {\n   178â†’                                                            \"name\": \"Git\"\n   179â†’                                                        },\n   180â†’                                                        {\n   181â†’                                                            \"name\": \"GitHub\"\n   182â†’                                                        },\n   183â†’                                                        {\n   184â†’                                                            \"name\": \"HTML\"\n   185â†’                                                        },\n   186â†’                                                        {\n   187â†’                                                            \"name\": \"Package manager\"\n   188â†’                                                        },\n   189â†’                                                        {\n   190â†’                                                            \"name\": \"React.js\"\n   191â†’                                                        },\n   192â†’                                                        {\n   193â†’                                                            \"name\": \"Storybook\"\n   194â†’                                                        },\n   195â†’                                                        {\n   196â†’                                                            \"name\": \"Version control\"\n   197â†’                                                        }\n   198â†’                                                    ],\n   199â†’                                                    \"proficiencies\": {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"aca4e7cb-0a82-4b18-8495-14a782c3fd53","timestamp":"2026-02-26T17:30:41.037Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/agurodriguez/Code/torre-ca/opportunities-search-response.json","content":"                \"remote\": true,\n                \"anywhere\": false,\n                \"timezone\": false,\n                \"locationType\": \"remote_countries\",\n                \"location\": [\n                    {\n                        \"id\": \"United States\",\n                        \"timezone\": -6.0,\n                        \"countryCode\": null,\n                        \"latitude\": 37.09024,\n                        \"longitude\": -95.712891\n                    }\n                ]\n            },\n            \"questions\": [],\n            \"context\": {\n                \"signaled\": [],\n                \"applicationStatus\": null\n            },\n            \"additionalCompensation\": [],\n            \"additionalCompensationDetails\": {},\n            \"_meta\": {\n                \"rank\": {\n                    \"position\": 1,\n                    \"value\": 0.8000000000000002,\n                    \"boostedValue\": 0.9766089965397925\n                },\n                \"scorer\": {\n                    \"@type\": \"and\",\n                    \"score\": 0.9882352941176471,\n                    \"min\": 0.9882352941176471,\n                    \"max\": 1.0,\n                    \"uncertain\": true,\n                    \"rank\": 17.0,\n                    \"and\": [\n                        {\n                            \"@type\": \"and\",\n                            \"score\": 1.0,\n                            \"min\": 1.0,\n                            \"max\": 1.0,\n                            \"uncertain\": true,\n                            \"rank\": 11.0,\n                            \"and\": [\n                                {\n                                    \"@type\": \"or\",\n                                    \"score\": 1.0,\n                                    \"min\": 1.0,\n                                    \"max\": 1.0,\n                                    \"uncertain\": true,\n                                    \"rank\": 13.0,\n                                    \"or\": [\n                                        {\n                                            \"@type\": \"concrete\",\n                                            \"id\": \"proficiency\",\n                                            \"input\": {\n                                                \"criteria\": {\n                                                    \"skills\": [\n                                                        {\n                                                            \"name\": \"Design systems\",\n                                                            \"skillRef\": null\n                                                        }\n                                                    ],\n                                                    \"proficiencies\": {\n                                                        \"Design systems\": \"expert\"\n                                                    },\n                                                    \"experiences\": [],\n                                                    \"queryContext\": \"search\",\n                                                    \"skillsForMatching\": null\n                                                },\n                                                \"opportunity\": {\n                                                    \"skills\": [\n                                                        {\n                                                            \"name\": \"Figma\"\n                                                        },\n                                                        {\n                                                            \"name\": \"CSS\"\n                                                        },\n                                                        {\n                                                            \"name\": \"Git\"\n                                                        },\n                                                        {\n                                                            \"name\": \"GitHub\"\n                                                        },\n                                                        {\n                                                            \"name\": \"HTML\"\n                                                        },\n                                                        {\n                                                            \"name\": \"Package manager\"\n                                                        },\n                                                        {\n                                                            \"name\": \"React.js\"\n                                                        },\n                                                        {\n                                                            \"name\": \"Storybook\"\n                                                        },\n                                                        {\n                                                            \"name\": \"Version control\"\n                                                        }\n                                                    ],\n                                                    \"proficiencies\": {","numLines":100,"startLine":100,"totalLines":9000}},"sourceToolAssistantUUID":"280f767d-6180-4380-a8b9-169fa797e3c6"}
{"parentUuid":"e2a009aa-e615-4c98-844b-860bd5798423","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Wf4RbgrdvbrZ39kBQ4CkwE","type":"tool_result","content":"/Users/agurodriguez/Code/torre-ca/SPEC.md\n/Users/agurodriguez/Code/torre-ca/UI_SPEC.md"}]},"uuid":"325edab2-0adb-4e39-893d-31b070e5303b","timestamp":"2026-02-26T17:30:42.243Z","toolUseResult":{"filenames":["/Users/agurodriguez/Code/torre-ca/SPEC.md","/Users/agurodriguez/Code/torre-ca/UI_SPEC.md"],"durationMs":2081,"numFiles":2,"truncated":false},"sourceToolAssistantUUID":"e2a009aa-e615-4c98-844b-860bd5798423"}
{"parentUuid":"325edab2-0adb-4e39-893d-31b070e5303b","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01VQvJpQgt67raXipwkDKWAB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011XDgt9rByyywWgrBwCG2WN","name":"Read","input":{"file_path":"/Users/agurodriguez/Code/torre-ca/SPEC.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1266,"cache_creation_input_tokens":298,"cache_read_input_tokens":23668,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":298},"output_tokens":21,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5UYtZP31Umy1sXqW7t","type":"assistant","uuid":"de30dbcc-8305-48ed-a2ce-3d66176b6850","timestamp":"2026-02-26T17:30:43.966Z"}
{"parentUuid":"de30dbcc-8305-48ed-a2ce-3d66176b6850","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011XDgt9rByyywWgrBwCG2WN","type":"tool_result","content":"     1â†’# Torre Swipe â€” Product & Technical Specification\n     2â†’\n     3â†’> Hand this document to an LLM and say **\"build this\"** to get a complete, production-ready implementation.\n     4â†’\n     5â†’---\n     6â†’\n     7â†’## Table of Contents\n     8â†’\n     9â†’1. [Product Overview](#1-product-overview)\n    10â†’2. [Core User Flow](#2-core-user-flow)\n    11â†’3. [Home Screen Specification](#3-home-screen-specification)\n    12â†’4. [Background Preloading Strategy](#4-background-preloading-strategy)\n    13â†’5. [Torre API Integration](#5-torre-api-integration)\n    14â†’6. [Monorepo Architecture](#6-monorepo-architecture)\n    15â†’7. [State Management](#7-state-management)\n    16â†’8. [Tech Stack](#8-tech-stack)\n    17â†’9. [Test Requirements](#9-test-requirements)\n    18â†’10. [API Contract (BFF)](#10-api-contract-bff)\n    19â†’11. [Performance Requirements](#11-performance-requirements)\n    20â†’12. [Accessibility](#12-accessibility)\n    21â†’\n    22â†’---\n    23â†’\n    24â†’## 1. Product Overview\n    25â†’\n    26â†’**Torre Swipe** is a mobile-first web application that lets job seekers discover Torre.ai job opportunities through a Tinder-style swipe interface. Users swipe right to like a job, left to pass, and up to super-like. Liked and super-liked jobs open the external application URL in a new tab.\n    27â†’\n    28â†’**Primary user:** A job seeker on a mobile browser who wants a fast, low-friction way to browse and shortlist job opportunities.\n    29â†’\n    30â†’**Why it works:** Traditional job boards require deliberate search queries. Torre Swipe surfaces opportunities serendipitously, making job discovery feel effortless and even fun. The swipe mechanic creates a lightweight commitment signal â€” a flick of the thumb â€” that lowers the psychological cost of engaging with each posting.\n    31â†’\n    32â†’**Non-goals (out of scope):**\n    33â†’- User accounts or authentication\n    34â†’- Persistent match history beyond `localStorage`\n    35â†’- Full application flow within the app (redirects to external URLs)\n    36â†’- Employer-facing features\n    37â†’\n    38â†’---\n    39â†’\n    40â†’## 2. Core User Flow\n    41â†’\n    42â†’```\n    43â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    44â†’â”‚  1. User opens app (mobile browser)                 â”‚\n    45â†’â”‚     â†’ Skeleton loading cards appear instantly       â”‚\n    46â†’â”‚     â†’ First batch of jobs fetched from BFF          â”‚\n    47â†’â”‚                                                     â”‚\n    48â†’â”‚  2. Swipe loop (repeated until empty state)         â”‚\n    49â†’â”‚     a. Top card is the current job                  â”‚\n    50â†’â”‚     b. User swipes or taps a button:                â”‚\n    51â†’â”‚        â€¢ Right / â¤  â†’ LIKE  (opens ext. URL)       â”‚\n    52â†’â”‚        â€¢ Left  / âœ•  â†’ PASS  (discard)              â”‚\n    53â†’â”‚        â€¢ Up    / â­ â†’ SUPER LIKE (opens ext. URL)  â”‚\n    54â†’â”‚     c. Card animates off screen                     â”‚\n    55â†’â”‚     d. Next card slides up to become top            â”‚\n    56â†’â”‚     e. Preloader ensures next cards are ready       â”‚\n    57â†’â”‚                                                     â”‚\n    58â†’â”‚  3. Undo                                            â”‚\n    59â†’â”‚     â†’ One-level undo brings last swiped card back  â”‚\n    60â†’â”‚                                                     â”‚\n    61â†’â”‚  4. Empty state                                     â”‚\n    62â†’â”‚     â†’ \"You've seen all jobs!\" message + Refresh CTA â”‚\n    63â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    64â†’```\n    65â†’\n    66â†’### Swipe Actions Detail\n    67â†’\n    68â†’| Action | Gesture | Button | Effect |\n    69â†’|--------|---------|--------|--------|\n    70â†’| LIKE   | Swipe right | â¤ (heart) | Opens `externalApplicationUrl` in new tab; card exits right |\n    71â†’| PASS   | Swipe left  | âœ• (cross) | Discards; card exits left |\n    72â†’| SUPER LIKE | Swipe up | â­ (star) | Opens `externalApplicationUrl` in new tab; card exits upward; shows celebration overlay |\n    73â†’\n    74â†’---\n    75â†’\n    76â†’## 3. Home Screen Specification\n    77â†’\n    78â†’The home screen is the **only screen**. There is no navigation, no search page, no profile page.\n    79â†’\n    80â†’### 3.1 Layout\n    81â†’\n    82â†’```\n    83â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    84â†’â”‚  Torre Swipe          [undo â†©]    â”‚  â† Header (48px)\n    85â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    86â†’â”‚                                    â”‚\n    87â†’â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\n    88â†’â”‚    â”Œâ”€â”¤   Card (top)     â”œâ”€â”        â”‚\n    89â†’â”‚  â”Œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”      â”‚\n    90â†’â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â† Card stack area\n    91â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜     â”‚    (fills remaining height)\n    92â†’â”‚                                    â”‚\n    93â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    94â†’â”‚      [âœ•]        [â¤]       [â­]    â”‚  â† Action buttons (80px)\n    95â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    96â†’```\n    97â†’\n    98â†’### 3.2 Card Anatomy\n    99â†’\n   100â†’Each job card is a rounded rectangle (border-radius: 16px) with a white background and a subtle drop shadow. Content from top to bottom:\n   101â†’\n   102â†’```\n   103â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   104â†’â”‚  [Company Logo 56Ã—56]              â”‚  â† rounded, 4px shadow\n   105â†’â”‚  Company Name            [Remote]  â”‚  â† body-sm, gray-500 | badge\n   106â†’â”‚                                    â”‚\n   107â†’â”‚  Job Title (2 lines max)           â”‚  â† heading-lg, semibold\n   108â†’â”‚                                    â”‚\n   109â†’â”‚  ğŸ’° $164k â€“ $246k / year          â”‚  â† compensation (if visible)\n   110â†’â”‚  ğŸ“ United States Â· Remote        â”‚  â† location + remote badge\n   111â†’â”‚  ğŸ• Full-time                     â”‚  â† commitment\n   112â†’â”‚                                    â”‚\n   113â†’â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\n   114â†’â”‚                                    â”‚\n   115â†’â”‚  Tagline text (3 lines max,        â”‚  â† body-sm, gray-600\n   116â†’â”‚  ellipsized)                       â”‚\n   117â†’â”‚                                    â”‚\n   118â†’â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\n   119â†’â”‚                                    â”‚\n   120â†’â”‚  [Figma] [React.js] [CSS] +4      â”‚  â† skill chips (max 3 shown)\n   121â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   122â†’```\n   123â†’\n   124â†’**Card data mapping:**\n   125â†’\n   126â†’| UI element | API field | Fallback |\n   127â†’|---|---|---|\n   128â†’| Company logo | `organizations[0].picture` | Generic building icon |\n   129â†’| Company name | `organizations[0].name` | \"Unknown Company\" |\n   130â†’| Job title | `objective` | â€” |\n   131â†’| Salary | `compensation.data` (if `visible: true`) | \"Salary not disclosed\" |\n   132â†’| Location | `locations[]` joined with `, ` | \"Location not specified\" |\n   133â†’| Remote badge | `remote === true` | hidden |\n   134â†’| Commitment | `commitment` | hidden |\n   135â†’| Tagline | `tagline` | hidden |\n   136â†’| Skills | `skills[].name` (first 3) | hidden if empty |\n   137â†’| Overflow | `skills.length - 3` shown as `+N` | hidden |\n   138â†’\n   139â†’**Salary formatting:**\n   140â†’\n   141â†’- If `compensation.visible === false`: show \"Salary not disclosed\"\n   142â†’- If `code === \"range\"`: `$${formatK(minAmount)} â€“ $${formatK(maxAmount)} / ${periodicity}`\n   143â†’- If `code === \"fixed\"`: `$${formatK(minAmount)} / ${periodicity}`\n   144â†’- `formatK`: amounts â‰¥ 1000 shown as `Xk` (e.g., `164000` â†’ `$164k`)\n   145â†’\n   146â†’**Skill chip colors:** Use a deterministic color from a pastel palette based on skill name hash (so the same skill always gets the same color).\n   147â†’\n   148â†’### 3.3 Card Stack Visual\n   149â†’\n   150â†’Always render exactly **3 cards** (or fewer if fewer remain). Cards are layered with CSS `z-index`. The back cards are purely decorative â€” they show the card background/shadow only, not full content.\n   151â†’\n   152â†’| Position | z-index | Transform | Opacity |\n   153â†’|---|---|---|---|\n   154â†’| Top (active) | 30 | `scale(1)` `translateY(0)` | 1.0 |\n   155â†’| Middle | 20 | `scale(0.97)` `translateY(10px)` | 1.0 |\n   156â†’| Back | 10 | `scale(0.94)` `translateY(20px)` | 1.0 |\n   157â†’\n   158â†’Apply transforms via CSS `transform` (not layout properties) for GPU compositing.\n   159â†’\n   160â†’### 3.4 Swipe Gesture & Overlay Stamps\n   161â†’\n   162â†’**Drag behavior:**\n   163â†’- Card follows the pointer/touch position (CSS `transform: translate(x, y) rotate(Î¸)`).\n   164â†’- Rotation: `Î¸ = x * 0.08` (degrees), clamped to Â±20Â°.\n   165â†’- Overlay stamp opacity: `Math.min(Math.abs(x) / 80, 1)` for horizontal, `Math.min(-y / 80, 1)` for upward.\n   166â†’\n   167â†’**Overlay stamps (shown while dragging):**\n   168â†’\n   169â†’| Direction | Text | Color | Position |\n   170â†’|---|---|---|---|\n   171â†’| Right | **LIKE** | `#4CAF50` (green) | top-left of card, rotated -20Â° |\n   172â†’| Left | **NOPE** | `#F44336` (red) | top-right of card, rotated 20Â° |\n   173â†’| Up | **SUPER** | `#2196F3` (blue) | center of card |\n   174â†’\n   175â†’Stamps use a bordered label style: 3px solid border, uppercase, bold, 28px font.\n   176â†’\n   177â†’**Throw threshold:** If the user releases the card with `|x| > 100px` or `y < -100px`, animate the card off screen. Otherwise spring back to center.\n   178â†’\n   179â†’**Exit animations (spring physics):**\n   180â†’- Right exit: `x` â†’ `window.innerWidth + 300`, slight upward arc\n   181â†’- Left exit: `x` â†’ `-(window.innerWidth + 300)`, slight upward arc\n   182â†’- Up exit: `y` â†’ `-(window.innerHeight + 300)`\n   183â†’- Spring config: `{ stiffness: 400, damping: 30 }` (Framer Motion defaults)\n   184â†’\n   185â†’### 3.5 Action Buttons\n   186â†’\n   187â†’Three circular buttons centered horizontally in the action bar:\n   188â†’\n   189â†’```\n   190â†’[âœ• 56px red/pink]   [â¤ 64px green]   [â­ 56px blue/gold]\n   191â†’```\n   192â†’\n   193â†’- âœ• (Pass): diameter 56px, border 2px `#F44336`, icon `#F44336`\n   194â†’- â¤ (Like): diameter 64px, bg `#4CAF50`, icon white â€” slightly larger as primary CTA\n   195â†’- â­ (Super): diameter 56px, border 2px `#2196F3`, icon `#FFC107` (gold star)\n   196â†’\n   197â†’Tapping a button triggers the same exit animation as a full swipe gesture. Buttons are disabled (opacity 0.4, pointer-events none) during a card exit animation.\n   198â†’\n   199â†’### 3.6 Undo Button\n   200â†’\n   201â†’Located in the top-right of the header. Shows a back-arrow icon (â†©).\n   202â†’\n   203â†’- Enabled only if there is a previous card in the undo stack (max depth: 1 â€” only the most recent swipe can be undone).\n   204â†’- Tapping it brings the last card back to the top of the stack with a reverse spring animation (card flies in from the direction it exited).\n   205â†’- After undo, the button becomes disabled again until the next swipe.\n   206â†’\n   207â†’### 3.7 Super Like Celebration\n   208â†’\n   209â†’When a super like fires (gesture or button):\n   210â†’1. Card exits upward.\n   211â†’2. A full-screen overlay fades in (semi-transparent dark bg).\n   212â†’3. Center: animated star burst (CSS keyframes) with text **\"Super Like! ğŸŒŸ\"**.\n   213â†’4. Auto-dismisses after 1.5s, or user can tap anywhere to dismiss early.\n   214â†’\n   215â†’### 3.8 Loading Skeleton\n   216â†’\n   217â†’Shown in place of the card stack while the first fetch is in flight.\n   218â†’\n   219â†’```\n   220â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   221â†’â”‚  [â–‘â–‘â–‘â–‘ 56Ã—56 circle]               â”‚\n   222â†’â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘               â”‚\n   223â†’â”‚                                    â”‚\n   224â†’â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚\n   225â†’â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚\n   226â†’â”‚                                    â”‚\n   227â†’â”‚  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘             â”‚\n   228â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   229â†’```\n   230â†’\n   231â†’Skeleton elements use a shimmer animation (gradient sweep left-to-right, 1.5s infinite).\n   232â†’\n   233â†’### 3.9 Empty State\n   234â†’\n   235â†’When the card queue is exhausted:\n   236â†’\n   237â†’```\n   238â†’        ğŸ‰\n   239â†’\n   240â†’   You've seen all jobs!\n   241â†’\n   242â†’   Check back later or broaden\n   243â†’   your search.\n   244â†’\n   245â†’   [  Refresh  ]\n   246â†’```\n   247â†’\n   248â†’\"Refresh\" re-triggers the API fetch (with a fresh random offset/seed so different results may appear).\n   249â†’\n   250â†’---\n   251â†’\n   252â†’## 4. Background Preloading Strategy\n   253â†’\n   254â†’The app must **never show a loading spinner** after the initial skeleton load. Achieve this by maintaining a buffer of pre-fetched cards.\n   255â†’\n   256â†’### 4.1 Queue Architecture\n   257â†’\n   258â†’```\n   259â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   260â†’â”‚  DISPLAY QUEUE (cards ready to show)                     â”‚\n   261â†’â”‚  [card_1] [card_2] [card_3] [card_4] [card_5] ...       â”‚\n   262â†’â”‚      â†‘ top card shown                                    â”‚\n   263â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   264â†’          â†“ fetch triggered when size < REFILL_THRESHOLD\n   265â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   266â†’â”‚  FETCH IN FLIGHT (background, non-blocking)              â”‚\n   267â†’â”‚  next batch of 10 cards from BFF                         â”‚\n   268â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   269â†’```\n   270â†’\n   271â†’**Constants:**\n   272â†’\n   273â†’| Constant | Value | Meaning |\n   274â†’|---|---|---|\n   275â†’| `INITIAL_FETCH_SIZE` | 20 | Cards fetched on first load |\n   276â†’| `REFILL_SIZE` | 10 | Cards fetched per refill |\n   277â†’| `REFILL_THRESHOLD` | 5 | Trigger refill when queue drops below this |\n   278â†’| `MAX_QUEUE_SIZE` | 50 | Cap to avoid unbounded memory |\n   279â†’\n   280â†’### 4.2 Deduplication\n   281â†’\n   282â†’Track all seen `id` values in a `Set<string>` (persisted in `localStorage` under `torre_seen_ids`). When appending new cards from a fetch, filter out any whose `id` is already in the seen set. Add swiped card IDs to the set immediately on swipe (before the exit animation completes).\n   283â†’\n   284â†’### 4.3 Image Preloading\n   285â†’\n   286â†’After cards are added to the queue, preload company logo images for the next 5 cards using `new Image()` instances so images are in browser cache when cards render.\n   287â†’\n   288â†’```typescript\n   289â†’function preloadImages(cards: Opportunity[], count = 5) {\n   290â†’  cards.slice(0, count).forEach(card => {\n   291â†’    const url = card.organizations[0]?.picture;\n   292â†’    if (url) {\n   293â†’      const img = new Image();\n   294â†’      img.src = url;\n   295â†’    }\n   296â†’  });\n   297â†’}\n   298â†’```\n   299â†’\n   300â†’### 4.4 Fetch Offset Tracking\n   301â†’\n   302â†’Each search request uses a random `offset` or relies on Torre's pagination. Since the Torre API does not expose a traditional `page` or `offset` param, achieve variety by rotating through different keyword search terms or using an empty keyword search with the `contextFeature=job_feed` param. Track which batches have been fetched to avoid re-fetching the same page.\n   303â†’\n   304â†’---\n   305â†’\n   306â†’## 5. Torre API Integration\n   307â†’\n   308â†’### 5.1 Upstream API Details\n   309â†’\n   310â†’**Base URL:** `https://search.torre.co`\n   311â†’\n   312â†’**Endpoint:** `POST /opportunities/_search`\n   313â†’\n   314â†’**Query Parameters:**\n   315â†’\n   316â†’| Param | Type | Example | Notes |\n   317â†’|---|---|---|---|\n   318â†’| `currency` | string | `\"USD\"` | Normalizes compensation display |\n   319â†’| `periodicity` | string | `\"yearly\"` | `hourly` \\| `monthly` \\| `yearly` |\n   320â†’| `lang` | string | `\"en\"` | ISO 639-1 language code |\n   321â†’| `size` | integer | `10` | Results per page (default 10) |\n   322â†’| `contextFeature` | string | `\"job_feed\"` | Tuning hint for the ranker |\n   323â†’\n   324â†’**Request Body:**\n   325â†’\n   326â†’```json\n   327â†’{\n   328â†’  \"and\": [\n   329â†’    { \"status\": { \"code\": \"open\" } }\n   330â†’  ]\n   331â†’}\n   332â†’```\n   333â†’\n   334â†’To search by keyword, add:\n   335â†’```json\n   336â†’{ \"keywords\": { \"term\": \"Designer\", \"locale\": \"en\" } }\n   337â†’```\n   338â†’\n   339â†’To filter by language:\n   340â†’```json\n   341â†’{ \"language\": { \"term\": \"English\", \"fluency\": \"fully-fluent\" } }\n   342â†’```\n   343â†’\n   344â†’To filter by skill:\n   345â†’```json\n   346â†’{ \"skill/role\": { \"text\": \"React.js\", \"proficiency\": \"proficient\" } }\n   347â†’```\n   348â†’\n   349â†’**Filter operator schema:**\n   350â†’\n   351â†’```typescript\n   352â†’type SearchFilter =\n   353â†’  | { keywords: { term: string; locale?: string } }\n   354â†’  | { language: { term: string; fluency: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\" } }\n   355â†’  | { \"skill/role\": { text: string; proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\" } }\n   356â†’  | { status: { code: \"open\" | \"closed\" | \"paused\" } };\n   357â†’\n   358â†’type SearchRequest = {\n   359â†’  and?: SearchFilter[];\n   360â†’  or?: SearchFilter[];\n   361â†’  not?: SearchFilter[];\n   362â†’};\n   363â†’```\n   364â†’\n   365â†’### 5.2 Response Shape\n   366â†’\n   367â†’```typescript\n   368â†’type SearchResponse = {\n   369â†’  total: number;\n   370â†’  size: number;\n   371â†’  results: Opportunity[];\n   372â†’};\n   373â†’\n   374â†’type Opportunity = {\n   375â†’  id: string;\n   376â†’  objective: string;\n   377â†’  slug: string;\n   378â†’  tagline: string;\n   379â†’  theme: string;\n   380â†’  type: \"full-time-employment\" | \"part-time-employment\" | \"contractor\" | \"freelance\";\n   381â†’  opportunity: \"employee\" | \"freelancer\";\n   382â†’  organizations: Organization[];\n   383â†’  locations: string[];\n   384â†’  timezones: string[] | null;\n   385â†’  remote: boolean;\n   386â†’  external: boolean;\n   387â†’  deadline: string | null;\n   388â†’  created: string;\n   389â†’  status: \"open\" | \"closed\" | \"paused\";\n   390â†’  commitment: \"full-time\" | \"part-time\";\n   391â†’  externalApplicationUrl: string | null;\n   392â†’  compensation: Compensation;\n   393â†’  skills: Skill[];\n   394â†’  place: Place;\n   395â†’};\n   396â†’\n   397â†’type Organization = {\n   398â†’  id: number;\n   399â†’  hashedId: string;\n   400â†’  name: string;\n   401â†’  status: string;\n   402â†’  size: number;\n   403â†’  publicId: string;\n   404â†’  picture: string;\n   405â†’  theme: string;\n   406â†’};\n   407â†’\n   408â†’type Compensation = {\n   409â†’  data: {\n   410â†’    code: \"range\" | \"fixed\";\n   411â†’    currency: string;\n   412â†’    minAmount: number;\n   413â†’    minHourlyUSD: number;\n   414â†’    maxAmount: number;\n   415â†’    maxHourlyUSD: number;\n   416â†’    periodicity: \"hourly\" | \"monthly\" | \"yearly\";\n   417â†’    negotiable: boolean;\n   418â†’    conversionRateUSD: number;\n   419â†’  };\n   420â†’  visible: boolean;\n   421â†’  additionalCompensationDetails: Record<string, unknown>;\n   422â†’};\n   423â†’\n   424â†’type Skill = {\n   425â†’  name: string;\n   426â†’  experience: \"potential-to-develop\" | \"applying\" | \"leading\";\n   427â†’  proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\";\n   428â†’};\n   429â†’\n   430â†’type Place = {\n   431â†’  remote: boolean;\n   432â†’  anywhere: boolean;\n   433â†’  timezone: boolean;\n   434â†’  locationType: \"remote_countries\" | \"anywhere\" | \"timezone\" | \"onsite\";\n   435â†’  location: Array<{\n   436â†’    id: string;\n   437â†’    timezone: number;\n   438â†’    countryCode: string | null;\n   439â†’    latitude: number;\n   440â†’    longitude: number;\n   441â†’  }>;\n   442â†’};\n   443â†’```\n   444â†’\n   445â†’### 5.3 CORS Consideration\n   446â†’\n   447â†’The Torre API is a third-party service. All requests **must** go through the BFF (`apps/api`) to avoid CORS issues and to keep the upstream API call server-side.\n   448â†’\n   449â†’---\n   450â†’\n   451â†’## 6. Monorepo Architecture\n   452â†’\n   453â†’### 6.1 Directory Structure\n   454â†’\n   455â†’```\n   456â†’torre-swipe/\n   457â†’â”œâ”€â”€ apps/\n   458â†’â”‚   â”œâ”€â”€ web/                    # Next.js 14 frontend (App Router)\n   459â†’â”‚   â”‚   â”œâ”€â”€ app/\n   460â†’â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx\n   461â†’â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Home screen (swipe UI)\n   462â†’â”‚   â”‚   â”‚   â””â”€â”€ globals.css\n   463â†’â”‚   â”‚   â”œâ”€â”€ components/\n   464â†’â”‚   â”‚   â”‚   â”œâ”€â”€ SwipeStack.tsx  # Card stack orchestrator\n   465â†’â”‚   â”‚   â”‚   â”œâ”€â”€ JobCard.tsx     # Individual card UI\n   466â†’â”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx   # âœ• â¤ â­ buttons\n   467â†’â”‚   â”‚   â”‚   â”œâ”€â”€ SkeletonCard.tsx\n   468â†’â”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx\n   469â†’â”‚   â”‚   â”‚   â””â”€â”€ CelebrationOverlay.tsx\n   470â†’â”‚   â”‚   â”œâ”€â”€ hooks/\n   471â†’â”‚   â”‚   â”‚   â”œâ”€â”€ useSwipeQueue.ts   # Queue management + preloading\n   472â†’â”‚   â”‚   â”‚   â””â”€â”€ useDragCard.ts     # Drag gesture state\n   473â†’â”‚   â”‚   â”œâ”€â”€ store/\n   474â†’â”‚   â”‚   â”‚   â””â”€â”€ swipeStore.ts   # Zustand store\n   475â†’â”‚   â”‚   â”œâ”€â”€ lib/\n   476â†’â”‚   â”‚   â”‚   â””â”€â”€ api.ts          # BFF client (fetch wrappers)\n   477â†’â”‚   â”‚   â”œâ”€â”€ package.json\n   478â†’â”‚   â”‚   â”œâ”€â”€ next.config.ts\n   479â†’â”‚   â”‚   â””â”€â”€ tsconfig.json\n   480â†’â”‚   â”‚\n   481â†’â”‚   â””â”€â”€ api/                    # Next.js API routes (BFF)\n   482â†’â”‚       â”œâ”€â”€ app/\n   483â†’â”‚       â”‚   â””â”€â”€ api/\n   484â†’â”‚       â”‚       â””â”€â”€ opportunities/\n   485â†’â”‚       â”‚           â””â”€â”€ route.ts   # POST /api/opportunities\n   486â†’â”‚       â”œâ”€â”€ lib/\n   487â†’â”‚       â”‚   â””â”€â”€ torre.ts           # Torre API client (server-side)\n   488â†’â”‚       â”œâ”€â”€ package.json\n   489â†’â”‚       â”œâ”€â”€ next.config.ts\n   490â†’â”‚       â””â”€â”€ tsconfig.json\n   491â†’â”‚\n   492â†’â”œâ”€â”€ packages/\n   493â†’â”‚   â”œâ”€â”€ types/                  # Shared TypeScript types\n   494â†’â”‚   â”‚   â”œâ”€â”€ src/\n   495â†’â”‚   â”‚   â”‚   â”œâ”€â”€ opportunity.ts\n   496â†’â”‚   â”‚   â”‚   â””â”€â”€ index.ts\n   497â†’â”‚   â”‚   â”œâ”€â”€ package.json\n   498â†’â”‚   â”‚   â””â”€â”€ tsconfig.json\n   499â†’â”‚   â”‚\n   500â†’â”‚   â””â”€â”€ torre-client/           # Torre API HTTP client (reusable)\n   501â†’â”‚       â”œâ”€â”€ src/\n   502â†’â”‚       â”‚   â”œâ”€â”€ client.ts\n   503â†’â”‚       â”‚   â”œâ”€â”€ types.ts        # (re-exported from @torre-swipe/types)\n   504â†’â”‚       â”‚   â””â”€â”€ index.ts\n   505â†’â”‚       â”œâ”€â”€ package.json\n   506â†’â”‚       â””â”€â”€ tsconfig.json\n   507â†’â”‚\n   508â†’â”œâ”€â”€ package.json                # Root workspace config\n   509â†’â”œâ”€â”€ pnpm-workspace.yaml\n   510â†’â”œâ”€â”€ turbo.json\n   511â†’â””â”€â”€ tsconfig.base.json\n   512â†’```\n   513â†’\n   514â†’### 6.2 Package Naming Convention\n   515â†’\n   516â†’All internal packages use the `@torre-swipe/` scope:\n   517â†’- `@torre-swipe/types`\n   518â†’- `@torre-swipe/torre-client`\n   519â†’\n   520â†’### 6.3 Root `package.json`\n   521â†’\n   522â†’```json\n   523â†’{\n   524â†’  \"name\": \"torre-swipe\",\n   525â†’  \"private\": true,\n   526â†’  \"scripts\": {\n   527â†’    \"dev\": \"turbo dev\",\n   528â†’    \"build\": \"turbo build\",\n   529â†’    \"test\": \"turbo test\",\n   530â†’    \"lint\": \"turbo lint\",\n   531â†’    \"type-check\": \"turbo type-check\"\n   532â†’  },\n   533â†’  \"devDependencies\": {\n   534â†’    \"turbo\": \"^2.0.0\",\n   535â†’    \"typescript\": \"^5.4.0\"\n   536â†’  }\n   537â†’}\n   538â†’```\n   539â†’\n   540â†’### 6.4 `pnpm-workspace.yaml`\n   541â†’\n   542â†’```yaml\n   543â†’packages:\n   544â†’  - \"apps/*\"\n   545â†’  - \"packages/*\"\n   546â†’```\n   547â†’\n   548â†’### 6.5 `turbo.json`\n   549â†’\n   550â†’```json\n   551â†’{\n   552â†’  \"$schema\": \"https://turbo.build/schema.json\",\n   553â†’  \"tasks\": {\n   554â†’    \"build\": {\n   555â†’      \"dependsOn\": [\"^build\"],\n   556â†’      \"outputs\": [\".next/**\", \"dist/**\"]\n   557â†’    },\n   558â†’    \"dev\": {\n   559â†’      \"cache\": false,\n   560â†’      \"persistent\": true\n   561â†’    },\n   562â†’    \"test\": {\n   563â†’      \"dependsOn\": [\"^build\"]\n   564â†’    },\n   565â†’    \"lint\": {},\n   566â†’    \"type-check\": {\n   567â†’      \"dependsOn\": [\"^build\"]\n   568â†’    }\n   569â†’  }\n   570â†’}\n   571â†’```\n   572â†’\n   573â†’---\n   574â†’\n   575â†’## 7. State Management\n   576â†’\n   577â†’### 7.1 Zustand Store (`swipeStore.ts`)\n   578â†’\n   579â†’```typescript\n   580â†’type SwipeAction = \"like\" | \"pass\" | \"super\";\n   581â†’\n   582â†’type SwipeStore = {\n   583â†’  // Queue\n   584â†’  queue: Opportunity[];          // Cards ready to display (index 0 = top)\n   585â†’  seenIds: Set<string>;          // All IDs ever shown (for dedup)\n   586â†’  isFetching: boolean;\n   587â†’  fetchError: string | null;\n   588â†’\n   589â†’  // Undo\n   590â†’  undoCard: Opportunity | null;  // Last swiped card (for 1-level undo)\n   591â†’  undoAction: SwipeAction | null;\n   592â†’\n   593â†’  // UI state\n   594â†’  isAnimating: boolean;          // True while exit animation runs\n   595â†’  isCelebrating: boolean;        // Super like celebration overlay\n   596â†’\n   597â†’  // Actions\n   598â†’  addCards: (cards: Opportunity[]) => void;\n   599â†’  swipe: (action: SwipeAction) => void;\n   600â†’  undo: () => void;\n   601â†’  setFetching: (v: boolean) => void;\n   602â†’  setFetchError: (msg: string | null) => void;\n   603â†’  setAnimating: (v: boolean) => void;\n   604â†’  setCelebrating: (v: boolean) => void;\n   605â†’};\n   606â†’```\n   607â†’\n   608â†’### 7.2 Persistence (`localStorage`)\n   609â†’\n   610â†’Persist only `seenIds` across sessions to avoid re-showing swiped jobs:\n   611â†’\n   612â†’```typescript\n   613â†’// On store init\n   614â†’const stored = localStorage.getItem(\"torre_seen_ids\");\n   615â†’const seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();\n   616â†’\n   617â†’// After each swipe\n   618â†’localStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));\n   619â†’```\n   620â†’\n   621â†’Cap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.\n   622â†’\n   623â†’Do **not** persist the queue itself â€” always re-fetch on page load.\n   624â†’\n   625â†’### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)\n   626â†’\n   627â†’```typescript\n   628â†’export function useSwipeQueue() {\n   629â†’  const { queue, seenIds, isFetching, addCards, setFetching } = useSwipeStore();\n   630â†’\n   631â†’  // Trigger refill when queue is low\n   632â†’  useEffect(() => {\n   633â†’    if (queue.length < REFILL_THRESHOLD && !isFetching) {\n   634â†’      fetchMore();\n   635â†’    }\n   636â†’  }, [queue.length]);\n   637â†’\n   638â†’  async function fetchMore() {\n   639â†’    setFetching(true);\n   640â†’    try {\n   641â†’      const data = await fetchOpportunities({ size: REFILL_SIZE });\n   642â†’      const fresh = data.results.filter(r => !seenIds.has(r.id));\n   643â†’      addCards(fresh);\n   644â†’      preloadImages(fresh);\n   645â†’    } finally {\n   646â†’      setFetching(false);\n   647â†’    }\n   648â†’  }\n   649â†’\n   650â†’  return { fetchMore };\n   651â†’}\n   652â†’```\n   653â†’\n   654â†’---\n   655â†’\n   656â†’## 8. Tech Stack\n   657â†’\n   658â†’| Layer | Technology | Version | Rationale |\n   659â†’|---|---|---|---|\n   660â†’| **Monorepo** | Turborepo | ^2.0 | Fast incremental builds, task graph |\n   661â†’| **Package manager** | pnpm | ^9.0 | Workspace support, disk efficiency |\n   662â†’| **Language** | TypeScript | ^5.4 | Strict mode throughout |\n   663â†’| **Frontend framework** | Next.js (App Router) | ^14.x | SSR/SSG optional, great DX |\n   664â†’| **Styling** | Tailwind CSS | ^3.4 | Utility-first, no runtime |\n   665â†’| **Animation / gestures** | Framer Motion | ^11.x | Spring physics, drag gesture built-in |\n   666â†’| **State management** | Zustand | ^4.x | Minimal boilerplate, localStorage easy |\n   667â†’| **BFF** | Next.js API Routes | (same as frontend or separate app) | Proxies Torre API, hides CORS |\n   668â†’| **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |\n   669â†’| **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |\n   670â†’| **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |\n   671â†’| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |\n   672â†’| **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |\n   673â†’| **Formatting** | Prettier | ^3.x | Opinionated, zero config |\n   674â†’\n   675â†’### 8.1 Tailwind Configuration\n   676â†’\n   677â†’```javascript\n   678â†’// tailwind.config.ts (apps/web)\n   679â†’export default {\n   680â†’  content: [\"./app/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\"],\n   681â†’  theme: {\n   682â†’    extend: {\n   683â†’      colors: {\n   684â†’        like: \"#4CAF50\",\n   685â†’        pass: \"#F44336\",\n   686â†’        super: \"#2196F3\",\n   687â†’        \"super-star\": \"#FFC107\",\n   688â†’      },\n   689â†’      borderRadius: {\n   690â†’        card: \"16px\",\n   691â†’      },\n   692â†’    },\n   693â†’  },\n   694â†’};\n   695â†’```\n   696â†’\n   697â†’### 8.2 Framer Motion Drag Setup\n   698â†’\n   699â†’The top card uses Framer Motion's `drag` prop. Only the top card is draggable; back cards are static.\n   700â†’\n   701â†’```typescript\n   702â†’<motion.div\n   703â†’  drag\n   704â†’  dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n   705â†’  dragElastic={0.9}\n   706â†’  onDragEnd={handleDragEnd}\n   707â†’  animate={controls}\n   708â†’  style={{ x, y, rotate }}\n   709â†’>\n   710â†’  <JobCard job={currentJob} />\n   711â†’  <SwipeOverlay x={x} y={y} />\n   712â†’</motion.div>\n   713â†’```\n   714â†’\n   715â†’---\n   716â†’\n   717â†’## 9. Test Requirements\n   718â†’\n   719â†’### 9.1 Backend (`apps/api`) â€” Target: ~100% coverage\n   720â†’\n   721â†’Every line of BFF code must be covered by unit tests. Use Vitest with c8 for coverage reporting.\n   722â†’\n   723â†’**Coverage targets:**\n   724â†’- Statements: â‰¥ 98%\n   725â†’- Branches: â‰¥ 95%\n   726â†’- Functions: â‰¥ 98%\n   727â†’- Lines: â‰¥ 98%\n   728â†’\n   729â†’**Test files:**\n   730â†’\n   731â†’```\n   732â†’apps/api/\n   733â†’â””â”€â”€ __tests__/\n   734â†’    â”œâ”€â”€ route.test.ts          # POST /api/opportunities handler\n   735â†’    â””â”€â”€ torre.test.ts          # Torre API client unit tests\n   736â†’```\n   737â†’\n   738â†’**`torre.test.ts` must cover:**\n   739â†’- Happy path: valid request returns parsed Opportunity[]\n   740â†’- Torre API returns non-200: throws `TorreApiError`\n   741â†’- Network failure: throws and propagates\n   742â†’- Response body with missing optional fields (e.g., `compensation.visible = false`)\n   743â†’- `seenIds` deduplication filter\n   744â†’- Request body construction with all filter types (keywords, language, skill/role, status)\n   745â†’- Query param serialization (currency, periodicity, lang, size, contextFeature)\n   746â†’\n   747â†’**`route.test.ts` must cover:**\n   748â†’- Valid POST body â†’ 200 with opportunity list\n   749â†’- Missing/invalid body â†’ 400\n   750â†’- Torre client throws â†’ 502\n   751â†’- CORS headers present in response\n   752â†’- Empty results array handled gracefully\n   753â†’\n   754â†’**Test pattern (mock `fetch` globally):**\n   755â†’\n   756â†’```typescript\n   757â†’import { vi, describe, it, expect, beforeEach } from \"vitest\";\n   758â†’\n   759â†’vi.stubGlobal(\"fetch\", vi.fn());\n   760â†’\n   761â†’describe(\"TorreClient.searchOpportunities\", () => {\n   762â†’  it(\"returns parsed results on success\", async () => {\n   763â†’    (fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n   764â†’      ok: true,\n   765â†’      json: async () => ({ total: 1, size: 1, results: [mockOpportunity] }),\n   766â†’    });\n   767â†’    const result = await client.searchOpportunities({ size: 1 });\n   768â†’    expect(result.results).toHaveLength(1);\n   769â†’  });\n   770â†’});\n   771â†’```\n   772â†’\n   773â†’### 9.2 Frontend (`apps/web`) â€” Unit + Integration\n   774â†’\n   775â†’**Component tests (`*.test.tsx`):**\n   776â†’\n   777â†’| Component | What to test |\n   778â†’|---|---|\n   779â†’| `JobCard` | Renders title, company name, salary (visible/hidden), skills (max 3 + overflow), remote badge, missing logo fallback |\n   780â†’| `ActionBar` | All 3 buttons render; disabled state during animation; click handlers called |\n   781â†’| `SwipeStack` | Shows skeleton when loading; shows empty state when queue empty; renders correct z-order |\n   782â†’| `SkeletonCard` | Renders shimmer elements |\n   783â†’| `EmptyState` | Shows refresh button; calls onRefresh on click |\n   784â†’\n   785â†’**Hook tests:**\n   786â†’\n   787â†’| Hook | What to test |\n   788â†’|---|---|\n   789â†’| `useSwipeQueue` | Triggers fetch on mount; triggers refill when queue < threshold; deduplicates by seenIds |\n   790â†’\n   791â†’**Store tests (`swipeStore.test.ts`):**\n   792â†’- `addCards` appends without duplicates\n   793â†’- `swipe(\"like\")` removes top card, sets `undoCard`, adds id to `seenIds`\n   794â†’- `swipe(\"pass\")` same as like for queue management\n   795â†’- `swipe(\"super\")` same + sets `isCelebrating = true`\n   796â†’- `undo` restores top card from `undoCard`, clears `undoCard`\n   797â†’- `undo` when `undoCard === null` is a no-op\n   798â†’\n   799â†’**Coverage targets (frontend):**\n   800â†’- Statements: â‰¥ 80%\n   801â†’- Branches: â‰¥ 75%\n   802â†’\n   803â†’### 9.3 E2E (`apps/web/e2e/`)\n   804â†’\n   805â†’Use Playwright at mobile viewport (375Ã—812, iPhone 13).\n   806â†’\n   807â†’| Test | Scenario |\n   808â†’|---|---|\n   809â†’| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n   810â†’| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n   811â†’| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n   812â†’| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n   813â†’| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n   814â†’| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n   815â†’| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |\n   816â†’\n   817â†’---\n   818â†’\n   819â†’## 10. API Contract (BFF)\n   820â†’\n   821â†’The BFF (`apps/api`) exposes one endpoint to the frontend.\n   822â†’\n   823â†’### `POST /api/opportunities`\n   824â†’\n   825â†’**Request body:**\n   826â†’\n   827â†’```typescript\n   828â†’type OpportunitiesRequest = {\n   829â†’  size?: number;           // default: 10, max: 20\n   830â†’  keywords?: string;       // free text search term\n   831â†’  language?: string;       // e.g. \"English\"\n   832â†’  fluency?: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\";\n   833â†’  currency?: string;       // e.g. \"USD\"\n   834â†’  periodicity?: \"hourly\" | \"monthly\" | \"yearly\";\n   835â†’};\n   836â†’```\n   837â†’\n   838â†’**Example request:**\n   839â†’\n   840â†’```json\n   841â†’POST /api/opportunities\n   842â†’Content-Type: application/json\n   843â†’\n   844â†’{\n   845â†’  \"size\": 10,\n   846â†’  \"currency\": \"USD\",\n   847â†’  \"periodicity\": \"yearly\"\n   848â†’}\n   849â†’```\n   850â†’\n   851â†’**Response: 200 OK**\n   852â†’\n   853â†’```typescript\n   854â†’type OpportunitiesResponse = {\n   855â†’  results: Opportunity[];  // from @torre-swipe/types\n   856â†’  total: number;\n   857â†’};\n   858â†’```\n   859â†’\n   860â†’**Response: 400 Bad Request**\n   861â†’\n   862â†’```json\n   863â†’{ \"error\": \"Invalid request body\", \"details\": \"...\" }\n   864â†’```\n   865â†’\n   866â†’**Response: 502 Bad Gateway**\n   867â†’\n   868â†’```json\n   869â†’{ \"error\": \"Upstream API error\", \"message\": \"...\" }\n   870â†’```\n   871â†’\n   872â†’### BFF Implementation\n   873â†’\n   874â†’The BFF handler:\n   875â†’1. Validates the incoming request body (Zod schema recommended).\n   876â†’2. Constructs a `SearchRequest` for Torre with `status: open` always included.\n   877â†’3. Calls `TorreClient.searchOpportunities()` from `@torre-swipe/torre-client`.\n   878â†’4. Returns the `results` array and `total` to the frontend.\n   879â†’5. Does NOT filter by `seenIds` â€” that is the frontend's responsibility.\n   880â†’\n   881â†’**CORS:** Set `Access-Control-Allow-Origin: *` (or restrict to the web app origin in production).\n   882â†’\n   883â†’```typescript\n   884â†’// apps/api/app/api/opportunities/route.ts\n   885â†’import { NextRequest, NextResponse } from \"next/server\";\n   886â†’import { TorreClient } from \"@torre-swipe/torre-client\";\n   887â†’import { opportunitiesSchema } from \"../../../lib/validation\";\n   888â†’\n   889â†’const torre = new TorreClient(\"https://search.torre.co\");\n   890â†’\n   891â†’export async function POST(req: NextRequest) {\n   892â†’  const body = await req.json().catch(() => null);\n   893â†’  const parsed = opportunitiesSchema.safeParse(body);\n   894â†’  if (!parsed.success) {\n   895â†’    return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\n   896â†’  }\n   897â†’\n   898â†’  try {\n   899â†’    const result = await torre.searchOpportunities(parsed.data);\n   900â†’    return NextResponse.json(result);\n   901â†’  } catch (err) {\n   902â†’    return NextResponse.json(\n   903â†’      { error: \"Upstream API error\", message: String(err) },\n   904â†’      { status: 502 }\n   905â†’    );\n   906â†’  }\n   907â†’}\n   908â†’```\n   909â†’\n   910â†’---\n   911â†’\n   912â†’## 11. Performance Requirements\n   913â†’\n   914â†’| Metric | Target |\n   915â†’|---|---|\n   916â†’| First Contentful Paint (mobile 3G) | < 2s |\n   917â†’| Skeleton shown before first card ready | â‰¤ 200ms after page load |\n   918â†’| Card transition animation | 60 fps, no jank |\n   919â†’| Time between swipe and next card appearing | < 100ms (card is already in DOM, just z-index change) |\n   920â†’| Image load for top 3 cards | Pre-cached before card reaches top position |\n   921â†’| Bundle size (web, gzipped JS) | < 150 KB first load |\n   922â†’\n   923â†’### 11.1 Animation Performance Rules\n   924â†’\n   925â†’- Use `transform` and `opacity` for all animations (no layout-triggering properties).\n   926â†’- Apply `will-change: transform` to the top card only (remove after exit).\n   927â†’- Back cards use CSS transitions (not JS-driven) â€” they only change when the queue changes.\n   928â†’- Framer Motion's `useMotionValue` + `useTransform` for overlay opacity â€” avoids React re-renders during drag.\n   929â†’\n   930â†’### 11.2 Bundle Optimization\n   931â†’\n   932â†’- Dynamic import `framer-motion` only in the `SwipeStack` component.\n   933â†’- No server-side rendering needed for the swipe UI â€” render client-side with `\"use client\"`.\n   934â†’- Use Next.js Image component for company logos with `priority` on the top card's logo.\n   935â†’\n   936â†’---\n   937â†’\n   938â†’## 12. Accessibility\n   939â†’\n   940â†’The swipe interface must be fully usable **without gestures**.\n   941â†’\n   942â†’### 12.1 Keyboard Support\n   943â†’\n   944â†’| Key | Action |\n   945â†’|---|---|\n   946â†’| `â†’` Arrow Right | Like (same as â¤ button) |\n   947â†’| `â†` Arrow Left | Pass (same as âœ• button) |\n   948â†’| `â†‘` Arrow Up | Super Like (same as â­ button) |\n   949â†’| `Z` | Undo last swipe |\n   950â†’| `Enter` / `Space` | Like (when card is focused) |\n   951â†’\n   952â†’Add a global `keydown` event listener on the home page.\n   953â†’\n   954â†’### 12.2 ARIA Labels\n   955â†’\n   956â†’```html\n   957â†’<button aria-label=\"Pass this job\">âœ•</button>\n   958â†’<button aria-label=\"Like this job\">â¤</button>\n   959â†’<button aria-label=\"Super like this job\">â­</button>\n   960â†’<button aria-label=\"Undo last swipe\" aria-disabled=\"true\">â†©</button>\n   961â†’```\n   962â†’\n   963â†’The card itself:\n   964â†’```html\n   965â†’<article\n   966â†’  role=\"article\"\n   967â†’  aria-label=\"{job.objective} at {company.name}\"\n   968â†’  tabIndex={0}\n   969â†’>\n   970â†’```\n   971â†’\n   972â†’### 12.3 Reduced Motion\n   973â†’\n   974â†’Respect `prefers-reduced-motion`. When active:\n   975â†’- Disable drag animations (cards still respond to button taps).\n   976â†’- Use instant transitions instead of spring animations.\n   977â†’- Disable celebration overlay animation (show static text instead).\n   978â†’\n   979â†’```typescript\n   980â†’const prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\n   981â†’const springConfig = prefersReducedMotion\n   982â†’  ? { duration: 0 }\n   983â†’  : { type: \"spring\", stiffness: 400, damping: 30 };\n   984â†’```\n   985â†’\n   986â†’### 12.4 Touch Target Sizes\n   987â†’\n   988â†’All interactive elements meet the WCAG 2.5.5 AAA minimum of **44Ã—44px** touch target size.\n   989â†’\n   990â†’- Action buttons: 56px and 64px diameter âœ“\n   991â†’- Undo button: minimum 44Ã—44px âœ“\n   992â†’- Skill chips: not interactive, no requirement\n   993â†’\n   994â†’---\n   995â†’\n   996â†’## Appendix A â€” Sample API Call\n   997â†’\n   998â†’```bash\n   999â†’curl -X POST \"https://search.torre.co/opportunities/_search?currency=USD&periodicity=yearly&lang=en&size=10&contextFeature=job_feed\" \\\n  1000â†’  -H \"Content-Type: application/json\" \\\n  1001â†’  -d '{\n  1002â†’    \"and\": [\n  1003â†’      { \"status\": { \"code\": \"open\" } }\n  1004â†’    ]\n  1005â†’  }'\n  1006â†’```\n  1007â†’\n  1008â†’## Appendix B â€” Key File Summaries\n  1009â†’\n  1010â†’| File | Purpose |\n  1011â†’|---|---|\n  1012â†’| `packages/types/src/opportunity.ts` | All shared TypeScript types (Opportunity, Compensation, Skill, etc.) |\n  1013â†’| `packages/torre-client/src/client.ts` | `TorreClient` class with `searchOpportunities()` method |\n  1014â†’| `apps/api/app/api/opportunities/route.ts` | BFF route handler (validates input, calls TorreClient, returns JSON) |\n  1015â†’| `apps/web/store/swipeStore.ts` | Zustand store (queue, undo, celebration state) |\n  1016â†’| `apps/web/hooks/useSwipeQueue.ts` | Preloading logic, refill triggering |\n  1017â†’| `apps/web/hooks/useDragCard.ts` | Framer Motion drag state, threshold detection |\n  1018â†’| `apps/web/components/SwipeStack.tsx` | Renders top 3 cards with correct z-index/transforms |\n  1019â†’| `apps/web/components/JobCard.tsx` | Card UI (logo, title, salary, skills, tagline) |\n  1020â†’| `apps/web/components/ActionBar.tsx` | âœ• â¤ â­ buttons |\n  1021â†’| `apps/web/app/page.tsx` | Home page â€” composes all components, keyboard handler |\n  1022â†’\n  1023â†’## Appendix C â€” `@torre-swipe/torre-client` Interface\n  1024â†’\n  1025â†’```typescript\n  1026â†’export class TorreClient {\n  1027â†’  constructor(private baseUrl: string) {}\n  1028â†’\n  1029â†’  async searchOpportunities(params: {\n  1030â†’    size?: number;\n  1031â†’    currency?: string;\n  1032â†’    periodicity?: string;\n  1033â†’    lang?: string;\n  1034â†’    contextFeature?: string;\n  1035â†’    keywords?: string;\n  1036â†’    language?: string;\n  1037â†’    fluency?: string;\n  1038â†’  }): Promise<{ total: number; size: number; results: Opportunity[] }>;\n  1039â†’}\n  1040â†’\n  1041â†’export class TorreApiError extends Error {\n  1042â†’  constructor(\n  1043â†’    public status: number,\n  1044â†’    public body: string\n  1045â†’  ) {\n  1046â†’    super(`Torre API error ${status}: ${body}`);\n  1047â†’  }\n  1048â†’}\n  1049â†’```\n  1050â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c2e9ebb8-c084-4e5b-b4dd-d1d3bb28d144","timestamp":"2026-02-26T17:30:44.240Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/agurodriguez/Code/torre-ca/SPEC.md","content":"# Torre Swipe â€” Product & Technical Specification\n\n> Hand this document to an LLM and say **\"build this\"** to get a complete, production-ready implementation.\n\n---\n\n## Table of Contents\n\n1. [Product Overview](#1-product-overview)\n2. [Core User Flow](#2-core-user-flow)\n3. [Home Screen Specification](#3-home-screen-specification)\n4. [Background Preloading Strategy](#4-background-preloading-strategy)\n5. [Torre API Integration](#5-torre-api-integration)\n6. [Monorepo Architecture](#6-monorepo-architecture)\n7. [State Management](#7-state-management)\n8. [Tech Stack](#8-tech-stack)\n9. [Test Requirements](#9-test-requirements)\n10. [API Contract (BFF)](#10-api-contract-bff)\n11. [Performance Requirements](#11-performance-requirements)\n12. [Accessibility](#12-accessibility)\n\n---\n\n## 1. Product Overview\n\n**Torre Swipe** is a mobile-first web application that lets job seekers discover Torre.ai job opportunities through a Tinder-style swipe interface. Users swipe right to like a job, left to pass, and up to super-like. Liked and super-liked jobs open the external application URL in a new tab.\n\n**Primary user:** A job seeker on a mobile browser who wants a fast, low-friction way to browse and shortlist job opportunities.\n\n**Why it works:** Traditional job boards require deliberate search queries. Torre Swipe surfaces opportunities serendipitously, making job discovery feel effortless and even fun. The swipe mechanic creates a lightweight commitment signal â€” a flick of the thumb â€” that lowers the psychological cost of engaging with each posting.\n\n**Non-goals (out of scope):**\n- User accounts or authentication\n- Persistent match history beyond `localStorage`\n- Full application flow within the app (redirects to external URLs)\n- Employer-facing features\n\n---\n\n## 2. Core User Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  1. User opens app (mobile browser)                 â”‚\nâ”‚     â†’ Skeleton loading cards appear instantly       â”‚\nâ”‚     â†’ First batch of jobs fetched from BFF          â”‚\nâ”‚                                                     â”‚\nâ”‚  2. Swipe loop (repeated until empty state)         â”‚\nâ”‚     a. Top card is the current job                  â”‚\nâ”‚     b. User swipes or taps a button:                â”‚\nâ”‚        â€¢ Right / â¤  â†’ LIKE  (opens ext. URL)       â”‚\nâ”‚        â€¢ Left  / âœ•  â†’ PASS  (discard)              â”‚\nâ”‚        â€¢ Up    / â­ â†’ SUPER LIKE (opens ext. URL)  â”‚\nâ”‚     c. Card animates off screen                     â”‚\nâ”‚     d. Next card slides up to become top            â”‚\nâ”‚     e. Preloader ensures next cards are ready       â”‚\nâ”‚                                                     â”‚\nâ”‚  3. Undo                                            â”‚\nâ”‚     â†’ One-level undo brings last swiped card back  â”‚\nâ”‚                                                     â”‚\nâ”‚  4. Empty state                                     â”‚\nâ”‚     â†’ \"You've seen all jobs!\" message + Refresh CTA â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Swipe Actions Detail\n\n| Action | Gesture | Button | Effect |\n|--------|---------|--------|--------|\n| LIKE   | Swipe right | â¤ (heart) | Opens `externalApplicationUrl` in new tab; card exits right |\n| PASS   | Swipe left  | âœ• (cross) | Discards; card exits left |\n| SUPER LIKE | Swipe up | â­ (star) | Opens `externalApplicationUrl` in new tab; card exits upward; shows celebration overlay |\n\n---\n\n## 3. Home Screen Specification\n\nThe home screen is the **only screen**. There is no navigation, no search page, no profile page.\n\n### 3.1 Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Torre Swipe          [undo â†©]    â”‚  â† Header (48px)\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                    â”‚\nâ”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\nâ”‚    â”Œâ”€â”¤   Card (top)     â”œâ”€â”        â”‚\nâ”‚  â”Œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”      â”‚\nâ”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â† Card stack area\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜     â”‚    (fills remaining height)\nâ”‚                                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚      [âœ•]        [â¤]       [â­]    â”‚  â† Action buttons (80px)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3.2 Card Anatomy\n\nEach job card is a rounded rectangle (border-radius: 16px) with a white background and a subtle drop shadow. Content from top to bottom:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [Company Logo 56Ã—56]              â”‚  â† rounded, 4px shadow\nâ”‚  Company Name            [Remote]  â”‚  â† body-sm, gray-500 | badge\nâ”‚                                    â”‚\nâ”‚  Job Title (2 lines max)           â”‚  â† heading-lg, semibold\nâ”‚                                    â”‚\nâ”‚  ğŸ’° $164k â€“ $246k / year          â”‚  â† compensation (if visible)\nâ”‚  ğŸ“ United States Â· Remote        â”‚  â† location + remote badge\nâ”‚  ğŸ• Full-time                     â”‚  â† commitment\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  Tagline text (3 lines max,        â”‚  â† body-sm, gray-600\nâ”‚  ellipsized)                       â”‚\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  [Figma] [React.js] [CSS] +4      â”‚  â† skill chips (max 3 shown)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Card data mapping:**\n\n| UI element | API field | Fallback |\n|---|---|---|\n| Company logo | `organizations[0].picture` | Generic building icon |\n| Company name | `organizations[0].name` | \"Unknown Company\" |\n| Job title | `objective` | â€” |\n| Salary | `compensation.data` (if `visible: true`) | \"Salary not disclosed\" |\n| Location | `locations[]` joined with `, ` | \"Location not specified\" |\n| Remote badge | `remote === true` | hidden |\n| Commitment | `commitment` | hidden |\n| Tagline | `tagline` | hidden |\n| Skills | `skills[].name` (first 3) | hidden if empty |\n| Overflow | `skills.length - 3` shown as `+N` | hidden |\n\n**Salary formatting:**\n\n- If `compensation.visible === false`: show \"Salary not disclosed\"\n- If `code === \"range\"`: `$${formatK(minAmount)} â€“ $${formatK(maxAmount)} / ${periodicity}`\n- If `code === \"fixed\"`: `$${formatK(minAmount)} / ${periodicity}`\n- `formatK`: amounts â‰¥ 1000 shown as `Xk` (e.g., `164000` â†’ `$164k`)\n\n**Skill chip colors:** Use a deterministic color from a pastel palette based on skill name hash (so the same skill always gets the same color).\n\n### 3.3 Card Stack Visual\n\nAlways render exactly **3 cards** (or fewer if fewer remain). Cards are layered with CSS `z-index`. The back cards are purely decorative â€” they show the card background/shadow only, not full content.\n\n| Position | z-index | Transform | Opacity |\n|---|---|---|---|\n| Top (active) | 30 | `scale(1)` `translateY(0)` | 1.0 |\n| Middle | 20 | `scale(0.97)` `translateY(10px)` | 1.0 |\n| Back | 10 | `scale(0.94)` `translateY(20px)` | 1.0 |\n\nApply transforms via CSS `transform` (not layout properties) for GPU compositing.\n\n### 3.4 Swipe Gesture & Overlay Stamps\n\n**Drag behavior:**\n- Card follows the pointer/touch position (CSS `transform: translate(x, y) rotate(Î¸)`).\n- Rotation: `Î¸ = x * 0.08` (degrees), clamped to Â±20Â°.\n- Overlay stamp opacity: `Math.min(Math.abs(x) / 80, 1)` for horizontal, `Math.min(-y / 80, 1)` for upward.\n\n**Overlay stamps (shown while dragging):**\n\n| Direction | Text | Color | Position |\n|---|---|---|---|\n| Right | **LIKE** | `#4CAF50` (green) | top-left of card, rotated -20Â° |\n| Left | **NOPE** | `#F44336` (red) | top-right of card, rotated 20Â° |\n| Up | **SUPER** | `#2196F3` (blue) | center of card |\n\nStamps use a bordered label style: 3px solid border, uppercase, bold, 28px font.\n\n**Throw threshold:** If the user releases the card with `|x| > 100px` or `y < -100px`, animate the card off screen. Otherwise spring back to center.\n\n**Exit animations (spring physics):**\n- Right exit: `x` â†’ `window.innerWidth + 300`, slight upward arc\n- Left exit: `x` â†’ `-(window.innerWidth + 300)`, slight upward arc\n- Up exit: `y` â†’ `-(window.innerHeight + 300)`\n- Spring config: `{ stiffness: 400, damping: 30 }` (Framer Motion defaults)\n\n### 3.5 Action Buttons\n\nThree circular buttons centered horizontally in the action bar:\n\n```\n[âœ• 56px red/pink]   [â¤ 64px green]   [â­ 56px blue/gold]\n```\n\n- âœ• (Pass): diameter 56px, border 2px `#F44336`, icon `#F44336`\n- â¤ (Like): diameter 64px, bg `#4CAF50`, icon white â€” slightly larger as primary CTA\n- â­ (Super): diameter 56px, border 2px `#2196F3`, icon `#FFC107` (gold star)\n\nTapping a button triggers the same exit animation as a full swipe gesture. Buttons are disabled (opacity 0.4, pointer-events none) during a card exit animation.\n\n### 3.6 Undo Button\n\nLocated in the top-right of the header. Shows a back-arrow icon (â†©).\n\n- Enabled only if there is a previous card in the undo stack (max depth: 1 â€” only the most recent swipe can be undone).\n- Tapping it brings the last card back to the top of the stack with a reverse spring animation (card flies in from the direction it exited).\n- After undo, the button becomes disabled again until the next swipe.\n\n### 3.7 Super Like Celebration\n\nWhen a super like fires (gesture or button):\n1. Card exits upward.\n2. A full-screen overlay fades in (semi-transparent dark bg).\n3. Center: animated star burst (CSS keyframes) with text **\"Super Like! ğŸŒŸ\"**.\n4. Auto-dismisses after 1.5s, or user can tap anywhere to dismiss early.\n\n### 3.8 Loading Skeleton\n\nShown in place of the card stack while the first fetch is in flight.\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [â–‘â–‘â–‘â–‘ 56Ã—56 circle]               â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘               â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nSkeleton elements use a shimmer animation (gradient sweep left-to-right, 1.5s infinite).\n\n### 3.9 Empty State\n\nWhen the card queue is exhausted:\n\n```\n        ğŸ‰\n\n   You've seen all jobs!\n\n   Check back later or broaden\n   your search.\n\n   [  Refresh  ]\n```\n\n\"Refresh\" re-triggers the API fetch (with a fresh random offset/seed so different results may appear).\n\n---\n\n## 4. Background Preloading Strategy\n\nThe app must **never show a loading spinner** after the initial skeleton load. Achieve this by maintaining a buffer of pre-fetched cards.\n\n### 4.1 Queue Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  DISPLAY QUEUE (cards ready to show)                     â”‚\nâ”‚  [card_1] [card_2] [card_3] [card_4] [card_5] ...       â”‚\nâ”‚      â†‘ top card shown                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â†“ fetch triggered when size < REFILL_THRESHOLD\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FETCH IN FLIGHT (background, non-blocking)              â”‚\nâ”‚  next batch of 10 cards from BFF                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Constants:**\n\n| Constant | Value | Meaning |\n|---|---|---|\n| `INITIAL_FETCH_SIZE` | 20 | Cards fetched on first load |\n| `REFILL_SIZE` | 10 | Cards fetched per refill |\n| `REFILL_THRESHOLD` | 5 | Trigger refill when queue drops below this |\n| `MAX_QUEUE_SIZE` | 50 | Cap to avoid unbounded memory |\n\n### 4.2 Deduplication\n\nTrack all seen `id` values in a `Set<string>` (persisted in `localStorage` under `torre_seen_ids`). When appending new cards from a fetch, filter out any whose `id` is already in the seen set. Add swiped card IDs to the set immediately on swipe (before the exit animation completes).\n\n### 4.3 Image Preloading\n\nAfter cards are added to the queue, preload company logo images for the next 5 cards using `new Image()` instances so images are in browser cache when cards render.\n\n```typescript\nfunction preloadImages(cards: Opportunity[], count = 5) {\n  cards.slice(0, count).forEach(card => {\n    const url = card.organizations[0]?.picture;\n    if (url) {\n      const img = new Image();\n      img.src = url;\n    }\n  });\n}\n```\n\n### 4.4 Fetch Offset Tracking\n\nEach search request uses a random `offset` or relies on Torre's pagination. Since the Torre API does not expose a traditional `page` or `offset` param, achieve variety by rotating through different keyword search terms or using an empty keyword search with the `contextFeature=job_feed` param. Track which batches have been fetched to avoid re-fetching the same page.\n\n---\n\n## 5. Torre API Integration\n\n### 5.1 Upstream API Details\n\n**Base URL:** `https://search.torre.co`\n\n**Endpoint:** `POST /opportunities/_search`\n\n**Query Parameters:**\n\n| Param | Type | Example | Notes |\n|---|---|---|---|\n| `currency` | string | `\"USD\"` | Normalizes compensation display |\n| `periodicity` | string | `\"yearly\"` | `hourly` \\| `monthly` \\| `yearly` |\n| `lang` | string | `\"en\"` | ISO 639-1 language code |\n| `size` | integer | `10` | Results per page (default 10) |\n| `contextFeature` | string | `\"job_feed\"` | Tuning hint for the ranker |\n\n**Request Body:**\n\n```json\n{\n  \"and\": [\n    { \"status\": { \"code\": \"open\" } }\n  ]\n}\n```\n\nTo search by keyword, add:\n```json\n{ \"keywords\": { \"term\": \"Designer\", \"locale\": \"en\" } }\n```\n\nTo filter by language:\n```json\n{ \"language\": { \"term\": \"English\", \"fluency\": \"fully-fluent\" } }\n```\n\nTo filter by skill:\n```json\n{ \"skill/role\": { \"text\": \"React.js\", \"proficiency\": \"proficient\" } }\n```\n\n**Filter operator schema:**\n\n```typescript\ntype SearchFilter =\n  | { keywords: { term: string; locale?: string } }\n  | { language: { term: string; fluency: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\" } }\n  | { \"skill/role\": { text: string; proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\" } }\n  | { status: { code: \"open\" | \"closed\" | \"paused\" } };\n\ntype SearchRequest = {\n  and?: SearchFilter[];\n  or?: SearchFilter[];\n  not?: SearchFilter[];\n};\n```\n\n### 5.2 Response Shape\n\n```typescript\ntype SearchResponse = {\n  total: number;\n  size: number;\n  results: Opportunity[];\n};\n\ntype Opportunity = {\n  id: string;\n  objective: string;\n  slug: string;\n  tagline: string;\n  theme: string;\n  type: \"full-time-employment\" | \"part-time-employment\" | \"contractor\" | \"freelance\";\n  opportunity: \"employee\" | \"freelancer\";\n  organizations: Organization[];\n  locations: string[];\n  timezones: string[] | null;\n  remote: boolean;\n  external: boolean;\n  deadline: string | null;\n  created: string;\n  status: \"open\" | \"closed\" | \"paused\";\n  commitment: \"full-time\" | \"part-time\";\n  externalApplicationUrl: string | null;\n  compensation: Compensation;\n  skills: Skill[];\n  place: Place;\n};\n\ntype Organization = {\n  id: number;\n  hashedId: string;\n  name: string;\n  status: string;\n  size: number;\n  publicId: string;\n  picture: string;\n  theme: string;\n};\n\ntype Compensation = {\n  data: {\n    code: \"range\" | \"fixed\";\n    currency: string;\n    minAmount: number;\n    minHourlyUSD: number;\n    maxAmount: number;\n    maxHourlyUSD: number;\n    periodicity: \"hourly\" | \"monthly\" | \"yearly\";\n    negotiable: boolean;\n    conversionRateUSD: number;\n  };\n  visible: boolean;\n  additionalCompensationDetails: Record<string, unknown>;\n};\n\ntype Skill = {\n  name: string;\n  experience: \"potential-to-develop\" | \"applying\" | \"leading\";\n  proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\";\n};\n\ntype Place = {\n  remote: boolean;\n  anywhere: boolean;\n  timezone: boolean;\n  locationType: \"remote_countries\" | \"anywhere\" | \"timezone\" | \"onsite\";\n  location: Array<{\n    id: string;\n    timezone: number;\n    countryCode: string | null;\n    latitude: number;\n    longitude: number;\n  }>;\n};\n```\n\n### 5.3 CORS Consideration\n\nThe Torre API is a third-party service. All requests **must** go through the BFF (`apps/api`) to avoid CORS issues and to keep the upstream API call server-side.\n\n---\n\n## 6. Monorepo Architecture\n\n### 6.1 Directory Structure\n\n```\ntorre-swipe/\nâ”œâ”€â”€ apps/\nâ”‚   â”œâ”€â”€ web/                    # Next.js 14 frontend (App Router)\nâ”‚   â”‚   â”œâ”€â”€ app/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Home screen (swipe UI)\nâ”‚   â”‚   â”‚   â””â”€â”€ globals.css\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SwipeStack.tsx  # Card stack orchestrator\nâ”‚   â”‚   â”‚   â”œâ”€â”€ JobCard.tsx     # Individual card UI\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx   # âœ• â¤ â­ buttons\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SkeletonCard.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ CelebrationOverlay.tsx\nâ”‚   â”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ useSwipeQueue.ts   # Queue management + preloading\nâ”‚   â”‚   â”‚   â””â”€â”€ useDragCard.ts     # Drag gesture state\nâ”‚   â”‚   â”œâ”€â”€ store/\nâ”‚   â”‚   â”‚   â””â”€â”€ swipeStore.ts   # Zustand store\nâ”‚   â”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â”‚   â””â”€â”€ api.ts          # BFF client (fetch wrappers)\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â”œâ”€â”€ next.config.ts\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ api/                    # Next.js API routes (BFF)\nâ”‚       â”œâ”€â”€ app/\nâ”‚       â”‚   â””â”€â”€ api/\nâ”‚       â”‚       â””â”€â”€ opportunities/\nâ”‚       â”‚           â””â”€â”€ route.ts   # POST /api/opportunities\nâ”‚       â”œâ”€â”€ lib/\nâ”‚       â”‚   â””â”€â”€ torre.ts           # Torre API client (server-side)\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â”œâ”€â”€ next.config.ts\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ packages/\nâ”‚   â”œâ”€â”€ types/                  # Shared TypeScript types\nâ”‚   â”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ opportunity.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ torre-client/           # Torre API HTTP client (reusable)\nâ”‚       â”œâ”€â”€ src/\nâ”‚       â”‚   â”œâ”€â”€ client.ts\nâ”‚       â”‚   â”œâ”€â”€ types.ts        # (re-exported from @torre-swipe/types)\nâ”‚       â”‚   â””â”€â”€ index.ts\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ package.json                # Root workspace config\nâ”œâ”€â”€ pnpm-workspace.yaml\nâ”œâ”€â”€ turbo.json\nâ””â”€â”€ tsconfig.base.json\n```\n\n### 6.2 Package Naming Convention\n\nAll internal packages use the `@torre-swipe/` scope:\n- `@torre-swipe/types`\n- `@torre-swipe/torre-client`\n\n### 6.3 Root `package.json`\n\n```json\n{\n  \"name\": \"torre-swipe\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"turbo dev\",\n    \"build\": \"turbo build\",\n    \"test\": \"turbo test\",\n    \"lint\": \"turbo lint\",\n    \"type-check\": \"turbo type-check\"\n  },\n  \"devDependencies\": {\n    \"turbo\": \"^2.0.0\",\n    \"typescript\": \"^5.4.0\"\n  }\n}\n```\n\n### 6.4 `pnpm-workspace.yaml`\n\n```yaml\npackages:\n  - \"apps/*\"\n  - \"packages/*\"\n```\n\n### 6.5 `turbo.json`\n\n```json\n{\n  \"$schema\": \"https://turbo.build/schema.json\",\n  \"tasks\": {\n    \"build\": {\n      \"dependsOn\": [\"^build\"],\n      \"outputs\": [\".next/**\", \"dist/**\"]\n    },\n    \"dev\": {\n      \"cache\": false,\n      \"persistent\": true\n    },\n    \"test\": {\n      \"dependsOn\": [\"^build\"]\n    },\n    \"lint\": {},\n    \"type-check\": {\n      \"dependsOn\": [\"^build\"]\n    }\n  }\n}\n```\n\n---\n\n## 7. State Management\n\n### 7.1 Zustand Store (`swipeStore.ts`)\n\n```typescript\ntype SwipeAction = \"like\" | \"pass\" | \"super\";\n\ntype SwipeStore = {\n  // Queue\n  queue: Opportunity[];          // Cards ready to display (index 0 = top)\n  seenIds: Set<string>;          // All IDs ever shown (for dedup)\n  isFetching: boolean;\n  fetchError: string | null;\n\n  // Undo\n  undoCard: Opportunity | null;  // Last swiped card (for 1-level undo)\n  undoAction: SwipeAction | null;\n\n  // UI state\n  isAnimating: boolean;          // True while exit animation runs\n  isCelebrating: boolean;        // Super like celebration overlay\n\n  // Actions\n  addCards: (cards: Opportunity[]) => void;\n  swipe: (action: SwipeAction) => void;\n  undo: () => void;\n  setFetching: (v: boolean) => void;\n  setFetchError: (msg: string | null) => void;\n  setAnimating: (v: boolean) => void;\n  setCelebrating: (v: boolean) => void;\n};\n```\n\n### 7.2 Persistence (`localStorage`)\n\nPersist only `seenIds` across sessions to avoid re-showing swiped jobs:\n\n```typescript\n// On store init\nconst stored = localStorage.getItem(\"torre_seen_ids\");\nconst seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();\n\n// After each swipe\nlocalStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));\n```\n\nCap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.\n\n### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)\n\n```typescript\nexport function useSwipeQueue() {\n  const { queue, seenIds, isFetching, addCards, setFetching } = useSwipeStore();\n\n  // Trigger refill when queue is low\n  useEffect(() => {\n    if (queue.length < REFILL_THRESHOLD && !isFetching) {\n      fetchMore();\n    }\n  }, [queue.length]);\n\n  async function fetchMore() {\n    setFetching(true);\n    try {\n      const data = await fetchOpportunities({ size: REFILL_SIZE });\n      const fresh = data.results.filter(r => !seenIds.has(r.id));\n      addCards(fresh);\n      preloadImages(fresh);\n    } finally {\n      setFetching(false);\n    }\n  }\n\n  return { fetchMore };\n}\n```\n\n---\n\n## 8. Tech Stack\n\n| Layer | Technology | Version | Rationale |\n|---|---|---|---|\n| **Monorepo** | Turborepo | ^2.0 | Fast incremental builds, task graph |\n| **Package manager** | pnpm | ^9.0 | Workspace support, disk efficiency |\n| **Language** | TypeScript | ^5.4 | Strict mode throughout |\n| **Frontend framework** | Next.js (App Router) | ^14.x | SSR/SSG optional, great DX |\n| **Styling** | Tailwind CSS | ^3.4 | Utility-first, no runtime |\n| **Animation / gestures** | Framer Motion | ^11.x | Spring physics, drag gesture built-in |\n| **State management** | Zustand | ^4.x | Minimal boilerplate, localStorage easy |\n| **BFF** | Next.js API Routes | (same as frontend or separate app) | Proxies Torre API, hides CORS |\n| **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |\n| **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |\n| **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |\n| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |\n| **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |\n| **Formatting** | Prettier | ^3.x | Opinionated, zero config |\n\n### 8.1 Tailwind Configuration\n\n```javascript\n// tailwind.config.ts (apps/web)\nexport default {\n  content: [\"./app/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\"],\n  theme: {\n    extend: {\n      colors: {\n        like: \"#4CAF50\",\n        pass: \"#F44336\",\n        super: \"#2196F3\",\n        \"super-star\": \"#FFC107\",\n      },\n      borderRadius: {\n        card: \"16px\",\n      },\n    },\n  },\n};\n```\n\n### 8.2 Framer Motion Drag Setup\n\nThe top card uses Framer Motion's `drag` prop. Only the top card is draggable; back cards are static.\n\n```typescript\n<motion.div\n  drag\n  dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n  dragElastic={0.9}\n  onDragEnd={handleDragEnd}\n  animate={controls}\n  style={{ x, y, rotate }}\n>\n  <JobCard job={currentJob} />\n  <SwipeOverlay x={x} y={y} />\n</motion.div>\n```\n\n---\n\n## 9. Test Requirements\n\n### 9.1 Backend (`apps/api`) â€” Target: ~100% coverage\n\nEvery line of BFF code must be covered by unit tests. Use Vitest with c8 for coverage reporting.\n\n**Coverage targets:**\n- Statements: â‰¥ 98%\n- Branches: â‰¥ 95%\n- Functions: â‰¥ 98%\n- Lines: â‰¥ 98%\n\n**Test files:**\n\n```\napps/api/\nâ””â”€â”€ __tests__/\n    â”œâ”€â”€ route.test.ts          # POST /api/opportunities handler\n    â””â”€â”€ torre.test.ts          # Torre API client unit tests\n```\n\n**`torre.test.ts` must cover:**\n- Happy path: valid request returns parsed Opportunity[]\n- Torre API returns non-200: throws `TorreApiError`\n- Network failure: throws and propagates\n- Response body with missing optional fields (e.g., `compensation.visible = false`)\n- `seenIds` deduplication filter\n- Request body construction with all filter types (keywords, language, skill/role, status)\n- Query param serialization (currency, periodicity, lang, size, contextFeature)\n\n**`route.test.ts` must cover:**\n- Valid POST body â†’ 200 with opportunity list\n- Missing/invalid body â†’ 400\n- Torre client throws â†’ 502\n- CORS headers present in response\n- Empty results array handled gracefully\n\n**Test pattern (mock `fetch` globally):**\n\n```typescript\nimport { vi, describe, it, expect, beforeEach } from \"vitest\";\n\nvi.stubGlobal(\"fetch\", vi.fn());\n\ndescribe(\"TorreClient.searchOpportunities\", () => {\n  it(\"returns parsed results on success\", async () => {\n    (fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ total: 1, size: 1, results: [mockOpportunity] }),\n    });\n    const result = await client.searchOpportunities({ size: 1 });\n    expect(result.results).toHaveLength(1);\n  });\n});\n```\n\n### 9.2 Frontend (`apps/web`) â€” Unit + Integration\n\n**Component tests (`*.test.tsx`):**\n\n| Component | What to test |\n|---|---|\n| `JobCard` | Renders title, company name, salary (visible/hidden), skills (max 3 + overflow), remote badge, missing logo fallback |\n| `ActionBar` | All 3 buttons render; disabled state during animation; click handlers called |\n| `SwipeStack` | Shows skeleton when loading; shows empty state when queue empty; renders correct z-order |\n| `SkeletonCard` | Renders shimmer elements |\n| `EmptyState` | Shows refresh button; calls onRefresh on click |\n\n**Hook tests:**\n\n| Hook | What to test |\n|---|---|\n| `useSwipeQueue` | Triggers fetch on mount; triggers refill when queue < threshold; deduplicates by seenIds |\n\n**Store tests (`swipeStore.test.ts`):**\n- `addCards` appends without duplicates\n- `swipe(\"like\")` removes top card, sets `undoCard`, adds id to `seenIds`\n- `swipe(\"pass\")` same as like for queue management\n- `swipe(\"super\")` same + sets `isCelebrating = true`\n- `undo` restores top card from `undoCard`, clears `undoCard`\n- `undo` when `undoCard === null` is a no-op\n\n**Coverage targets (frontend):**\n- Statements: â‰¥ 80%\n- Branches: â‰¥ 75%\n\n### 9.3 E2E (`apps/web/e2e/`)\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |\n\n---\n\n## 10. API Contract (BFF)\n\nThe BFF (`apps/api`) exposes one endpoint to the frontend.\n\n### `POST /api/opportunities`\n\n**Request body:**\n\n```typescript\ntype OpportunitiesRequest = {\n  size?: number;           // default: 10, max: 20\n  keywords?: string;       // free text search term\n  language?: string;       // e.g. \"English\"\n  fluency?: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\";\n  currency?: string;       // e.g. \"USD\"\n  periodicity?: \"hourly\" | \"monthly\" | \"yearly\";\n};\n```\n\n**Example request:**\n\n```json\nPOST /api/opportunities\nContent-Type: application/json\n\n{\n  \"size\": 10,\n  \"currency\": \"USD\",\n  \"periodicity\": \"yearly\"\n}\n```\n\n**Response: 200 OK**\n\n```typescript\ntype OpportunitiesResponse = {\n  results: Opportunity[];  // from @torre-swipe/types\n  total: number;\n};\n```\n\n**Response: 400 Bad Request**\n\n```json\n{ \"error\": \"Invalid request body\", \"details\": \"...\" }\n```\n\n**Response: 502 Bad Gateway**\n\n```json\n{ \"error\": \"Upstream API error\", \"message\": \"...\" }\n```\n\n### BFF Implementation\n\nThe BFF handler:\n1. Validates the incoming request body (Zod schema recommended).\n2. Constructs a `SearchRequest` for Torre with `status: open` always included.\n3. Calls `TorreClient.searchOpportunities()` from `@torre-swipe/torre-client`.\n4. Returns the `results` array and `total` to the frontend.\n5. Does NOT filter by `seenIds` â€” that is the frontend's responsibility.\n\n**CORS:** Set `Access-Control-Allow-Origin: *` (or restrict to the web app origin in production).\n\n```typescript\n// apps/api/app/api/opportunities/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { TorreClient } from \"@torre-swipe/torre-client\";\nimport { opportunitiesSchema } from \"../../../lib/validation\";\n\nconst torre = new TorreClient(\"https://search.torre.co\");\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json().catch(() => null);\n  const parsed = opportunitiesSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\n  }\n\n  try {\n    const result = await torre.searchOpportunities(parsed.data);\n    return NextResponse.json(result);\n  } catch (err) {\n    return NextResponse.json(\n      { error: \"Upstream API error\", message: String(err) },\n      { status: 502 }\n    );\n  }\n}\n```\n\n---\n\n## 11. Performance Requirements\n\n| Metric | Target |\n|---|---|\n| First Contentful Paint (mobile 3G) | < 2s |\n| Skeleton shown before first card ready | â‰¤ 200ms after page load |\n| Card transition animation | 60 fps, no jank |\n| Time between swipe and next card appearing | < 100ms (card is already in DOM, just z-index change) |\n| Image load for top 3 cards | Pre-cached before card reaches top position |\n| Bundle size (web, gzipped JS) | < 150 KB first load |\n\n### 11.1 Animation Performance Rules\n\n- Use `transform` and `opacity` for all animations (no layout-triggering properties).\n- Apply `will-change: transform` to the top card only (remove after exit).\n- Back cards use CSS transitions (not JS-driven) â€” they only change when the queue changes.\n- Framer Motion's `useMotionValue` + `useTransform` for overlay opacity â€” avoids React re-renders during drag.\n\n### 11.2 Bundle Optimization\n\n- Dynamic import `framer-motion` only in the `SwipeStack` component.\n- No server-side rendering needed for the swipe UI â€” render client-side with `\"use client\"`.\n- Use Next.js Image component for company logos with `priority` on the top card's logo.\n\n---\n\n## 12. Accessibility\n\nThe swipe interface must be fully usable **without gestures**.\n\n### 12.1 Keyboard Support\n\n| Key | Action |\n|---|---|\n| `â†’` Arrow Right | Like (same as â¤ button) |\n| `â†` Arrow Left | Pass (same as âœ• button) |\n| `â†‘` Arrow Up | Super Like (same as â­ button) |\n| `Z` | Undo last swipe |\n| `Enter` / `Space` | Like (when card is focused) |\n\nAdd a global `keydown` event listener on the home page.\n\n### 12.2 ARIA Labels\n\n```html\n<button aria-label=\"Pass this job\">âœ•</button>\n<button aria-label=\"Like this job\">â¤</button>\n<button aria-label=\"Super like this job\">â­</button>\n<button aria-label=\"Undo last swipe\" aria-disabled=\"true\">â†©</button>\n```\n\nThe card itself:\n```html\n<article\n  role=\"article\"\n  aria-label=\"{job.objective} at {company.name}\"\n  tabIndex={0}\n>\n```\n\n### 12.3 Reduced Motion\n\nRespect `prefers-reduced-motion`. When active:\n- Disable drag animations (cards still respond to button taps).\n- Use instant transitions instead of spring animations.\n- Disable celebration overlay animation (show static text instead).\n\n```typescript\nconst prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\nconst springConfig = prefersReducedMotion\n  ? { duration: 0 }\n  : { type: \"spring\", stiffness: 400, damping: 30 };\n```\n\n### 12.4 Touch Target Sizes\n\nAll interactive elements meet the WCAG 2.5.5 AAA minimum of **44Ã—44px** touch target size.\n\n- Action buttons: 56px and 64px diameter âœ“\n- Undo button: minimum 44Ã—44px âœ“\n- Skill chips: not interactive, no requirement\n\n---\n\n## Appendix A â€” Sample API Call\n\n```bash\ncurl -X POST \"https://search.torre.co/opportunities/_search?currency=USD&periodicity=yearly&lang=en&size=10&contextFeature=job_feed\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"and\": [\n      { \"status\": { \"code\": \"open\" } }\n    ]\n  }'\n```\n\n## Appendix B â€” Key File Summaries\n\n| File | Purpose |\n|---|---|\n| `packages/types/src/opportunity.ts` | All shared TypeScript types (Opportunity, Compensation, Skill, etc.) |\n| `packages/torre-client/src/client.ts` | `TorreClient` class with `searchOpportunities()` method |\n| `apps/api/app/api/opportunities/route.ts` | BFF route handler (validates input, calls TorreClient, returns JSON) |\n| `apps/web/store/swipeStore.ts` | Zustand store (queue, undo, celebration state) |\n| `apps/web/hooks/useSwipeQueue.ts` | Preloading logic, refill triggering |\n| `apps/web/hooks/useDragCard.ts` | Framer Motion drag state, threshold detection |\n| `apps/web/components/SwipeStack.tsx` | Renders top 3 cards with correct z-index/transforms |\n| `apps/web/components/JobCard.tsx` | Card UI (logo, title, salary, skills, tagline) |\n| `apps/web/components/ActionBar.tsx` | âœ• â¤ â­ buttons |\n| `apps/web/app/page.tsx` | Home page â€” composes all components, keyboard handler |\n\n## Appendix C â€” `@torre-swipe/torre-client` Interface\n\n```typescript\nexport class TorreClient {\n  constructor(private baseUrl: string) {}\n\n  async searchOpportunities(params: {\n    size?: number;\n    currency?: string;\n    periodicity?: string;\n    lang?: string;\n    contextFeature?: string;\n    keywords?: string;\n    language?: string;\n    fluency?: string;\n  }): Promise<{ total: number; size: number; results: Opportunity[] }>;\n}\n\nexport class TorreApiError extends Error {\n  constructor(\n    public status: number,\n    public body: string\n  ) {\n    super(`Torre API error ${status}: ${body}`);\n  }\n}\n```\n","numLines":1050,"startLine":1,"totalLines":1050}},"sourceToolAssistantUUID":"de30dbcc-8305-48ed-a2ce-3d66176b6850"}
{"parentUuid":"c2e9ebb8-c084-4e5b-b4dd-d1d3bb28d144","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01VQvJpQgt67raXipwkDKWAB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EFj6fs75th3AKAsw6a1HKX","name":"Read","input":{"file_path":"/Users/agurodriguez/Code/torre-ca/UI_SPEC.md"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1266,"cache_creation_input_tokens":298,"cache_read_input_tokens":23668,"output_tokens":123,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":298,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5UYtZP31Umy1sXqW7t","type":"assistant","uuid":"b2ea0b12-9999-44b1-8ce3-65991885ba3d","timestamp":"2026-02-26T17:30:44.326Z"}
{"parentUuid":"b2ea0b12-9999-44b1-8ce3-65991885ba3d","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EFj6fs75th3AKAsw6a1HKX","type":"tool_result","content":"     1â†’accent color: rgb(204,220,57)\n     2â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b1a18b22-eb87-4236-996f-9a5eb80493d0","timestamp":"2026-02-26T17:30:44.490Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/agurodriguez/Code/torre-ca/UI_SPEC.md","content":"accent color: rgb(204,220,57)\n","numLines":2,"startLine":1,"totalLines":2}},"sourceToolAssistantUUID":"b2ea0b12-9999-44b1-8ce3-65991885ba3d"}
{"parentUuid":"b1a18b22-eb87-4236-996f-9a5eb80493d0","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_011uSh6Bjij43wstEYdND4AU","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a clear picture. The spec (SPEC.md) defines which fields from the search API response are actually used. Let me compare what's in the response JSON vs what's used in the spec.\n\nFrom the JSON response, the available fields per result are:\n- `id`\n- `objective`\n- `slug`\n- `tagline`\n- `theme`\n- `type`\n- `opportunity`\n- `organizations[]` (id, hashedId, name, status, size, publicId, picture, theme)\n- `locations[]`\n- `timezones`\n- `remote`\n- `external`\n\n\n- `deadline`\n- `created`\n- `status`\n- `commitment`\n- `externalApplicationUrl`\n- `compensation` with nested data including amounts, currency, and hourly rates\n- `skills[]` with name, experience, and proficiency levels\n- `members[]`\n- `place` containing remote status, timezone, and location details\n- `questions[]`\n- `context` with application status information\n- `additionalCompensation[]`\n- `_meta` for ranking and scoring\n\nNow I'm cross-referencing this against what the spec actually uses for the card displayâ€”pulling the id for deduplication, objective as the job title, company info from organizations, locations formatted as comma-separated values, and compensation details filtered by visibility. The spec maps skills to chips showing the first three with an overflow indicator, uses the tagline for description, and pulls the slug for routing.\n\nLooking at what's in the JSON but not displayed on the cardâ€”there's theme, opportunity type, timezones, external flag, deadline, created date, status, and members that aren't being rendered. I notice type is defined in the TypeScript but the card actually uses commitment instead. The place object exists but only the top-level remote field gets used, not the nested remote property. Questions, context, and additional compensation fields are also unused in the current card mapping. Now I'm comparing what fields are actually rendered on the card versus what's available in the TypeScript specâ€”turns out only a subset like id, objective, organization details, locations, remote status, commitment, compensation, skills, tagline, and the external application URL are being displayed, while many other fields in the spec aren't used at all.","signature":"EtYbCkYICxgCKkCjQBX+TcTtr5wzyoDddJ2taRmt2BU989xqzNv3I2t9+GhOo7C/pdnA9+TYAlVJVNBy3gRXIKP/IJ26422u4ro+Egy9By8clbK6nOPJCwMaDNtvPcVe4seDDOKzuyIwbHniy1VDUtBz/W3FkHoGPBo/3xuqi6aNB53TaofHba4FOHJw8c6s7HrPp8zv1UAhKr0aiC0vR5EPSiFyQyOxS6IZb9SeICCYSK5/s1zmZ6PX7L7Xigv8CAxVGFzWh97JiJxgygaCTJegLNfvS3O8972LMnTsY0vEVI+514gTHSpjX7Aq062FEUteUi040NqnklkynwCJv9+eRBykt8JSqpdG/LiwC1CuOuBZN0YDyKLJYhCCcvYC5YrTW2DWSPR/TDMRzBBb8fo8oQfToyrPJEiYkVe/eYw5XADWtyNluOgTP5neS38OLQlmsqLILOl7eHwKxrDU/UuGx9chSX/Giey6Q6cdweHfIYRIxxKEUwjlk30TEIbh2/6r1t6J2KGPhB7HlSCOW/3ZGVEOvaw/AoNbKiFiRwsQLfSCq10l1heBTusmWsQ4mupKdPoFiom+oM10hpI4pXMgz+5BsY9zMi72ToKXBrAxnGdwMd/wi79dEZkm637abAYN8wbOSmubroujR5upZyFGsx4AXrKK1i36d+LRVDOzCOuDfHtsbQLk3Na3YHM5AeQksJ5cnqB8vqiKtoBYahQm1jc5pGrZQDMepw5pgM7kffGpJMfBeqGpH49/aAs1qD3/e6UHzLvKu2GVhiXD++w8IGbgLrLGAK96f8iMHWPUO65feNi2uqkLgtpjEOW73B0+dLsf9ewWBuqMq54pl4vjay8rFN/+0Pe0eoj8C7MruE6QTXsTPUmM6Ih9GMGdiSCyXSATFb44ktn4pb2mrNgiERjDxfKe6eTV39dTZvH8ceFI6o47iKnR4B0OvLdxANlu53CYZCoD1ORDUrGQslhyjsVZ+oMtpG/SDdDFlEQ7bFkWCe1N3RLZBbfBzerx+z9vHAPFVO3PS9eReOV4UuNCtrtvA6+AHWeVIU6OxSv8oPrJ8KRRLVDB4zmphj0uthGLeZb6BsGPDWczWKmxjZfi3sVP5jCncFi8lt1rqgBvVofWvLOEDjmh8CFDamA62bSW4iU/o/DbyeofSZrgqUD0vSY1E9lyYVpuKE2kO+SPo87dzTcY7csh7k3w0VQbPk6DDt1xwu3hs5YRxRGa60Zw+3CMrqJQAQCBGyN+FcRTlk80LgTYwGRQXVrnJtRZcwGQFmDqmaEZAeo/dCsIJrAZdW1HkiXyw0V5cMmmzGWVtPaaHMQOsef56E3Cq99jKenBw7lwd2KK56UpIzJmeOIcPAbr2cjxRlWVgeQyaRlO5g85nRviublIJzVrRtzFkmSJ86LbM3m16Tc0aiLjU/lFVGIlvxysO59j9FSLubPs+nY2ROBFE380uwJvV8pmiMQupb0z0IURzDzNU7M2LlFk/7n/jyEkU9UbWUxXQPnwpfCUd1e4yGz3ugNf+v8tK7gwqSj85r7SLXB6gSiVx+1+jIzco5f3/TpFGiCs/I3J448cmuRaD0UvQqOZ1yO+HqM0N4Pgq5hljPT/0izVizzKSeTCO07ZVJAB0KbcVDM2bmtCwwCe5Z8REpTzXBgAtm6DJHUnxFV603BvqRPJ8yp68nExJ5fFZNlwBI5rIx1BQy86w7f7r22KTs0YloIfBm9I8uBGzvjXNoX9PcnDQERJSKGNXthyt+wXtKKUtRpI+PeWvxz089Ace6RjPJ6Wyww10kCJLrM+IDxt6GUIGEGZ0e/t7guBhmwAeAj+smlqVGE+SxFIa7nRCu6gw+bA0F1k/yGp4rwfUnV5hcOe4GesV67UDUiH+mTW6ilG4M1B1fQKE3S2vwJ4mJ7Shmn8ClDvvubPah+T8E9JzEgdYqJL47sVUFTYD3t1w8rNNfnp80Nld/6JJ/7r//1GOmIvgp2OTXNBiAmNiy2km9XdQ5fFCnUFRRlU0E5Ywbhtxgn8mr6Bl4evO96vJIMDBMTAhJE1CePP9FXZ99nIzpGHKoyc+WscSc+7ug5M44PLgC7qiIj5hxSYdJF7cA8YQMeZ9wH4WHfxjW5lBsFvAJmdwnfO4IH5AXY75h/+7yoWymfvCE6zgN/Gtb1i0fdL4R96ADW8+Qexs/ibomVfZ0BfAAfFQShBrYydQll7i9JHTBCutoqWMxRDavbVOdtIhlP9wBdsyX1/iYnVSyAa9Y+9Xrn5EvlPi5x9qMmEQn5u4Qtv448DAeDdDymV6Q4Zxif+NukkgdE/byPFsZVI+l2BlWY9ck3zJ/AtNO771Mfhb0r6lt3SdcHoJ30SjoByAVuToc9Ul2plaY9uGROo1IGN0JG7fRnLC3IGeN/xeyaH6bIHB6gc4Lw1wvOaXyVUg/Oiln7xV71oeRJLSle2TwldRH/qG7y1V3wEde/gEOXpLQnopjSYd9r0oa+iAQt907F1AYtieKVwgus47a8OCvYp0fjBEugRKQGzAn6TEdAEvytl2WZykn3jCKIKtyGxlFy78cbi9SUdTTt1ljVb/FiMBIVTzWZS1gK4dkDflKs7aHWSq3imt8BjRfW6XuomTDtbGuqm4Ij6jTMjmH2WZuzV+5pabQH52JuEu0lov4La1AMP/xmsvMqPuMmf00N3tylt8RTHaZfu0/Vkh3M+PTIi7zqqD4sn591aXBv9ZnvFZXXhaTFKZ/Ajr+hJT1LKruwMvlMI4gcamDd4Qsp+3HC25Xmvim3pqAlNccM7GSKvPCyemDy5K7jcHreVhMFIy110KNB5O05TIkwoGZu3M+naZDAObQD7LfwJ+JKzzRl8DbEU5l/47lV+Zui1YzJ+YDTsXJ7UH+xYLBa+618m6p1C37LIWOpy6Udn2B/BWOkagN+sLIylCykyrdSySRR3GM6RN5DCdfrrfXjuszkMIS3tcMIEphQ27tWG/OE2ziJNWPClswsOViTxbnutKSRKPOnONoePDfVDeH4Xm7YPzueqiPqIV/CiOsx5L5PSierq81vOpkycy+Sos4jsPVASV3LMdhxyastccfbjv1kqjAYpY+rNzNbFFofqAZxOCD6BrqHu+xRE+KH9VDGdCjbpB8WZmtDq44cSCfA8/oA8An03bhtwYTK/Ff/P3TIv0k/MbrrP4l44HTXsBYUZhf1bUpPTikrNVCi03Xyu3VRhDORx9jJlmCa9C5Nh86YiCr4ZkpcbFLlHgz5vOs2j1Ti4u5UV4+bRCwqYrsCOHb/s4LuVYbMdBeYctuFeVEaV1NeJ2f4IToF2zj1mxAMsnWW/U/1fvlPh2AsEZU3hzdsoZICxAVpl4JZz3Q+9imCSO2NTn634l42ZJBQD1dFiFoW30z+VnvZyrju3TIqNo+qjIfvXnaHf+QR+bSRdc86DVBfqDaBThQVpP4rOj1iAEVE3jVOTr++FPPTBJp/SNTSm4spdN2MVsaGzHtBg8hefPtOzpseKale5orHj41egQLcgcK3JqOzcSyXFLEqlsZMBCcMNmyWA3LbhqDfDzDgGnyAZ+gnf6aQkqgv4FI6GAmB449U48paeHMoQWnpw9bjLNELOyXESA2AHyIJlJWbsjlb7ieqHvqCOaYUJAwIX/fqfH1iC/NqCNbT5FnahRs7TKD5tvHJZEZOIcTdky9pTBYNRo2DiFfX+Y86FQGefW8azCTbbz+Da2bm8Ns5b1phUTGTNlkxWAJi/SBLkXewCVzGaC1Ao4q8bBCWb1b7Wnb3tRv2laNzoxD4noFx/sD7/e+8B6gocn//EW/NfMOiyUFkMnU7vmo2Mfv1Y/ZtBhagZ3+CdXIGZqKOb6BNDa84XvNY1FJWSCJQSEai8OdiqsetaC7ZAm14HcBJvmJSJYYZ1SyTWIiNUNDEG9X1FpbWemW3cZeAYJ6gcnKsG9XVw2Xt4BAB0Gd58uOkX4WAdAMRLewarjy1YO8DfSzClhOR8xu6eP/pnJgtDHCU/TNVKWi/d62FTlZjH2Panv0ypp33zo8AQ5Jk9UzsKmi5Hwjswqc5A/PjqHcGUu3XQp9EK2kIEgbMiuPgzsQ4kyuP6ZE/a6MBW2sfJzCHYP1YHKIYwVqKGtmuSz53fm0x8o/Id5MTlTpryhs5KyPni1pAi3ROsjxBykrAYuk/+ArbUYNnKhDxcym+SplYn8FfYGFlP7dsFmjmWRTfmzSkHfx376u6eXWJPLnEwlkWq9TWEYlPqHjixQE3y32sWsUHa0Wjzod/GZ18YSKQ9dmIXchXxy1kQPSKhMIc5KsALySspNbW5aZ+sMb2MFSYyNWfeggi1dqc3UIo99iwP478gegNKmZlQBPyZp1ymuzPO9s7PepoKjpml1/ODm+524I+OeYvVydfkMPTEfRD/44QL+Mq71F4xtMRb0C6sy5+OjfmNrfgROuSxkBGB5p0dk43YiDAL6hrA9r5vGI02r2rMjtumKwjP9F4Dt4auMe8oRp7VB90nXI5laGWQERSHW1k7jkF4rvtfF6aaPena8glTxuKwzeBJwudPKiWxl1DZ/8K9A4wKeQmACZil8Prdt2tiBujFUehLASWRQ9F7r9S/9LbccSwnNcHhLG0uXx0h+DuRQbuLUMut7WmD5qWCfrECz5ez0vpemGU4KUIltSJfyn16OuJw2xt+vH3+v4FYojwZW0CM00JIYfFS5Emby5VzvHC9lFojNZ1E9KIgpJEvslgYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":15765,"cache_read_input_tokens":23966,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":15765},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5UiwYfqEscYXtnU8nS","type":"assistant","uuid":"5e1d56a1-ecdc-4577-835d-37b6a4f1d2a3","timestamp":"2026-02-26T17:31:09.939Z"}
{"parentUuid":"5e1d56a1-ecdc-4577-835d-37b6a4f1d2a3","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_011uSh6Bjij43wstEYdND4AU","type":"message","role":"assistant","content":[{"type":"text","text":"Here's a breakdown of what the spec actually uses from the search response, vs what's available but ignored:\n\n---\n\n## Fields Used in the Spec\n\n| API field | Where used |\n|---|---|\n| `id` | Deduplication (`seenIds` Set + localStorage) |\n| `objective` | Card title |\n| `organizations[0].name` | Company name on card |\n| `organizations[0].picture` | Company logo (preloaded via `new Image()`) |\n| `locations[]` | Joined with `\", \"` on card |\n| `remote` | Remote badge on card |\n| `commitment` | Commitment label on card |\n| `tagline` | Tagline text on card (3 lines max) |\n| `externalApplicationUrl` | Opened in new tab on LIKE or SUPER LIKE |\n| `skills[].name` | Skill chips (first 3 + overflow count) |\n| `compensation.visible` | Whether to show salary or \"Salary not disclosed\" |\n| `compensation.data.code` | `\"range\"` vs `\"fixed\"` formatting logic |\n| `compensation.data.currency` | Salary display |\n| `compensation.data.minAmount` | Salary display |\n| `compensation.data.maxAmount` | Salary display (range only) |\n| `compensation.data.periodicity` | Salary display (`/ year`, etc.) |\n\n---\n\n## Fields Available but NOT Used\n\n| API field | Reason ignored |\n|---|---|\n| `slug` | Included in the TS type but never rendered or linked |\n| `theme` | Unused |\n| `type` | (`full-time-employment`, etc.) â€” `commitment` is used instead |\n| `opportunity` | (`employee` / `freelancer`) â€” not shown |\n| `timezones` | Not shown |\n| `external` | Boolean flag not consumed |\n| `deadline` | Not shown |\n| `created` | Not shown |\n| `status` | Filtered server-side (`open` only), not used client-side |\n| `members[]` | Always empty in sample, not used |\n| `place` | The whole `place` object â€” `remote` from the root is used instead |\n| `questions[]` | Not used |\n| `context` | Not used |\n| `additionalCompensation[]` | Not used |\n| `additionalCompensationDetails` | Not used |\n| `_meta` | Rank/scorer scoring data â€” not used |\n| `compensation.data.minHourlyUSD` | Not used |\n| `compensation.data.maxHourlyUSD` | Not used |\n| `compensation.data.negotiable` | Not used |\n| `compensation.data.conversionRateUSD` | Not used |\n| `skills[].experience` | Only `.name` is used for chips |\n| `skills[].proficiency` | Only `.name` is used for chips |\n| `organizations[].id/hashedId/status/size/publicId/theme` | Only `.name` and `.picture` used |\n\n---\n\n**Summary:** The spec uses about **15 out of ~40+ available fields** â€” focused on what's needed to render the card (identity, company, salary, location, skills) and to act on it (external URL). The scoring metadata (`_meta`), most org fields, `place`, and skill attributes beyond name are all discarded."}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":15765,"cache_read_input_tokens":23966,"output_tokens":1836,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":15765,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5UiwYfqEscYXtnU8nS","type":"assistant","uuid":"361a22dc-e242-47a5-906a-6d41aab2ab7c","timestamp":"2026-02-26T17:31:21.127Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-26T17:34:56.302Z","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-26T17:34:56.303Z","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3"}
{"type":"file-history-snapshot","messageId":"0eaa28b8-76d3-4a12-81c4-9e963c41278c","snapshot":{"messageId":"0eaa28b8-76d3-4a12-81c4-9e963c41278c","trackedFileBackups":{},"timestamp":"2026-02-26T17:34:56.342Z"},"isSnapshotUpdate":false}
{"parentUuid":"361a22dc-e242-47a5-906a-6d41aab2ab7c","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_011xvcps7ePWMz4URxccfTeP","parentToolUseID":"toolu_011xvcps7ePWMz4URxccfTeP","uuid":"62309c57-2137-45bc-9ca0-4fc2c8927ca7","timestamp":"2026-02-26T17:30:33.225Z"}
{"parentUuid":"62309c57-2137-45bc-9ca0-4fc2c8927ca7","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","parentToolUseID":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","uuid":"e806ac60-9f88-4c23-b7a7-0d4ecbefe421","timestamp":"2026-02-26T17:30:35.995Z"}
{"parentUuid":"e806ac60-9f88-4c23-b7a7-0d4ecbefe421","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","toolUseID":"toolu_01XMn8Lt52wgwW9cbjEAgETJ","timestamp":"2026-02-26T17:30:36.013Z","uuid":"127345b0-9cdc-4a9c-82f3-2ea0323563ce"}
{"parentUuid":"127345b0-9cdc-4a9c-82f3-2ea0323563ce","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_015t9P83m4stqD91MargGDyq","parentToolUseID":"toolu_015t9P83m4stqD91MargGDyq","uuid":"286593fb-986b-4646-a6b4-3259f1e1ac6f","timestamp":"2026-02-26T17:30:36.116Z"}
{"parentUuid":"286593fb-986b-4646-a6b4-3259f1e1ac6f","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015t9P83m4stqD91MargGDyq","toolUseID":"toolu_015t9P83m4stqD91MargGDyq","timestamp":"2026-02-26T17:30:36.125Z","uuid":"f03a2808-70d1-45c0-b8f7-dfe93c026b1d"}
{"parentUuid":"f03a2808-70d1-45c0-b8f7-dfe93c026b1d","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_015vudtXfZkVa3metzSVtQAC","parentToolUseID":"toolu_015vudtXfZkVa3metzSVtQAC","uuid":"678ab0d7-1e17-4562-97f2-e7be3fe9499a","timestamp":"2026-02-26T17:30:40.956Z"}
{"parentUuid":"678ab0d7-1e17-4562-97f2-e7be3fe9499a","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015vudtXfZkVa3metzSVtQAC","toolUseID":"toolu_015vudtXfZkVa3metzSVtQAC","timestamp":"2026-02-26T17:30:41.040Z","uuid":"6d965493-2df6-4644-9b2a-021239e3f75b"}
{"parentUuid":"6d965493-2df6-4644-9b2a-021239e3f75b","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_01Wf4RbgrdvbrZ39kBQ4CkwE","toolUseID":"toolu_01Wf4RbgrdvbrZ39kBQ4CkwE","timestamp":"2026-02-26T17:30:42.243Z","uuid":"6c1fb202-9bf2-4d4a-8ca5-13c7597538ef"}
{"parentUuid":"6c1fb202-9bf2-4d4a-8ca5-13c7597538ef","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_011XDgt9rByyywWgrBwCG2WN","parentToolUseID":"toolu_011XDgt9rByyywWgrBwCG2WN","uuid":"880c6e52-719e-480d-8bee-61eb4d4a4f3e","timestamp":"2026-02-26T17:30:43.967Z"}
{"parentUuid":"880c6e52-719e-480d-8bee-61eb4d4a4f3e","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_011XDgt9rByyywWgrBwCG2WN","toolUseID":"toolu_011XDgt9rByyywWgrBwCG2WN","timestamp":"2026-02-26T17:30:44.242Z","uuid":"1ee7007a-7db2-4417-99fe-a72d6c1d87ac"}
{"parentUuid":"1ee7007a-7db2-4417-99fe-a72d6c1d87ac","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01EFj6fs75th3AKAsw6a1HKX","parentToolUseID":"toolu_01EFj6fs75th3AKAsw6a1HKX","uuid":"f7b058f3-caa4-4956-b705-7ad25fb0efa8","timestamp":"2026-02-26T17:30:44.331Z"}
{"parentUuid":"f7b058f3-caa4-4956-b705-7ad25fb0efa8","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01EFj6fs75th3AKAsw6a1HKX","toolUseID":"toolu_01EFj6fs75th3AKAsw6a1HKX","timestamp":"2026-02-26T17:30:44.491Z","uuid":"d5c28949-4f36-475c-b45b-e61ac08830d4"}
{"parentUuid":"d5c28949-4f36-475c-b45b-e61ac08830d4","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 1 to 5 from Untitled-2:\nPlease modify the SPEC.md in this way:\n\n - Make sure the persistent logic uses a Strategy pattern so we can easily change that in the future to store data in a database for example (implementation of other storage strategies is out of scope)\n - Let's mark 'Testing (e2e)' as something to do in the future\n \n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"Please modify the SPEC.md in this way:\n\n - Make sure the persistent logic uses a Strategy pattern so we can easily change that in the future to store data in a database for example (implementation of other storage strategies is out of scope)\n - Let's mark 'Testing (e2e)' as something to do in the future"}]},"uuid":"0eaa28b8-76d3-4a12-81c4-9e963c41278c","timestamp":"2026-02-26T17:34:56.339Z","permissionMode":"default"}
{"parentUuid":"0eaa28b8-76d3-4a12-81c4-9e963c41278c","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_015g3UtUMDh1asW4PwGbJ6RV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to modify SPEC.md to:\n1. Update the persistence logic to use a Strategy pattern (so it can be swapped for different storage backends in the future)\n2. Mark 'Testing (e2e)' as future work\n\nLet me re-read the relevant sections of SPEC.md to understand what needs changing.\n\nI already have the full SPEC.md content. Let me identify the sections to change:\n\n1. **Persistence logic** - Section 7.2 (`localStorage`) - needs to become a Strategy pattern description\n2. **E2E Testing** - Section 9.3 - needs to be marked as \"future work\"\n\n\nAlso the Table of Contents and tech stack mention Playwright for e2e, so I'll need to update those references too. I'm planning to introduce a `StorageStrategy` interface with a `LocalStorageStrategy` implementation, then update the store and hooks to use this abstraction. For the e2e testing section, I'll mark it as future work or out of scope for v1.","signature":"EqMJCkYICxgCKkDku2J9Nf5F2oI4QOhMxJkYbfbqu8dKPf5DVRTvDztnEg9ICt/P6fIUx+eTWxHaWyq3JD0Q3L/9c15b+sQbJgnvEgwTXucGhbK8Mls9huoaDPTG9slfURKpalhOGiIweE53U1CYb8U58aH0q0xoGzCAUYE+nHBvjRtxvh5+kelYzjN6Sqla+srEXUrD5VopKooINAOfSC7jNpnMwzf4CQKI5/NNXxo0xz+EAHdLme9F0ZT7npfAzqkrFwBcdBd9ysEIK72y7inW+knJf8IpDEncT8AHYXNWWH2IEzg55qjzfl84UP7KaUr9rsYPA3QOtn42l1q7ovMM87dAIGCK2rvpX0g/S5RRsAg4bpwGSfWI863QTbJHX97HucFtnwIoJzaXyalnKHX6MT+0UwbdnN+mWC8TUGNM4PD8sn5XcY7zexJ06QLRlsoW9iMygQ2VRtoJwWVLhqQR34oURmTNBpoZPVAKt8HQzrLWOGrK0r4b2nF5zjiNHy/Ol9qSyUzd63GSfuvMcO07iD630GVSPrmyZ9Dctdf7ArkD7uhI3z9qtjHvSDlsI8MxTroBl1sRIxSNr5d9/qtcMm40m8VkM+vOdnUYOabV38yiaZFsNsqxAyDQg0KlJY0MgSf6gFYakO7pN4nuGOnK8A/fClZG8c6vtg71GiT5CNmKxmg87vWx+gc5eQwqYjdyJJ7raoIO8rK0X3ukfrg5V5f/VchSpABsGiuZlKe7MbRL8nBGsythTke//WcnWfczZA+biW1aXG7AhYgihLxhVsKkpznKj1rGzIT2z+S3OBuEq8Mp1Y4CRfmlWtaQ3wxbsFck6J0nnZ26apJMYIdSKwxPTSpNspJjljQ7F092kEEh8htdICxLU2IPbOigeFko0QCUtB4WDr0uzcBpdzhf1Yr7tmk11b75wmvuUv+kMyQHVcoMIxl9B3+DEgHD29Qs+bqX1lHmGGMJ9Ft5avYyvAmaCQ8zwvYVFf1iid5LzVIQSJDsbRbTrzaRR1ATx/pcsdoxP1S0AQ07jhETXwzZ8Pt7MmifTjXg583lKRVZFvby9Nw0XsLYNVMni8vAi+AFqhBqMmwT+82Csy+HmuVT78pAa+2xFAKyXUr2Iugrr/PMw8/kQvOpBj/GwPSU2XDNvsIypNPzSDK91BFjru06EG62n1HkDA9p+G1m00M+o2ifhWKEgLSncKf+5RJN4yEr7y7CH6v6cGLaidvfDpcWSR+8iB6KOXtQ5Z6lH7RuOos4CBHJFT3flIvYtMqNtoWTgUMPkpmBopY7pGBJXiioZfbDwtK1+qKj9IGl1jjeQOv1RWEaf0JBIjEA0HsCpDVaUC2ZHsdchsRFFp9gIpIr+/QtFTbuz4dJIVzoaQTy9kMJ4GNk8aqRfwcdwU3yOYFWFFJ1RmMfM8DjNeJ/DkD1s8f/t6whw9DB9PuVX8o3C/X29JAEzQ860eNkRMqxaKPorG5W3CEqGqfCsQ9fvjDFxT9/xbPSDV8T+CC+CNMuFGkNrR8h30OwPNEi7ZvuCNyN5AQKC2aCiXMu19CT5RzfMVyhX0TcVHef3EuPJldpOV3qyZIYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2098,"cache_read_input_tokens":39731,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2098},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5oHc5TUdwncL4EV87m","type":"assistant","uuid":"036c3f4b-5e38-44de-aec4-f317bdb19b93","timestamp":"2026-02-26T17:35:08.312Z"}
{"parentUuid":"036c3f4b-5e38-44de-aec4-f317bdb19b93","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_015g3UtUMDh1asW4PwGbJ6RV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0151wu9zd3zFtt9EUw7gv9S9","name":"TodoWrite","input":{"todos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"in_progress","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"pending","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2098,"cache_read_input_tokens":39731,"output_tokens":427,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2098,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5oHc5TUdwncL4EV87m","type":"assistant","uuid":"155bc950-1546-4279-8941-8071af777d29","timestamp":"2026-02-26T17:35:08.838Z"}
{"parentUuid":"155bc950-1546-4279-8941-8071af777d29","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0151wu9zd3zFtt9EUw7gv9S9","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"9e84e3a1-3589-465c-8c1f-df75aaadc13c","timestamp":"2026-02-26T17:35:08.864Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"in_progress","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"pending","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"sourceToolAssistantUUID":"155bc950-1546-4279-8941-8071af777d29"}
{"parentUuid":"9e84e3a1-3589-465c-8c1f-df75aaadc13c","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_017775tUJnDznfyax9aQFYph","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TfXEaAxaPFq9Smb9NiuNY2","name":"Edit","input":{"replace_all":false,"file_path":"/Users/agurodriguez/Code/torre-ca/SPEC.md","old_string":"### 7.2 Persistence (`localStorage`)\n\nPersist only `seenIds` across sessions to avoid re-showing swiped jobs:\n\n```typescript\n// On store init\nconst stored = localStorage.getItem(\"torre_seen_ids\");\nconst seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();\n\n// After each swipe\nlocalStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));\n```\n\nCap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.","new_string":"### 7.2 Persistence â€” Storage Strategy\n\nPersistence is abstracted behind a `StorageStrategy` interface so the underlying storage mechanism (localStorage, a remote database, etc.) can be swapped without touching the store or queue logic.\n\n```typescript\n// packages/types/src/storage.ts\n\nexport interface StorageStrategy {\n  /** Load the set of already-seen opportunity IDs. */\n  loadSeenIds(): Promise<Set<string>>;\n  /** Persist the updated set of seen IDs. */\n  saveSeenIds(ids: Set<string>): Promise<void>;\n}\n```\n\n**Provided implementation â€” `LocalStorageStrategy`:**\n\n```typescript\n// packages/torre-client/src/storage/LocalStorageStrategy.ts\n\nconst KEY = \"torre_seen_ids\";\nconst MAX_ENTRIES = 500;\n\nexport class LocalStorageStrategy implements StorageStrategy {\n  async loadSeenIds(): Promise<Set<string>> {\n    const raw = localStorage.getItem(KEY);\n    return raw ? new Set<string>(JSON.parse(raw)) : new Set<string>();\n  }\n\n  async saveSeenIds(ids: Set<string>): Promise<void> {\n    let entries = [...ids];\n    // Cap at MAX_ENTRIES, dropping the oldest (head of the array)\n    if (entries.length > MAX_ENTRIES) {\n      entries = entries.slice(entries.length - MAX_ENTRIES);\n    }\n    localStorage.setItem(KEY, JSON.stringify(entries));\n  }\n}\n```\n\n**Wiring the strategy into the store:**\n\nThe `StorageStrategy` instance is injected at app bootstrap and passed to the Zustand store initializer. This keeps the store agnostic about _how_ data is saved.\n\n```typescript\n// apps/web/app/page.tsx (bootstrap)\nimport { LocalStorageStrategy } from \"@torre-swipe/torre-client\";\nimport { initSwipeStore } from \"../store/swipeStore\";\n\nconst storage = new LocalStorageStrategy();\ninitSwipeStore(storage); // loads seenIds asynchronously before first render\n```\n\n```typescript\n// apps/web/store/swipeStore.ts (excerpt)\ntype SwipeStore = {\n  // ...existing fields...\n  storage: StorageStrategy;\n};\n\nexport function initSwipeStore(storage: StorageStrategy) {\n  storage.loadSeenIds().then(ids => {\n    useSwipeStore.setState({ seenIds: ids, storage });\n  });\n}\n\n// Inside the `swipe` action â€” persist after every swipe:\nswipe: (action) => {\n  set(state => {\n    const newSeenIds = new Set(state.seenIds).add(state.queue[0].id);\n    state.storage.saveSeenIds(newSeenIds); // fire-and-forget\n    return { /* updated queue, seenIds, etc. */ };\n  });\n}\n```\n\n> **Out of scope:** Implementing additional strategies (e.g., a REST/database-backed strategy) is explicitly deferred. The interface above is the extension point.\n\nDo **not** persist the queue itself â€” always re-fetch on page load."},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":468,"cache_read_input_tokens":41829,"output_tokens":1005,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":468,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5pDDBcLhaxoVKbcCoU","type":"assistant","uuid":"5499048a-a3f8-4c02-a98e-d35c5e773666","timestamp":"2026-02-26T17:35:35.224Z"}
{"type":"file-history-snapshot","messageId":"5499048a-a3f8-4c02-a98e-d35c5e773666","snapshot":{"messageId":"0eaa28b8-76d3-4a12-81c4-9e963c41278c","trackedFileBackups":{"SPEC.md":{"backupFileName":"0115992eaee6cd07@v1","version":1,"backupTime":"2026-02-26T17:35:43.178Z"}},"timestamp":"2026-02-26T17:34:56.342Z"},"isSnapshotUpdate":true}
{"parentUuid":"5499048a-a3f8-4c02-a98e-d35c5e773666","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TfXEaAxaPFq9Smb9NiuNY2","type":"tool_result","content":"The file /Users/agurodriguez/Code/torre-ca/SPEC.md has been updated successfully."}]},"uuid":"b4bc01b5-c64b-42a7-b7c3-4e27fc01b939","timestamp":"2026-02-26T17:35:43.349Z","toolUseResult":{"filePath":"/Users/agurodriguez/Code/torre-ca/SPEC.md","oldString":"### 7.2 Persistence (`localStorage`)\n\nPersist only `seenIds` across sessions to avoid re-showing swiped jobs:\n\n```typescript\n// On store init\nconst stored = localStorage.getItem(\"torre_seen_ids\");\nconst seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();\n\n// After each swipe\nlocalStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));\n```\n\nCap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.","newString":"### 7.2 Persistence â€” Storage Strategy\n\nPersistence is abstracted behind a `StorageStrategy` interface so the underlying storage mechanism (localStorage, a remote database, etc.) can be swapped without touching the store or queue logic.\n\n```typescript\n// packages/types/src/storage.ts\n\nexport interface StorageStrategy {\n  /** Load the set of already-seen opportunity IDs. */\n  loadSeenIds(): Promise<Set<string>>;\n  /** Persist the updated set of seen IDs. */\n  saveSeenIds(ids: Set<string>): Promise<void>;\n}\n```\n\n**Provided implementation â€” `LocalStorageStrategy`:**\n\n```typescript\n// packages/torre-client/src/storage/LocalStorageStrategy.ts\n\nconst KEY = \"torre_seen_ids\";\nconst MAX_ENTRIES = 500;\n\nexport class LocalStorageStrategy implements StorageStrategy {\n  async loadSeenIds(): Promise<Set<string>> {\n    const raw = localStorage.getItem(KEY);\n    return raw ? new Set<string>(JSON.parse(raw)) : new Set<string>();\n  }\n\n  async saveSeenIds(ids: Set<string>): Promise<void> {\n    let entries = [...ids];\n    // Cap at MAX_ENTRIES, dropping the oldest (head of the array)\n    if (entries.length > MAX_ENTRIES) {\n      entries = entries.slice(entries.length - MAX_ENTRIES);\n    }\n    localStorage.setItem(KEY, JSON.stringify(entries));\n  }\n}\n```\n\n**Wiring the strategy into the store:**\n\nThe `StorageStrategy` instance is injected at app bootstrap and passed to the Zustand store initializer. This keeps the store agnostic about _how_ data is saved.\n\n```typescript\n// apps/web/app/page.tsx (bootstrap)\nimport { LocalStorageStrategy } from \"@torre-swipe/torre-client\";\nimport { initSwipeStore } from \"../store/swipeStore\";\n\nconst storage = new LocalStorageStrategy();\ninitSwipeStore(storage); // loads seenIds asynchronously before first render\n```\n\n```typescript\n// apps/web/store/swipeStore.ts (excerpt)\ntype SwipeStore = {\n  // ...existing fields...\n  storage: StorageStrategy;\n};\n\nexport function initSwipeStore(storage: StorageStrategy) {\n  storage.loadSeenIds().then(ids => {\n    useSwipeStore.setState({ seenIds: ids, storage });\n  });\n}\n\n// Inside the `swipe` action â€” persist after every swipe:\nswipe: (action) => {\n  set(state => {\n    const newSeenIds = new Set(state.seenIds).add(state.queue[0].id);\n    state.storage.saveSeenIds(newSeenIds); // fire-and-forget\n    return { /* updated queue, seenIds, etc. */ };\n  });\n}\n```\n\n> **Out of scope:** Implementing additional strategies (e.g., a REST/database-backed strategy) is explicitly deferred. The interface above is the extension point.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.","originalFile":"# Torre Swipe â€” Product & Technical Specification\n\n> Hand this document to an LLM and say **\"build this\"** to get a complete, production-ready implementation.\n\n---\n\n## Table of Contents\n\n1. [Product Overview](#1-product-overview)\n2. [Core User Flow](#2-core-user-flow)\n3. [Home Screen Specification](#3-home-screen-specification)\n4. [Background Preloading Strategy](#4-background-preloading-strategy)\n5. [Torre API Integration](#5-torre-api-integration)\n6. [Monorepo Architecture](#6-monorepo-architecture)\n7. [State Management](#7-state-management)\n8. [Tech Stack](#8-tech-stack)\n9. [Test Requirements](#9-test-requirements)\n10. [API Contract (BFF)](#10-api-contract-bff)\n11. [Performance Requirements](#11-performance-requirements)\n12. [Accessibility](#12-accessibility)\n\n---\n\n## 1. Product Overview\n\n**Torre Swipe** is a mobile-first web application that lets job seekers discover Torre.ai job opportunities through a Tinder-style swipe interface. Users swipe right to like a job, left to pass, and up to super-like. Liked and super-liked jobs open the external application URL in a new tab.\n\n**Primary user:** A job seeker on a mobile browser who wants a fast, low-friction way to browse and shortlist job opportunities.\n\n**Why it works:** Traditional job boards require deliberate search queries. Torre Swipe surfaces opportunities serendipitously, making job discovery feel effortless and even fun. The swipe mechanic creates a lightweight commitment signal â€” a flick of the thumb â€” that lowers the psychological cost of engaging with each posting.\n\n**Non-goals (out of scope):**\n- User accounts or authentication\n- Persistent match history beyond `localStorage`\n- Full application flow within the app (redirects to external URLs)\n- Employer-facing features\n\n---\n\n## 2. Core User Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  1. User opens app (mobile browser)                 â”‚\nâ”‚     â†’ Skeleton loading cards appear instantly       â”‚\nâ”‚     â†’ First batch of jobs fetched from BFF          â”‚\nâ”‚                                                     â”‚\nâ”‚  2. Swipe loop (repeated until empty state)         â”‚\nâ”‚     a. Top card is the current job                  â”‚\nâ”‚     b. User swipes or taps a button:                â”‚\nâ”‚        â€¢ Right / â¤  â†’ LIKE  (opens ext. URL)       â”‚\nâ”‚        â€¢ Left  / âœ•  â†’ PASS  (discard)              â”‚\nâ”‚        â€¢ Up    / â­ â†’ SUPER LIKE (opens ext. URL)  â”‚\nâ”‚     c. Card animates off screen                     â”‚\nâ”‚     d. Next card slides up to become top            â”‚\nâ”‚     e. Preloader ensures next cards are ready       â”‚\nâ”‚                                                     â”‚\nâ”‚  3. Undo                                            â”‚\nâ”‚     â†’ One-level undo brings last swiped card back  â”‚\nâ”‚                                                     â”‚\nâ”‚  4. Empty state                                     â”‚\nâ”‚     â†’ \"You've seen all jobs!\" message + Refresh CTA â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Swipe Actions Detail\n\n| Action | Gesture | Button | Effect |\n|--------|---------|--------|--------|\n| LIKE   | Swipe right | â¤ (heart) | Opens `externalApplicationUrl` in new tab; card exits right |\n| PASS   | Swipe left  | âœ• (cross) | Discards; card exits left |\n| SUPER LIKE | Swipe up | â­ (star) | Opens `externalApplicationUrl` in new tab; card exits upward; shows celebration overlay |\n\n---\n\n## 3. Home Screen Specification\n\nThe home screen is the **only screen**. There is no navigation, no search page, no profile page.\n\n### 3.1 Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Torre Swipe          [undo â†©]    â”‚  â† Header (48px)\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                    â”‚\nâ”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\nâ”‚    â”Œâ”€â”¤   Card (top)     â”œâ”€â”        â”‚\nâ”‚  â”Œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”      â”‚\nâ”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â† Card stack area\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜     â”‚    (fills remaining height)\nâ”‚                                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚      [âœ•]        [â¤]       [â­]    â”‚  â† Action buttons (80px)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3.2 Card Anatomy\n\nEach job card is a rounded rectangle (border-radius: 16px) with a white background and a subtle drop shadow. Content from top to bottom:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [Company Logo 56Ã—56]              â”‚  â† rounded, 4px shadow\nâ”‚  Company Name            [Remote]  â”‚  â† body-sm, gray-500 | badge\nâ”‚                                    â”‚\nâ”‚  Job Title (2 lines max)           â”‚  â† heading-lg, semibold\nâ”‚                                    â”‚\nâ”‚  ğŸ’° $164k â€“ $246k / year          â”‚  â† compensation (if visible)\nâ”‚  ğŸ“ United States Â· Remote        â”‚  â† location + remote badge\nâ”‚  ğŸ• Full-time                     â”‚  â† commitment\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  Tagline text (3 lines max,        â”‚  â† body-sm, gray-600\nâ”‚  ellipsized)                       â”‚\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  [Figma] [React.js] [CSS] +4      â”‚  â† skill chips (max 3 shown)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Card data mapping:**\n\n| UI element | API field | Fallback |\n|---|---|---|\n| Company logo | `organizations[0].picture` | Generic building icon |\n| Company name | `organizations[0].name` | \"Unknown Company\" |\n| Job title | `objective` | â€” |\n| Salary | `compensation.data` (if `visible: true`) | \"Salary not disclosed\" |\n| Location | `locations[]` joined with `, ` | \"Location not specified\" |\n| Remote badge | `remote === true` | hidden |\n| Commitment | `commitment` | hidden |\n| Tagline | `tagline` | hidden |\n| Skills | `skills[].name` (first 3) | hidden if empty |\n| Overflow | `skills.length - 3` shown as `+N` | hidden |\n\n**Salary formatting:**\n\n- If `compensation.visible === false`: show \"Salary not disclosed\"\n- If `code === \"range\"`: `$${formatK(minAmount)} â€“ $${formatK(maxAmount)} / ${periodicity}`\n- If `code === \"fixed\"`: `$${formatK(minAmount)} / ${periodicity}`\n- `formatK`: amounts â‰¥ 1000 shown as `Xk` (e.g., `164000` â†’ `$164k`)\n\n**Skill chip colors:** Use a deterministic color from a pastel palette based on skill name hash (so the same skill always gets the same color).\n\n### 3.3 Card Stack Visual\n\nAlways render exactly **3 cards** (or fewer if fewer remain). Cards are layered with CSS `z-index`. The back cards are purely decorative â€” they show the card background/shadow only, not full content.\n\n| Position | z-index | Transform | Opacity |\n|---|---|---|---|\n| Top (active) | 30 | `scale(1)` `translateY(0)` | 1.0 |\n| Middle | 20 | `scale(0.97)` `translateY(10px)` | 1.0 |\n| Back | 10 | `scale(0.94)` `translateY(20px)` | 1.0 |\n\nApply transforms via CSS `transform` (not layout properties) for GPU compositing.\n\n### 3.4 Swipe Gesture & Overlay Stamps\n\n**Drag behavior:**\n- Card follows the pointer/touch position (CSS `transform: translate(x, y) rotate(Î¸)`).\n- Rotation: `Î¸ = x * 0.08` (degrees), clamped to Â±20Â°.\n- Overlay stamp opacity: `Math.min(Math.abs(x) / 80, 1)` for horizontal, `Math.min(-y / 80, 1)` for upward.\n\n**Overlay stamps (shown while dragging):**\n\n| Direction | Text | Color | Position |\n|---|---|---|---|\n| Right | **LIKE** | `#4CAF50` (green) | top-left of card, rotated -20Â° |\n| Left | **NOPE** | `#F44336` (red) | top-right of card, rotated 20Â° |\n| Up | **SUPER** | `#2196F3` (blue) | center of card |\n\nStamps use a bordered label style: 3px solid border, uppercase, bold, 28px font.\n\n**Throw threshold:** If the user releases the card with `|x| > 100px` or `y < -100px`, animate the card off screen. Otherwise spring back to center.\n\n**Exit animations (spring physics):**\n- Right exit: `x` â†’ `window.innerWidth + 300`, slight upward arc\n- Left exit: `x` â†’ `-(window.innerWidth + 300)`, slight upward arc\n- Up exit: `y` â†’ `-(window.innerHeight + 300)`\n- Spring config: `{ stiffness: 400, damping: 30 }` (Framer Motion defaults)\n\n### 3.5 Action Buttons\n\nThree circular buttons centered horizontally in the action bar:\n\n```\n[âœ• 56px red/pink]   [â¤ 64px green]   [â­ 56px blue/gold]\n```\n\n- âœ• (Pass): diameter 56px, border 2px `#F44336`, icon `#F44336`\n- â¤ (Like): diameter 64px, bg `#4CAF50`, icon white â€” slightly larger as primary CTA\n- â­ (Super): diameter 56px, border 2px `#2196F3`, icon `#FFC107` (gold star)\n\nTapping a button triggers the same exit animation as a full swipe gesture. Buttons are disabled (opacity 0.4, pointer-events none) during a card exit animation.\n\n### 3.6 Undo Button\n\nLocated in the top-right of the header. Shows a back-arrow icon (â†©).\n\n- Enabled only if there is a previous card in the undo stack (max depth: 1 â€” only the most recent swipe can be undone).\n- Tapping it brings the last card back to the top of the stack with a reverse spring animation (card flies in from the direction it exited).\n- After undo, the button becomes disabled again until the next swipe.\n\n### 3.7 Super Like Celebration\n\nWhen a super like fires (gesture or button):\n1. Card exits upward.\n2. A full-screen overlay fades in (semi-transparent dark bg).\n3. Center: animated star burst (CSS keyframes) with text **\"Super Like! ğŸŒŸ\"**.\n4. Auto-dismisses after 1.5s, or user can tap anywhere to dismiss early.\n\n### 3.8 Loading Skeleton\n\nShown in place of the card stack while the first fetch is in flight.\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [â–‘â–‘â–‘â–‘ 56Ã—56 circle]               â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘               â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nSkeleton elements use a shimmer animation (gradient sweep left-to-right, 1.5s infinite).\n\n### 3.9 Empty State\n\nWhen the card queue is exhausted:\n\n```\n        ğŸ‰\n\n   You've seen all jobs!\n\n   Check back later or broaden\n   your search.\n\n   [  Refresh  ]\n```\n\n\"Refresh\" re-triggers the API fetch (with a fresh random offset/seed so different results may appear).\n\n---\n\n## 4. Background Preloading Strategy\n\nThe app must **never show a loading spinner** after the initial skeleton load. Achieve this by maintaining a buffer of pre-fetched cards.\n\n### 4.1 Queue Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  DISPLAY QUEUE (cards ready to show)                     â”‚\nâ”‚  [card_1] [card_2] [card_3] [card_4] [card_5] ...       â”‚\nâ”‚      â†‘ top card shown                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â†“ fetch triggered when size < REFILL_THRESHOLD\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FETCH IN FLIGHT (background, non-blocking)              â”‚\nâ”‚  next batch of 10 cards from BFF                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Constants:**\n\n| Constant | Value | Meaning |\n|---|---|---|\n| `INITIAL_FETCH_SIZE` | 20 | Cards fetched on first load |\n| `REFILL_SIZE` | 10 | Cards fetched per refill |\n| `REFILL_THRESHOLD` | 5 | Trigger refill when queue drops below this |\n| `MAX_QUEUE_SIZE` | 50 | Cap to avoid unbounded memory |\n\n### 4.2 Deduplication\n\nTrack all seen `id` values in a `Set<string>` (persisted in `localStorage` under `torre_seen_ids`). When appending new cards from a fetch, filter out any whose `id` is already in the seen set. Add swiped card IDs to the set immediately on swipe (before the exit animation completes).\n\n### 4.3 Image Preloading\n\nAfter cards are added to the queue, preload company logo images for the next 5 cards using `new Image()` instances so images are in browser cache when cards render.\n\n```typescript\nfunction preloadImages(cards: Opportunity[], count = 5) {\n  cards.slice(0, count).forEach(card => {\n    const url = card.organizations[0]?.picture;\n    if (url) {\n      const img = new Image();\n      img.src = url;\n    }\n  });\n}\n```\n\n### 4.4 Fetch Offset Tracking\n\nEach search request uses a random `offset` or relies on Torre's pagination. Since the Torre API does not expose a traditional `page` or `offset` param, achieve variety by rotating through different keyword search terms or using an empty keyword search with the `contextFeature=job_feed` param. Track which batches have been fetched to avoid re-fetching the same page.\n\n---\n\n## 5. Torre API Integration\n\n### 5.1 Upstream API Details\n\n**Base URL:** `https://search.torre.co`\n\n**Endpoint:** `POST /opportunities/_search`\n\n**Query Parameters:**\n\n| Param | Type | Example | Notes |\n|---|---|---|---|\n| `currency` | string | `\"USD\"` | Normalizes compensation display |\n| `periodicity` | string | `\"yearly\"` | `hourly` \\| `monthly` \\| `yearly` |\n| `lang` | string | `\"en\"` | ISO 639-1 language code |\n| `size` | integer | `10` | Results per page (default 10) |\n| `contextFeature` | string | `\"job_feed\"` | Tuning hint for the ranker |\n\n**Request Body:**\n\n```json\n{\n  \"and\": [\n    { \"status\": { \"code\": \"open\" } }\n  ]\n}\n```\n\nTo search by keyword, add:\n```json\n{ \"keywords\": { \"term\": \"Designer\", \"locale\": \"en\" } }\n```\n\nTo filter by language:\n```json\n{ \"language\": { \"term\": \"English\", \"fluency\": \"fully-fluent\" } }\n```\n\nTo filter by skill:\n```json\n{ \"skill/role\": { \"text\": \"React.js\", \"proficiency\": \"proficient\" } }\n```\n\n**Filter operator schema:**\n\n```typescript\ntype SearchFilter =\n  | { keywords: { term: string; locale?: string } }\n  | { language: { term: string; fluency: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\" } }\n  | { \"skill/role\": { text: string; proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\" } }\n  | { status: { code: \"open\" | \"closed\" | \"paused\" } };\n\ntype SearchRequest = {\n  and?: SearchFilter[];\n  or?: SearchFilter[];\n  not?: SearchFilter[];\n};\n```\n\n### 5.2 Response Shape\n\n```typescript\ntype SearchResponse = {\n  total: number;\n  size: number;\n  results: Opportunity[];\n};\n\ntype Opportunity = {\n  id: string;\n  objective: string;\n  slug: string;\n  tagline: string;\n  theme: string;\n  type: \"full-time-employment\" | \"part-time-employment\" | \"contractor\" | \"freelance\";\n  opportunity: \"employee\" | \"freelancer\";\n  organizations: Organization[];\n  locations: string[];\n  timezones: string[] | null;\n  remote: boolean;\n  external: boolean;\n  deadline: string | null;\n  created: string;\n  status: \"open\" | \"closed\" | \"paused\";\n  commitment: \"full-time\" | \"part-time\";\n  externalApplicationUrl: string | null;\n  compensation: Compensation;\n  skills: Skill[];\n  place: Place;\n};\n\ntype Organization = {\n  id: number;\n  hashedId: string;\n  name: string;\n  status: string;\n  size: number;\n  publicId: string;\n  picture: string;\n  theme: string;\n};\n\ntype Compensation = {\n  data: {\n    code: \"range\" | \"fixed\";\n    currency: string;\n    minAmount: number;\n    minHourlyUSD: number;\n    maxAmount: number;\n    maxHourlyUSD: number;\n    periodicity: \"hourly\" | \"monthly\" | \"yearly\";\n    negotiable: boolean;\n    conversionRateUSD: number;\n  };\n  visible: boolean;\n  additionalCompensationDetails: Record<string, unknown>;\n};\n\ntype Skill = {\n  name: string;\n  experience: \"potential-to-develop\" | \"applying\" | \"leading\";\n  proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\";\n};\n\ntype Place = {\n  remote: boolean;\n  anywhere: boolean;\n  timezone: boolean;\n  locationType: \"remote_countries\" | \"anywhere\" | \"timezone\" | \"onsite\";\n  location: Array<{\n    id: string;\n    timezone: number;\n    countryCode: string | null;\n    latitude: number;\n    longitude: number;\n  }>;\n};\n```\n\n### 5.3 CORS Consideration\n\nThe Torre API is a third-party service. All requests **must** go through the BFF (`apps/api`) to avoid CORS issues and to keep the upstream API call server-side.\n\n---\n\n## 6. Monorepo Architecture\n\n### 6.1 Directory Structure\n\n```\ntorre-swipe/\nâ”œâ”€â”€ apps/\nâ”‚   â”œâ”€â”€ web/                    # Next.js 14 frontend (App Router)\nâ”‚   â”‚   â”œâ”€â”€ app/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Home screen (swipe UI)\nâ”‚   â”‚   â”‚   â””â”€â”€ globals.css\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SwipeStack.tsx  # Card stack orchestrator\nâ”‚   â”‚   â”‚   â”œâ”€â”€ JobCard.tsx     # Individual card UI\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx   # âœ• â¤ â­ buttons\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SkeletonCard.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ CelebrationOverlay.tsx\nâ”‚   â”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ useSwipeQueue.ts   # Queue management + preloading\nâ”‚   â”‚   â”‚   â””â”€â”€ useDragCard.ts     # Drag gesture state\nâ”‚   â”‚   â”œâ”€â”€ store/\nâ”‚   â”‚   â”‚   â””â”€â”€ swipeStore.ts   # Zustand store\nâ”‚   â”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â”‚   â””â”€â”€ api.ts          # BFF client (fetch wrappers)\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â”œâ”€â”€ next.config.ts\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ api/                    # Next.js API routes (BFF)\nâ”‚       â”œâ”€â”€ app/\nâ”‚       â”‚   â””â”€â”€ api/\nâ”‚       â”‚       â””â”€â”€ opportunities/\nâ”‚       â”‚           â””â”€â”€ route.ts   # POST /api/opportunities\nâ”‚       â”œâ”€â”€ lib/\nâ”‚       â”‚   â””â”€â”€ torre.ts           # Torre API client (server-side)\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â”œâ”€â”€ next.config.ts\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ packages/\nâ”‚   â”œâ”€â”€ types/                  # Shared TypeScript types\nâ”‚   â”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ opportunity.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ torre-client/           # Torre API HTTP client (reusable)\nâ”‚       â”œâ”€â”€ src/\nâ”‚       â”‚   â”œâ”€â”€ client.ts\nâ”‚       â”‚   â”œâ”€â”€ types.ts        # (re-exported from @torre-swipe/types)\nâ”‚       â”‚   â””â”€â”€ index.ts\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ package.json                # Root workspace config\nâ”œâ”€â”€ pnpm-workspace.yaml\nâ”œâ”€â”€ turbo.json\nâ””â”€â”€ tsconfig.base.json\n```\n\n### 6.2 Package Naming Convention\n\nAll internal packages use the `@torre-swipe/` scope:\n- `@torre-swipe/types`\n- `@torre-swipe/torre-client`\n\n### 6.3 Root `package.json`\n\n```json\n{\n  \"name\": \"torre-swipe\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"turbo dev\",\n    \"build\": \"turbo build\",\n    \"test\": \"turbo test\",\n    \"lint\": \"turbo lint\",\n    \"type-check\": \"turbo type-check\"\n  },\n  \"devDependencies\": {\n    \"turbo\": \"^2.0.0\",\n    \"typescript\": \"^5.4.0\"\n  }\n}\n```\n\n### 6.4 `pnpm-workspace.yaml`\n\n```yaml\npackages:\n  - \"apps/*\"\n  - \"packages/*\"\n```\n\n### 6.5 `turbo.json`\n\n```json\n{\n  \"$schema\": \"https://turbo.build/schema.json\",\n  \"tasks\": {\n    \"build\": {\n      \"dependsOn\": [\"^build\"],\n      \"outputs\": [\".next/**\", \"dist/**\"]\n    },\n    \"dev\": {\n      \"cache\": false,\n      \"persistent\": true\n    },\n    \"test\": {\n      \"dependsOn\": [\"^build\"]\n    },\n    \"lint\": {},\n    \"type-check\": {\n      \"dependsOn\": [\"^build\"]\n    }\n  }\n}\n```\n\n---\n\n## 7. State Management\n\n### 7.1 Zustand Store (`swipeStore.ts`)\n\n```typescript\ntype SwipeAction = \"like\" | \"pass\" | \"super\";\n\ntype SwipeStore = {\n  // Queue\n  queue: Opportunity[];          // Cards ready to display (index 0 = top)\n  seenIds: Set<string>;          // All IDs ever shown (for dedup)\n  isFetching: boolean;\n  fetchError: string | null;\n\n  // Undo\n  undoCard: Opportunity | null;  // Last swiped card (for 1-level undo)\n  undoAction: SwipeAction | null;\n\n  // UI state\n  isAnimating: boolean;          // True while exit animation runs\n  isCelebrating: boolean;        // Super like celebration overlay\n\n  // Actions\n  addCards: (cards: Opportunity[]) => void;\n  swipe: (action: SwipeAction) => void;\n  undo: () => void;\n  setFetching: (v: boolean) => void;\n  setFetchError: (msg: string | null) => void;\n  setAnimating: (v: boolean) => void;\n  setCelebrating: (v: boolean) => void;\n};\n```\n\n### 7.2 Persistence (`localStorage`)\n\nPersist only `seenIds` across sessions to avoid re-showing swiped jobs:\n\n```typescript\n// On store init\nconst stored = localStorage.getItem(\"torre_seen_ids\");\nconst seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();\n\n// After each swipe\nlocalStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));\n```\n\nCap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.\n\n### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)\n\n```typescript\nexport function useSwipeQueue() {\n  const { queue, seenIds, isFetching, addCards, setFetching } = useSwipeStore();\n\n  // Trigger refill when queue is low\n  useEffect(() => {\n    if (queue.length < REFILL_THRESHOLD && !isFetching) {\n      fetchMore();\n    }\n  }, [queue.length]);\n\n  async function fetchMore() {\n    setFetching(true);\n    try {\n      const data = await fetchOpportunities({ size: REFILL_SIZE });\n      const fresh = data.results.filter(r => !seenIds.has(r.id));\n      addCards(fresh);\n      preloadImages(fresh);\n    } finally {\n      setFetching(false);\n    }\n  }\n\n  return { fetchMore };\n}\n```\n\n---\n\n## 8. Tech Stack\n\n| Layer | Technology | Version | Rationale |\n|---|---|---|---|\n| **Monorepo** | Turborepo | ^2.0 | Fast incremental builds, task graph |\n| **Package manager** | pnpm | ^9.0 | Workspace support, disk efficiency |\n| **Language** | TypeScript | ^5.4 | Strict mode throughout |\n| **Frontend framework** | Next.js (App Router) | ^14.x | SSR/SSG optional, great DX |\n| **Styling** | Tailwind CSS | ^3.4 | Utility-first, no runtime |\n| **Animation / gestures** | Framer Motion | ^11.x | Spring physics, drag gesture built-in |\n| **State management** | Zustand | ^4.x | Minimal boilerplate, localStorage easy |\n| **BFF** | Next.js API Routes | (same as frontend or separate app) | Proxies Torre API, hides CORS |\n| **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |\n| **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |\n| **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |\n| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |\n| **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |\n| **Formatting** | Prettier | ^3.x | Opinionated, zero config |\n\n### 8.1 Tailwind Configuration\n\n```javascript\n// tailwind.config.ts (apps/web)\nexport default {\n  content: [\"./app/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\"],\n  theme: {\n    extend: {\n      colors: {\n        like: \"#4CAF50\",\n        pass: \"#F44336\",\n        super: \"#2196F3\",\n        \"super-star\": \"#FFC107\",\n      },\n      borderRadius: {\n        card: \"16px\",\n      },\n    },\n  },\n};\n```\n\n### 8.2 Framer Motion Drag Setup\n\nThe top card uses Framer Motion's `drag` prop. Only the top card is draggable; back cards are static.\n\n```typescript\n<motion.div\n  drag\n  dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n  dragElastic={0.9}\n  onDragEnd={handleDragEnd}\n  animate={controls}\n  style={{ x, y, rotate }}\n>\n  <JobCard job={currentJob} />\n  <SwipeOverlay x={x} y={y} />\n</motion.div>\n```\n\n---\n\n## 9. Test Requirements\n\n### 9.1 Backend (`apps/api`) â€” Target: ~100% coverage\n\nEvery line of BFF code must be covered by unit tests. Use Vitest with c8 for coverage reporting.\n\n**Coverage targets:**\n- Statements: â‰¥ 98%\n- Branches: â‰¥ 95%\n- Functions: â‰¥ 98%\n- Lines: â‰¥ 98%\n\n**Test files:**\n\n```\napps/api/\nâ””â”€â”€ __tests__/\n    â”œâ”€â”€ route.test.ts          # POST /api/opportunities handler\n    â””â”€â”€ torre.test.ts          # Torre API client unit tests\n```\n\n**`torre.test.ts` must cover:**\n- Happy path: valid request returns parsed Opportunity[]\n- Torre API returns non-200: throws `TorreApiError`\n- Network failure: throws and propagates\n- Response body with missing optional fields (e.g., `compensation.visible = false`)\n- `seenIds` deduplication filter\n- Request body construction with all filter types (keywords, language, skill/role, status)\n- Query param serialization (currency, periodicity, lang, size, contextFeature)\n\n**`route.test.ts` must cover:**\n- Valid POST body â†’ 200 with opportunity list\n- Missing/invalid body â†’ 400\n- Torre client throws â†’ 502\n- CORS headers present in response\n- Empty results array handled gracefully\n\n**Test pattern (mock `fetch` globally):**\n\n```typescript\nimport { vi, describe, it, expect, beforeEach } from \"vitest\";\n\nvi.stubGlobal(\"fetch\", vi.fn());\n\ndescribe(\"TorreClient.searchOpportunities\", () => {\n  it(\"returns parsed results on success\", async () => {\n    (fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ total: 1, size: 1, results: [mockOpportunity] }),\n    });\n    const result = await client.searchOpportunities({ size: 1 });\n    expect(result.results).toHaveLength(1);\n  });\n});\n```\n\n### 9.2 Frontend (`apps/web`) â€” Unit + Integration\n\n**Component tests (`*.test.tsx`):**\n\n| Component | What to test |\n|---|---|\n| `JobCard` | Renders title, company name, salary (visible/hidden), skills (max 3 + overflow), remote badge, missing logo fallback |\n| `ActionBar` | All 3 buttons render; disabled state during animation; click handlers called |\n| `SwipeStack` | Shows skeleton when loading; shows empty state when queue empty; renders correct z-order |\n| `SkeletonCard` | Renders shimmer elements |\n| `EmptyState` | Shows refresh button; calls onRefresh on click |\n\n**Hook tests:**\n\n| Hook | What to test |\n|---|---|\n| `useSwipeQueue` | Triggers fetch on mount; triggers refill when queue < threshold; deduplicates by seenIds |\n\n**Store tests (`swipeStore.test.ts`):**\n- `addCards` appends without duplicates\n- `swipe(\"like\")` removes top card, sets `undoCard`, adds id to `seenIds`\n- `swipe(\"pass\")` same as like for queue management\n- `swipe(\"super\")` same + sets `isCelebrating = true`\n- `undo` restores top card from `undoCard`, clears `undoCard`\n- `undo` when `undoCard === null` is a no-op\n\n**Coverage targets (frontend):**\n- Statements: â‰¥ 80%\n- Branches: â‰¥ 75%\n\n### 9.3 E2E (`apps/web/e2e/`)\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |\n\n---\n\n## 10. API Contract (BFF)\n\nThe BFF (`apps/api`) exposes one endpoint to the frontend.\n\n### `POST /api/opportunities`\n\n**Request body:**\n\n```typescript\ntype OpportunitiesRequest = {\n  size?: number;           // default: 10, max: 20\n  keywords?: string;       // free text search term\n  language?: string;       // e.g. \"English\"\n  fluency?: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\";\n  currency?: string;       // e.g. \"USD\"\n  periodicity?: \"hourly\" | \"monthly\" | \"yearly\";\n};\n```\n\n**Example request:**\n\n```json\nPOST /api/opportunities\nContent-Type: application/json\n\n{\n  \"size\": 10,\n  \"currency\": \"USD\",\n  \"periodicity\": \"yearly\"\n}\n```\n\n**Response: 200 OK**\n\n```typescript\ntype OpportunitiesResponse = {\n  results: Opportunity[];  // from @torre-swipe/types\n  total: number;\n};\n```\n\n**Response: 400 Bad Request**\n\n```json\n{ \"error\": \"Invalid request body\", \"details\": \"...\" }\n```\n\n**Response: 502 Bad Gateway**\n\n```json\n{ \"error\": \"Upstream API error\", \"message\": \"...\" }\n```\n\n### BFF Implementation\n\nThe BFF handler:\n1. Validates the incoming request body (Zod schema recommended).\n2. Constructs a `SearchRequest` for Torre with `status: open` always included.\n3. Calls `TorreClient.searchOpportunities()` from `@torre-swipe/torre-client`.\n4. Returns the `results` array and `total` to the frontend.\n5. Does NOT filter by `seenIds` â€” that is the frontend's responsibility.\n\n**CORS:** Set `Access-Control-Allow-Origin: *` (or restrict to the web app origin in production).\n\n```typescript\n// apps/api/app/api/opportunities/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { TorreClient } from \"@torre-swipe/torre-client\";\nimport { opportunitiesSchema } from \"../../../lib/validation\";\n\nconst torre = new TorreClient(\"https://search.torre.co\");\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json().catch(() => null);\n  const parsed = opportunitiesSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\n  }\n\n  try {\n    const result = await torre.searchOpportunities(parsed.data);\n    return NextResponse.json(result);\n  } catch (err) {\n    return NextResponse.json(\n      { error: \"Upstream API error\", message: String(err) },\n      { status: 502 }\n    );\n  }\n}\n```\n\n---\n\n## 11. Performance Requirements\n\n| Metric | Target |\n|---|---|\n| First Contentful Paint (mobile 3G) | < 2s |\n| Skeleton shown before first card ready | â‰¤ 200ms after page load |\n| Card transition animation | 60 fps, no jank |\n| Time between swipe and next card appearing | < 100ms (card is already in DOM, just z-index change) |\n| Image load for top 3 cards | Pre-cached before card reaches top position |\n| Bundle size (web, gzipped JS) | < 150 KB first load |\n\n### 11.1 Animation Performance Rules\n\n- Use `transform` and `opacity` for all animations (no layout-triggering properties).\n- Apply `will-change: transform` to the top card only (remove after exit).\n- Back cards use CSS transitions (not JS-driven) â€” they only change when the queue changes.\n- Framer Motion's `useMotionValue` + `useTransform` for overlay opacity â€” avoids React re-renders during drag.\n\n### 11.2 Bundle Optimization\n\n- Dynamic import `framer-motion` only in the `SwipeStack` component.\n- No server-side rendering needed for the swipe UI â€” render client-side with `\"use client\"`.\n- Use Next.js Image component for company logos with `priority` on the top card's logo.\n\n---\n\n## 12. Accessibility\n\nThe swipe interface must be fully usable **without gestures**.\n\n### 12.1 Keyboard Support\n\n| Key | Action |\n|---|---|\n| `â†’` Arrow Right | Like (same as â¤ button) |\n| `â†` Arrow Left | Pass (same as âœ• button) |\n| `â†‘` Arrow Up | Super Like (same as â­ button) |\n| `Z` | Undo last swipe |\n| `Enter` / `Space` | Like (when card is focused) |\n\nAdd a global `keydown` event listener on the home page.\n\n### 12.2 ARIA Labels\n\n```html\n<button aria-label=\"Pass this job\">âœ•</button>\n<button aria-label=\"Like this job\">â¤</button>\n<button aria-label=\"Super like this job\">â­</button>\n<button aria-label=\"Undo last swipe\" aria-disabled=\"true\">â†©</button>\n```\n\nThe card itself:\n```html\n<article\n  role=\"article\"\n  aria-label=\"{job.objective} at {company.name}\"\n  tabIndex={0}\n>\n```\n\n### 12.3 Reduced Motion\n\nRespect `prefers-reduced-motion`. When active:\n- Disable drag animations (cards still respond to button taps).\n- Use instant transitions instead of spring animations.\n- Disable celebration overlay animation (show static text instead).\n\n```typescript\nconst prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\nconst springConfig = prefersReducedMotion\n  ? { duration: 0 }\n  : { type: \"spring\", stiffness: 400, damping: 30 };\n```\n\n### 12.4 Touch Target Sizes\n\nAll interactive elements meet the WCAG 2.5.5 AAA minimum of **44Ã—44px** touch target size.\n\n- Action buttons: 56px and 64px diameter âœ“\n- Undo button: minimum 44Ã—44px âœ“\n- Skill chips: not interactive, no requirement\n\n---\n\n## Appendix A â€” Sample API Call\n\n```bash\ncurl -X POST \"https://search.torre.co/opportunities/_search?currency=USD&periodicity=yearly&lang=en&size=10&contextFeature=job_feed\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"and\": [\n      { \"status\": { \"code\": \"open\" } }\n    ]\n  }'\n```\n\n## Appendix B â€” Key File Summaries\n\n| File | Purpose |\n|---|---|\n| `packages/types/src/opportunity.ts` | All shared TypeScript types (Opportunity, Compensation, Skill, etc.) |\n| `packages/torre-client/src/client.ts` | `TorreClient` class with `searchOpportunities()` method |\n| `apps/api/app/api/opportunities/route.ts` | BFF route handler (validates input, calls TorreClient, returns JSON) |\n| `apps/web/store/swipeStore.ts` | Zustand store (queue, undo, celebration state) |\n| `apps/web/hooks/useSwipeQueue.ts` | Preloading logic, refill triggering |\n| `apps/web/hooks/useDragCard.ts` | Framer Motion drag state, threshold detection |\n| `apps/web/components/SwipeStack.tsx` | Renders top 3 cards with correct z-index/transforms |\n| `apps/web/components/JobCard.tsx` | Card UI (logo, title, salary, skills, tagline) |\n| `apps/web/components/ActionBar.tsx` | âœ• â¤ â­ buttons |\n| `apps/web/app/page.tsx` | Home page â€” composes all components, keyboard handler |\n\n## Appendix C â€” `@torre-swipe/torre-client` Interface\n\n```typescript\nexport class TorreClient {\n  constructor(private baseUrl: string) {}\n\n  async searchOpportunities(params: {\n    size?: number;\n    currency?: string;\n    periodicity?: string;\n    lang?: string;\n    contextFeature?: string;\n    keywords?: string;\n    language?: string;\n    fluency?: string;\n  }): Promise<{ total: number; size: number; results: Opportunity[] }>;\n}\n\nexport class TorreApiError extends Error {\n  constructor(\n    public status: number,\n    public body: string\n  ) {\n    super(`Torre API error ${status}: ${body}`);\n  }\n}\n```\n","structuredPatch":[{"oldStart":605,"oldLines":21,"newStart":605,"newLines":84,"lines":[" };"," ```"," ","-### 7.2 Persistence (`localStorage`)","+### 7.2 Persistence â€” Storage Strategy"," ","-Persist only `seenIds` across sessions to avoid re-showing swiped jobs:","+Persistence is abstracted behind a `StorageStrategy` interface so the underlying storage mechanism (localStorage, a remote database, etc.) can be swapped without touching the store or queue logic."," "," ```typescript","-// On store init","-const stored = localStorage.getItem(\"torre_seen_ids\");","-const seenIds = stored ? new Set<string>(JSON.parse(stored)) : new Set<string>();","+// packages/types/src/storage.ts"," ","-// After each swipe","-localStorage.setItem(\"torre_seen_ids\", JSON.stringify([...seenIds]));","+export interface StorageStrategy {","+  /** Load the set of already-seen opportunity IDs. */","+  loadSeenIds(): Promise<Set<string>>;","+  /** Persist the updated set of seen IDs. */","+  saveSeenIds(ids: Set<string>): Promise<void>;","+}"," ```"," ","-Cap stored `seenIds` at **500 entries** (drop oldest if over limit) to avoid unbounded localStorage growth.","+**Provided implementation â€” `LocalStorageStrategy`:**"," ","+```typescript","+// packages/torre-client/src/storage/LocalStorageStrategy.ts","+","+const KEY = \"torre_seen_ids\";","+const MAX_ENTRIES = 500;","+","+export class LocalStorageStrategy implements StorageStrategy {","+  async loadSeenIds(): Promise<Set<string>> {","+    const raw = localStorage.getItem(KEY);","+    return raw ? new Set<string>(JSON.parse(raw)) : new Set<string>();","+  }","+","+  async saveSeenIds(ids: Set<string>): Promise<void> {","+    let entries = [...ids];","+    // Cap at MAX_ENTRIES, dropping the oldest (head of the array)","+    if (entries.length > MAX_ENTRIES) {","+      entries = entries.slice(entries.length - MAX_ENTRIES);","+    }","+    localStorage.setItem(KEY, JSON.stringify(entries));","+  }","+}","+```","+","+**Wiring the strategy into the store:**","+","+The `StorageStrategy` instance is injected at app bootstrap and passed to the Zustand store initializer. This keeps the store agnostic about _how_ data is saved.","+","+```typescript","+// apps/web/app/page.tsx (bootstrap)","+import { LocalStorageStrategy } from \"@torre-swipe/torre-client\";","+import { initSwipeStore } from \"../store/swipeStore\";","+","+const storage = new LocalStorageStrategy();","+initSwipeStore(storage); // loads seenIds asynchronously before first render","+```","+","+```typescript","+// apps/web/store/swipeStore.ts (excerpt)","+type SwipeStore = {","+  // ...existing fields...","+  storage: StorageStrategy;","+};","+","+export function initSwipeStore(storage: StorageStrategy) {","+  storage.loadSeenIds().then(ids => {","+    useSwipeStore.setState({ seenIds: ids, storage });","+  });","+}","+","+// Inside the `swipe` action â€” persist after every swipe:","+swipe: (action) => {","+  set(state => {","+    const newSeenIds = new Set(state.seenIds).add(state.queue[0].id);","+    state.storage.saveSeenIds(newSeenIds); // fire-and-forget","+    return { /* updated queue, seenIds, etc. */ };","+  });","+}","+```","+","+> **Out of scope:** Implementing additional strategies (e.g., a REST/database-backed strategy) is explicitly deferred. The interface above is the extension point.","+"," Do **not** persist the queue itself â€” always re-fetch on page load."," "," ### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5499048a-a3f8-4c02-a98e-d35c5e773666"}
{"parentUuid":"b4bc01b5-c64b-42a7-b7c3-4e27fc01b939","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_016F9RRn3DV2zwsVB1ZRKQFs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014tAxcpMnNUpEeDxUVHNdQ8","name":"TodoWrite","input":{"todos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"completed","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"in_progress","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1059,"cache_read_input_tokens":42297,"output_tokens":141,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1059,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5rqkwBMQ9sSRpoL7Jb","type":"assistant","uuid":"9c5afc72-ce81-42cd-93f1-4d046f04a7d0","timestamp":"2026-02-26T17:35:51.338Z"}
{"parentUuid":"9c5afc72-ce81-42cd-93f1-4d046f04a7d0","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014tAxcpMnNUpEeDxUVHNdQ8","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"cf53e00f-17a2-4e82-9275-9bbe6f9b355c","timestamp":"2026-02-26T17:35:51.344Z","toolUseResult":{"oldTodos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"in_progress","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"pending","activeForm":"Marking E2E testing as future work in SPEC.md"}],"newTodos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"completed","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"in_progress","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"sourceToolAssistantUUID":"9c5afc72-ce81-42cd-93f1-4d046f04a7d0"}
{"parentUuid":"cf53e00f-17a2-4e82-9275-9bbe6f9b355c","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_019LUprXFNkGc63YqBEHCKPu","type":"message","role":"assistant","content":[{"type":"text","text":"Now update the E2E section and the tech stack table:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":183,"cache_read_input_tokens":43356,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":183},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5sLqubEVnzPcQPR5em","type":"assistant","uuid":"964a7eb4-725f-4af4-87fe-3a1033b361fc","timestamp":"2026-02-26T17:35:56.106Z"}
{"parentUuid":"964a7eb4-725f-4af4-87fe-3a1033b361fc","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_019LUprXFNkGc63YqBEHCKPu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QBbXiTB7LW5hiVA5QTXv9R","name":"Edit","input":{"replace_all":false,"file_path":"/Users/agurodriguez/Code/torre-ca/SPEC.md","old_string":"### 9.3 E2E (`apps/web/e2e/`)\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |","new_string":"### 9.3 E2E â€” Future Work\n\n> **Status: Out of scope for v1.** E2E tests are planned but deferred. The scenarios below document the intended coverage once E2E is prioritised.\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":183,"cache_read_input_tokens":43356,"output_tokens":584,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":183,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5sLqubEVnzPcQPR5em","type":"assistant","uuid":"171affe6-afaa-4b97-ab1f-c4f42d0ffe8c","timestamp":"2026-02-26T17:36:04.060Z"}
{"parentUuid":"171affe6-afaa-4b97-ab1f-c4f42d0ffe8c","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QBbXiTB7LW5hiVA5QTXv9R","type":"tool_result","content":"The file /Users/agurodriguez/Code/torre-ca/SPEC.md has been updated successfully."}]},"uuid":"f512d75e-7c64-4118-859a-ae598bce6bf8","timestamp":"2026-02-26T17:36:04.395Z","toolUseResult":{"filePath":"/Users/agurodriguez/Code/torre-ca/SPEC.md","oldString":"### 9.3 E2E (`apps/web/e2e/`)\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |","newString":"### 9.3 E2E â€” Future Work\n\n> **Status: Out of scope for v1.** E2E tests are planned but deferred. The scenarios below document the intended coverage once E2E is prioritised.\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |","originalFile":"# Torre Swipe â€” Product & Technical Specification\n\n> Hand this document to an LLM and say **\"build this\"** to get a complete, production-ready implementation.\n\n---\n\n## Table of Contents\n\n1. [Product Overview](#1-product-overview)\n2. [Core User Flow](#2-core-user-flow)\n3. [Home Screen Specification](#3-home-screen-specification)\n4. [Background Preloading Strategy](#4-background-preloading-strategy)\n5. [Torre API Integration](#5-torre-api-integration)\n6. [Monorepo Architecture](#6-monorepo-architecture)\n7. [State Management](#7-state-management)\n8. [Tech Stack](#8-tech-stack)\n9. [Test Requirements](#9-test-requirements)\n10. [API Contract (BFF)](#10-api-contract-bff)\n11. [Performance Requirements](#11-performance-requirements)\n12. [Accessibility](#12-accessibility)\n\n---\n\n## 1. Product Overview\n\n**Torre Swipe** is a mobile-first web application that lets job seekers discover Torre.ai job opportunities through a Tinder-style swipe interface. Users swipe right to like a job, left to pass, and up to super-like. Liked and super-liked jobs open the external application URL in a new tab.\n\n**Primary user:** A job seeker on a mobile browser who wants a fast, low-friction way to browse and shortlist job opportunities.\n\n**Why it works:** Traditional job boards require deliberate search queries. Torre Swipe surfaces opportunities serendipitously, making job discovery feel effortless and even fun. The swipe mechanic creates a lightweight commitment signal â€” a flick of the thumb â€” that lowers the psychological cost of engaging with each posting.\n\n**Non-goals (out of scope):**\n- User accounts or authentication\n- Persistent match history beyond `localStorage`\n- Full application flow within the app (redirects to external URLs)\n- Employer-facing features\n\n---\n\n## 2. Core User Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  1. User opens app (mobile browser)                 â”‚\nâ”‚     â†’ Skeleton loading cards appear instantly       â”‚\nâ”‚     â†’ First batch of jobs fetched from BFF          â”‚\nâ”‚                                                     â”‚\nâ”‚  2. Swipe loop (repeated until empty state)         â”‚\nâ”‚     a. Top card is the current job                  â”‚\nâ”‚     b. User swipes or taps a button:                â”‚\nâ”‚        â€¢ Right / â¤  â†’ LIKE  (opens ext. URL)       â”‚\nâ”‚        â€¢ Left  / âœ•  â†’ PASS  (discard)              â”‚\nâ”‚        â€¢ Up    / â­ â†’ SUPER LIKE (opens ext. URL)  â”‚\nâ”‚     c. Card animates off screen                     â”‚\nâ”‚     d. Next card slides up to become top            â”‚\nâ”‚     e. Preloader ensures next cards are ready       â”‚\nâ”‚                                                     â”‚\nâ”‚  3. Undo                                            â”‚\nâ”‚     â†’ One-level undo brings last swiped card back  â”‚\nâ”‚                                                     â”‚\nâ”‚  4. Empty state                                     â”‚\nâ”‚     â†’ \"You've seen all jobs!\" message + Refresh CTA â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Swipe Actions Detail\n\n| Action | Gesture | Button | Effect |\n|--------|---------|--------|--------|\n| LIKE   | Swipe right | â¤ (heart) | Opens `externalApplicationUrl` in new tab; card exits right |\n| PASS   | Swipe left  | âœ• (cross) | Discards; card exits left |\n| SUPER LIKE | Swipe up | â­ (star) | Opens `externalApplicationUrl` in new tab; card exits upward; shows celebration overlay |\n\n---\n\n## 3. Home Screen Specification\n\nThe home screen is the **only screen**. There is no navigation, no search page, no profile page.\n\n### 3.1 Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Torre Swipe          [undo â†©]    â”‚  â† Header (48px)\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                    â”‚\nâ”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\nâ”‚    â”Œâ”€â”¤   Card (top)     â”œâ”€â”        â”‚\nâ”‚  â”Œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”      â”‚\nâ”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â† Card stack area\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜     â”‚    (fills remaining height)\nâ”‚                                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚      [âœ•]        [â¤]       [â­]    â”‚  â† Action buttons (80px)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3.2 Card Anatomy\n\nEach job card is a rounded rectangle (border-radius: 16px) with a white background and a subtle drop shadow. Content from top to bottom:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [Company Logo 56Ã—56]              â”‚  â† rounded, 4px shadow\nâ”‚  Company Name            [Remote]  â”‚  â† body-sm, gray-500 | badge\nâ”‚                                    â”‚\nâ”‚  Job Title (2 lines max)           â”‚  â† heading-lg, semibold\nâ”‚                                    â”‚\nâ”‚  ğŸ’° $164k â€“ $246k / year          â”‚  â† compensation (if visible)\nâ”‚  ğŸ“ United States Â· Remote        â”‚  â† location + remote badge\nâ”‚  ğŸ• Full-time                     â”‚  â† commitment\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  Tagline text (3 lines max,        â”‚  â† body-sm, gray-600\nâ”‚  ellipsized)                       â”‚\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  [Figma] [React.js] [CSS] +4      â”‚  â† skill chips (max 3 shown)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Card data mapping:**\n\n| UI element | API field | Fallback |\n|---|---|---|\n| Company logo | `organizations[0].picture` | Generic building icon |\n| Company name | `organizations[0].name` | \"Unknown Company\" |\n| Job title | `objective` | â€” |\n| Salary | `compensation.data` (if `visible: true`) | \"Salary not disclosed\" |\n| Location | `locations[]` joined with `, ` | \"Location not specified\" |\n| Remote badge | `remote === true` | hidden |\n| Commitment | `commitment` | hidden |\n| Tagline | `tagline` | hidden |\n| Skills | `skills[].name` (first 3) | hidden if empty |\n| Overflow | `skills.length - 3` shown as `+N` | hidden |\n\n**Salary formatting:**\n\n- If `compensation.visible === false`: show \"Salary not disclosed\"\n- If `code === \"range\"`: `$${formatK(minAmount)} â€“ $${formatK(maxAmount)} / ${periodicity}`\n- If `code === \"fixed\"`: `$${formatK(minAmount)} / ${periodicity}`\n- `formatK`: amounts â‰¥ 1000 shown as `Xk` (e.g., `164000` â†’ `$164k`)\n\n**Skill chip colors:** Use a deterministic color from a pastel palette based on skill name hash (so the same skill always gets the same color).\n\n### 3.3 Card Stack Visual\n\nAlways render exactly **3 cards** (or fewer if fewer remain). Cards are layered with CSS `z-index`. The back cards are purely decorative â€” they show the card background/shadow only, not full content.\n\n| Position | z-index | Transform | Opacity |\n|---|---|---|---|\n| Top (active) | 30 | `scale(1)` `translateY(0)` | 1.0 |\n| Middle | 20 | `scale(0.97)` `translateY(10px)` | 1.0 |\n| Back | 10 | `scale(0.94)` `translateY(20px)` | 1.0 |\n\nApply transforms via CSS `transform` (not layout properties) for GPU compositing.\n\n### 3.4 Swipe Gesture & Overlay Stamps\n\n**Drag behavior:**\n- Card follows the pointer/touch position (CSS `transform: translate(x, y) rotate(Î¸)`).\n- Rotation: `Î¸ = x * 0.08` (degrees), clamped to Â±20Â°.\n- Overlay stamp opacity: `Math.min(Math.abs(x) / 80, 1)` for horizontal, `Math.min(-y / 80, 1)` for upward.\n\n**Overlay stamps (shown while dragging):**\n\n| Direction | Text | Color | Position |\n|---|---|---|---|\n| Right | **LIKE** | `#4CAF50` (green) | top-left of card, rotated -20Â° |\n| Left | **NOPE** | `#F44336` (red) | top-right of card, rotated 20Â° |\n| Up | **SUPER** | `#2196F3` (blue) | center of card |\n\nStamps use a bordered label style: 3px solid border, uppercase, bold, 28px font.\n\n**Throw threshold:** If the user releases the card with `|x| > 100px` or `y < -100px`, animate the card off screen. Otherwise spring back to center.\n\n**Exit animations (spring physics):**\n- Right exit: `x` â†’ `window.innerWidth + 300`, slight upward arc\n- Left exit: `x` â†’ `-(window.innerWidth + 300)`, slight upward arc\n- Up exit: `y` â†’ `-(window.innerHeight + 300)`\n- Spring config: `{ stiffness: 400, damping: 30 }` (Framer Motion defaults)\n\n### 3.5 Action Buttons\n\nThree circular buttons centered horizontally in the action bar:\n\n```\n[âœ• 56px red/pink]   [â¤ 64px green]   [â­ 56px blue/gold]\n```\n\n- âœ• (Pass): diameter 56px, border 2px `#F44336`, icon `#F44336`\n- â¤ (Like): diameter 64px, bg `#4CAF50`, icon white â€” slightly larger as primary CTA\n- â­ (Super): diameter 56px, border 2px `#2196F3`, icon `#FFC107` (gold star)\n\nTapping a button triggers the same exit animation as a full swipe gesture. Buttons are disabled (opacity 0.4, pointer-events none) during a card exit animation.\n\n### 3.6 Undo Button\n\nLocated in the top-right of the header. Shows a back-arrow icon (â†©).\n\n- Enabled only if there is a previous card in the undo stack (max depth: 1 â€” only the most recent swipe can be undone).\n- Tapping it brings the last card back to the top of the stack with a reverse spring animation (card flies in from the direction it exited).\n- After undo, the button becomes disabled again until the next swipe.\n\n### 3.7 Super Like Celebration\n\nWhen a super like fires (gesture or button):\n1. Card exits upward.\n2. A full-screen overlay fades in (semi-transparent dark bg).\n3. Center: animated star burst (CSS keyframes) with text **\"Super Like! ğŸŒŸ\"**.\n4. Auto-dismisses after 1.5s, or user can tap anywhere to dismiss early.\n\n### 3.8 Loading Skeleton\n\nShown in place of the card stack while the first fetch is in flight.\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [â–‘â–‘â–‘â–‘ 56Ã—56 circle]               â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘               â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nSkeleton elements use a shimmer animation (gradient sweep left-to-right, 1.5s infinite).\n\n### 3.9 Empty State\n\nWhen the card queue is exhausted:\n\n```\n        ğŸ‰\n\n   You've seen all jobs!\n\n   Check back later or broaden\n   your search.\n\n   [  Refresh  ]\n```\n\n\"Refresh\" re-triggers the API fetch (with a fresh random offset/seed so different results may appear).\n\n---\n\n## 4. Background Preloading Strategy\n\nThe app must **never show a loading spinner** after the initial skeleton load. Achieve this by maintaining a buffer of pre-fetched cards.\n\n### 4.1 Queue Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  DISPLAY QUEUE (cards ready to show)                     â”‚\nâ”‚  [card_1] [card_2] [card_3] [card_4] [card_5] ...       â”‚\nâ”‚      â†‘ top card shown                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â†“ fetch triggered when size < REFILL_THRESHOLD\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FETCH IN FLIGHT (background, non-blocking)              â”‚\nâ”‚  next batch of 10 cards from BFF                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Constants:**\n\n| Constant | Value | Meaning |\n|---|---|---|\n| `INITIAL_FETCH_SIZE` | 20 | Cards fetched on first load |\n| `REFILL_SIZE` | 10 | Cards fetched per refill |\n| `REFILL_THRESHOLD` | 5 | Trigger refill when queue drops below this |\n| `MAX_QUEUE_SIZE` | 50 | Cap to avoid unbounded memory |\n\n### 4.2 Deduplication\n\nTrack all seen `id` values in a `Set<string>` (persisted in `localStorage` under `torre_seen_ids`). When appending new cards from a fetch, filter out any whose `id` is already in the seen set. Add swiped card IDs to the set immediately on swipe (before the exit animation completes).\n\n### 4.3 Image Preloading\n\nAfter cards are added to the queue, preload company logo images for the next 5 cards using `new Image()` instances so images are in browser cache when cards render.\n\n```typescript\nfunction preloadImages(cards: Opportunity[], count = 5) {\n  cards.slice(0, count).forEach(card => {\n    const url = card.organizations[0]?.picture;\n    if (url) {\n      const img = new Image();\n      img.src = url;\n    }\n  });\n}\n```\n\n### 4.4 Fetch Offset Tracking\n\nEach search request uses a random `offset` or relies on Torre's pagination. Since the Torre API does not expose a traditional `page` or `offset` param, achieve variety by rotating through different keyword search terms or using an empty keyword search with the `contextFeature=job_feed` param. Track which batches have been fetched to avoid re-fetching the same page.\n\n---\n\n## 5. Torre API Integration\n\n### 5.1 Upstream API Details\n\n**Base URL:** `https://search.torre.co`\n\n**Endpoint:** `POST /opportunities/_search`\n\n**Query Parameters:**\n\n| Param | Type | Example | Notes |\n|---|---|---|---|\n| `currency` | string | `\"USD\"` | Normalizes compensation display |\n| `periodicity` | string | `\"yearly\"` | `hourly` \\| `monthly` \\| `yearly` |\n| `lang` | string | `\"en\"` | ISO 639-1 language code |\n| `size` | integer | `10` | Results per page (default 10) |\n| `contextFeature` | string | `\"job_feed\"` | Tuning hint for the ranker |\n\n**Request Body:**\n\n```json\n{\n  \"and\": [\n    { \"status\": { \"code\": \"open\" } }\n  ]\n}\n```\n\nTo search by keyword, add:\n```json\n{ \"keywords\": { \"term\": \"Designer\", \"locale\": \"en\" } }\n```\n\nTo filter by language:\n```json\n{ \"language\": { \"term\": \"English\", \"fluency\": \"fully-fluent\" } }\n```\n\nTo filter by skill:\n```json\n{ \"skill/role\": { \"text\": \"React.js\", \"proficiency\": \"proficient\" } }\n```\n\n**Filter operator schema:**\n\n```typescript\ntype SearchFilter =\n  | { keywords: { term: string; locale?: string } }\n  | { language: { term: string; fluency: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\" } }\n  | { \"skill/role\": { text: string; proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\" } }\n  | { status: { code: \"open\" | \"closed\" | \"paused\" } };\n\ntype SearchRequest = {\n  and?: SearchFilter[];\n  or?: SearchFilter[];\n  not?: SearchFilter[];\n};\n```\n\n### 5.2 Response Shape\n\n```typescript\ntype SearchResponse = {\n  total: number;\n  size: number;\n  results: Opportunity[];\n};\n\ntype Opportunity = {\n  id: string;\n  objective: string;\n  slug: string;\n  tagline: string;\n  theme: string;\n  type: \"full-time-employment\" | \"part-time-employment\" | \"contractor\" | \"freelance\";\n  opportunity: \"employee\" | \"freelancer\";\n  organizations: Organization[];\n  locations: string[];\n  timezones: string[] | null;\n  remote: boolean;\n  external: boolean;\n  deadline: string | null;\n  created: string;\n  status: \"open\" | \"closed\" | \"paused\";\n  commitment: \"full-time\" | \"part-time\";\n  externalApplicationUrl: string | null;\n  compensation: Compensation;\n  skills: Skill[];\n  place: Place;\n};\n\ntype Organization = {\n  id: number;\n  hashedId: string;\n  name: string;\n  status: string;\n  size: number;\n  publicId: string;\n  picture: string;\n  theme: string;\n};\n\ntype Compensation = {\n  data: {\n    code: \"range\" | \"fixed\";\n    currency: string;\n    minAmount: number;\n    minHourlyUSD: number;\n    maxAmount: number;\n    maxHourlyUSD: number;\n    periodicity: \"hourly\" | \"monthly\" | \"yearly\";\n    negotiable: boolean;\n    conversionRateUSD: number;\n  };\n  visible: boolean;\n  additionalCompensationDetails: Record<string, unknown>;\n};\n\ntype Skill = {\n  name: string;\n  experience: \"potential-to-develop\" | \"applying\" | \"leading\";\n  proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\";\n};\n\ntype Place = {\n  remote: boolean;\n  anywhere: boolean;\n  timezone: boolean;\n  locationType: \"remote_countries\" | \"anywhere\" | \"timezone\" | \"onsite\";\n  location: Array<{\n    id: string;\n    timezone: number;\n    countryCode: string | null;\n    latitude: number;\n    longitude: number;\n  }>;\n};\n```\n\n### 5.3 CORS Consideration\n\nThe Torre API is a third-party service. All requests **must** go through the BFF (`apps/api`) to avoid CORS issues and to keep the upstream API call server-side.\n\n---\n\n## 6. Monorepo Architecture\n\n### 6.1 Directory Structure\n\n```\ntorre-swipe/\nâ”œâ”€â”€ apps/\nâ”‚   â”œâ”€â”€ web/                    # Next.js 14 frontend (App Router)\nâ”‚   â”‚   â”œâ”€â”€ app/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Home screen (swipe UI)\nâ”‚   â”‚   â”‚   â””â”€â”€ globals.css\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SwipeStack.tsx  # Card stack orchestrator\nâ”‚   â”‚   â”‚   â”œâ”€â”€ JobCard.tsx     # Individual card UI\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx   # âœ• â¤ â­ buttons\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SkeletonCard.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ CelebrationOverlay.tsx\nâ”‚   â”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ useSwipeQueue.ts   # Queue management + preloading\nâ”‚   â”‚   â”‚   â””â”€â”€ useDragCard.ts     # Drag gesture state\nâ”‚   â”‚   â”œâ”€â”€ store/\nâ”‚   â”‚   â”‚   â””â”€â”€ swipeStore.ts   # Zustand store\nâ”‚   â”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â”‚   â””â”€â”€ api.ts          # BFF client (fetch wrappers)\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â”œâ”€â”€ next.config.ts\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ api/                    # Next.js API routes (BFF)\nâ”‚       â”œâ”€â”€ app/\nâ”‚       â”‚   â””â”€â”€ api/\nâ”‚       â”‚       â””â”€â”€ opportunities/\nâ”‚       â”‚           â””â”€â”€ route.ts   # POST /api/opportunities\nâ”‚       â”œâ”€â”€ lib/\nâ”‚       â”‚   â””â”€â”€ torre.ts           # Torre API client (server-side)\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â”œâ”€â”€ next.config.ts\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ packages/\nâ”‚   â”œâ”€â”€ types/                  # Shared TypeScript types\nâ”‚   â”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ opportunity.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ torre-client/           # Torre API HTTP client (reusable)\nâ”‚       â”œâ”€â”€ src/\nâ”‚       â”‚   â”œâ”€â”€ client.ts\nâ”‚       â”‚   â”œâ”€â”€ types.ts        # (re-exported from @torre-swipe/types)\nâ”‚       â”‚   â””â”€â”€ index.ts\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ package.json                # Root workspace config\nâ”œâ”€â”€ pnpm-workspace.yaml\nâ”œâ”€â”€ turbo.json\nâ””â”€â”€ tsconfig.base.json\n```\n\n### 6.2 Package Naming Convention\n\nAll internal packages use the `@torre-swipe/` scope:\n- `@torre-swipe/types`\n- `@torre-swipe/torre-client`\n\n### 6.3 Root `package.json`\n\n```json\n{\n  \"name\": \"torre-swipe\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"turbo dev\",\n    \"build\": \"turbo build\",\n    \"test\": \"turbo test\",\n    \"lint\": \"turbo lint\",\n    \"type-check\": \"turbo type-check\"\n  },\n  \"devDependencies\": {\n    \"turbo\": \"^2.0.0\",\n    \"typescript\": \"^5.4.0\"\n  }\n}\n```\n\n### 6.4 `pnpm-workspace.yaml`\n\n```yaml\npackages:\n  - \"apps/*\"\n  - \"packages/*\"\n```\n\n### 6.5 `turbo.json`\n\n```json\n{\n  \"$schema\": \"https://turbo.build/schema.json\",\n  \"tasks\": {\n    \"build\": {\n      \"dependsOn\": [\"^build\"],\n      \"outputs\": [\".next/**\", \"dist/**\"]\n    },\n    \"dev\": {\n      \"cache\": false,\n      \"persistent\": true\n    },\n    \"test\": {\n      \"dependsOn\": [\"^build\"]\n    },\n    \"lint\": {},\n    \"type-check\": {\n      \"dependsOn\": [\"^build\"]\n    }\n  }\n}\n```\n\n---\n\n## 7. State Management\n\n### 7.1 Zustand Store (`swipeStore.ts`)\n\n```typescript\ntype SwipeAction = \"like\" | \"pass\" | \"super\";\n\ntype SwipeStore = {\n  // Queue\n  queue: Opportunity[];          // Cards ready to display (index 0 = top)\n  seenIds: Set<string>;          // All IDs ever shown (for dedup)\n  isFetching: boolean;\n  fetchError: string | null;\n\n  // Undo\n  undoCard: Opportunity | null;  // Last swiped card (for 1-level undo)\n  undoAction: SwipeAction | null;\n\n  // UI state\n  isAnimating: boolean;          // True while exit animation runs\n  isCelebrating: boolean;        // Super like celebration overlay\n\n  // Actions\n  addCards: (cards: Opportunity[]) => void;\n  swipe: (action: SwipeAction) => void;\n  undo: () => void;\n  setFetching: (v: boolean) => void;\n  setFetchError: (msg: string | null) => void;\n  setAnimating: (v: boolean) => void;\n  setCelebrating: (v: boolean) => void;\n};\n```\n\n### 7.2 Persistence â€” Storage Strategy\n\nPersistence is abstracted behind a `StorageStrategy` interface so the underlying storage mechanism (localStorage, a remote database, etc.) can be swapped without touching the store or queue logic.\n\n```typescript\n// packages/types/src/storage.ts\n\nexport interface StorageStrategy {\n  /** Load the set of already-seen opportunity IDs. */\n  loadSeenIds(): Promise<Set<string>>;\n  /** Persist the updated set of seen IDs. */\n  saveSeenIds(ids: Set<string>): Promise<void>;\n}\n```\n\n**Provided implementation â€” `LocalStorageStrategy`:**\n\n```typescript\n// packages/torre-client/src/storage/LocalStorageStrategy.ts\n\nconst KEY = \"torre_seen_ids\";\nconst MAX_ENTRIES = 500;\n\nexport class LocalStorageStrategy implements StorageStrategy {\n  async loadSeenIds(): Promise<Set<string>> {\n    const raw = localStorage.getItem(KEY);\n    return raw ? new Set<string>(JSON.parse(raw)) : new Set<string>();\n  }\n\n  async saveSeenIds(ids: Set<string>): Promise<void> {\n    let entries = [...ids];\n    // Cap at MAX_ENTRIES, dropping the oldest (head of the array)\n    if (entries.length > MAX_ENTRIES) {\n      entries = entries.slice(entries.length - MAX_ENTRIES);\n    }\n    localStorage.setItem(KEY, JSON.stringify(entries));\n  }\n}\n```\n\n**Wiring the strategy into the store:**\n\nThe `StorageStrategy` instance is injected at app bootstrap and passed to the Zustand store initializer. This keeps the store agnostic about _how_ data is saved.\n\n```typescript\n// apps/web/app/page.tsx (bootstrap)\nimport { LocalStorageStrategy } from \"@torre-swipe/torre-client\";\nimport { initSwipeStore } from \"../store/swipeStore\";\n\nconst storage = new LocalStorageStrategy();\ninitSwipeStore(storage); // loads seenIds asynchronously before first render\n```\n\n```typescript\n// apps/web/store/swipeStore.ts (excerpt)\ntype SwipeStore = {\n  // ...existing fields...\n  storage: StorageStrategy;\n};\n\nexport function initSwipeStore(storage: StorageStrategy) {\n  storage.loadSeenIds().then(ids => {\n    useSwipeStore.setState({ seenIds: ids, storage });\n  });\n}\n\n// Inside the `swipe` action â€” persist after every swipe:\nswipe: (action) => {\n  set(state => {\n    const newSeenIds = new Set(state.seenIds).add(state.queue[0].id);\n    state.storage.saveSeenIds(newSeenIds); // fire-and-forget\n    return { /* updated queue, seenIds, etc. */ };\n  });\n}\n```\n\n> **Out of scope:** Implementing additional strategies (e.g., a REST/database-backed strategy) is explicitly deferred. The interface above is the extension point.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.\n\n### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)\n\n```typescript\nexport function useSwipeQueue() {\n  const { queue, seenIds, isFetching, addCards, setFetching } = useSwipeStore();\n\n  // Trigger refill when queue is low\n  useEffect(() => {\n    if (queue.length < REFILL_THRESHOLD && !isFetching) {\n      fetchMore();\n    }\n  }, [queue.length]);\n\n  async function fetchMore() {\n    setFetching(true);\n    try {\n      const data = await fetchOpportunities({ size: REFILL_SIZE });\n      const fresh = data.results.filter(r => !seenIds.has(r.id));\n      addCards(fresh);\n      preloadImages(fresh);\n    } finally {\n      setFetching(false);\n    }\n  }\n\n  return { fetchMore };\n}\n```\n\n---\n\n## 8. Tech Stack\n\n| Layer | Technology | Version | Rationale |\n|---|---|---|---|\n| **Monorepo** | Turborepo | ^2.0 | Fast incremental builds, task graph |\n| **Package manager** | pnpm | ^9.0 | Workspace support, disk efficiency |\n| **Language** | TypeScript | ^5.4 | Strict mode throughout |\n| **Frontend framework** | Next.js (App Router) | ^14.x | SSR/SSG optional, great DX |\n| **Styling** | Tailwind CSS | ^3.4 | Utility-first, no runtime |\n| **Animation / gestures** | Framer Motion | ^11.x | Spring physics, drag gesture built-in |\n| **State management** | Zustand | ^4.x | Minimal boilerplate, localStorage easy |\n| **BFF** | Next.js API Routes | (same as frontend or separate app) | Proxies Torre API, hides CORS |\n| **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |\n| **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |\n| **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |\n| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |\n| **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |\n| **Formatting** | Prettier | ^3.x | Opinionated, zero config |\n\n### 8.1 Tailwind Configuration\n\n```javascript\n// tailwind.config.ts (apps/web)\nexport default {\n  content: [\"./app/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\"],\n  theme: {\n    extend: {\n      colors: {\n        like: \"#4CAF50\",\n        pass: \"#F44336\",\n        super: \"#2196F3\",\n        \"super-star\": \"#FFC107\",\n      },\n      borderRadius: {\n        card: \"16px\",\n      },\n    },\n  },\n};\n```\n\n### 8.2 Framer Motion Drag Setup\n\nThe top card uses Framer Motion's `drag` prop. Only the top card is draggable; back cards are static.\n\n```typescript\n<motion.div\n  drag\n  dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n  dragElastic={0.9}\n  onDragEnd={handleDragEnd}\n  animate={controls}\n  style={{ x, y, rotate }}\n>\n  <JobCard job={currentJob} />\n  <SwipeOverlay x={x} y={y} />\n</motion.div>\n```\n\n---\n\n## 9. Test Requirements\n\n### 9.1 Backend (`apps/api`) â€” Target: ~100% coverage\n\nEvery line of BFF code must be covered by unit tests. Use Vitest with c8 for coverage reporting.\n\n**Coverage targets:**\n- Statements: â‰¥ 98%\n- Branches: â‰¥ 95%\n- Functions: â‰¥ 98%\n- Lines: â‰¥ 98%\n\n**Test files:**\n\n```\napps/api/\nâ””â”€â”€ __tests__/\n    â”œâ”€â”€ route.test.ts          # POST /api/opportunities handler\n    â””â”€â”€ torre.test.ts          # Torre API client unit tests\n```\n\n**`torre.test.ts` must cover:**\n- Happy path: valid request returns parsed Opportunity[]\n- Torre API returns non-200: throws `TorreApiError`\n- Network failure: throws and propagates\n- Response body with missing optional fields (e.g., `compensation.visible = false`)\n- `seenIds` deduplication filter\n- Request body construction with all filter types (keywords, language, skill/role, status)\n- Query param serialization (currency, periodicity, lang, size, contextFeature)\n\n**`route.test.ts` must cover:**\n- Valid POST body â†’ 200 with opportunity list\n- Missing/invalid body â†’ 400\n- Torre client throws â†’ 502\n- CORS headers present in response\n- Empty results array handled gracefully\n\n**Test pattern (mock `fetch` globally):**\n\n```typescript\nimport { vi, describe, it, expect, beforeEach } from \"vitest\";\n\nvi.stubGlobal(\"fetch\", vi.fn());\n\ndescribe(\"TorreClient.searchOpportunities\", () => {\n  it(\"returns parsed results on success\", async () => {\n    (fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ total: 1, size: 1, results: [mockOpportunity] }),\n    });\n    const result = await client.searchOpportunities({ size: 1 });\n    expect(result.results).toHaveLength(1);\n  });\n});\n```\n\n### 9.2 Frontend (`apps/web`) â€” Unit + Integration\n\n**Component tests (`*.test.tsx`):**\n\n| Component | What to test |\n|---|---|\n| `JobCard` | Renders title, company name, salary (visible/hidden), skills (max 3 + overflow), remote badge, missing logo fallback |\n| `ActionBar` | All 3 buttons render; disabled state during animation; click handlers called |\n| `SwipeStack` | Shows skeleton when loading; shows empty state when queue empty; renders correct z-order |\n| `SkeletonCard` | Renders shimmer elements |\n| `EmptyState` | Shows refresh button; calls onRefresh on click |\n\n**Hook tests:**\n\n| Hook | What to test |\n|---|---|\n| `useSwipeQueue` | Triggers fetch on mount; triggers refill when queue < threshold; deduplicates by seenIds |\n\n**Store tests (`swipeStore.test.ts`):**\n- `addCards` appends without duplicates\n- `swipe(\"like\")` removes top card, sets `undoCard`, adds id to `seenIds`\n- `swipe(\"pass\")` same as like for queue management\n- `swipe(\"super\")` same + sets `isCelebrating = true`\n- `undo` restores top card from `undoCard`, clears `undoCard`\n- `undo` when `undoCard === null` is a no-op\n\n**Coverage targets (frontend):**\n- Statements: â‰¥ 80%\n- Branches: â‰¥ 75%\n\n### 9.3 E2E (`apps/web/e2e/`)\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |\n\n---\n\n## 10. API Contract (BFF)\n\nThe BFF (`apps/api`) exposes one endpoint to the frontend.\n\n### `POST /api/opportunities`\n\n**Request body:**\n\n```typescript\ntype OpportunitiesRequest = {\n  size?: number;           // default: 10, max: 20\n  keywords?: string;       // free text search term\n  language?: string;       // e.g. \"English\"\n  fluency?: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\";\n  currency?: string;       // e.g. \"USD\"\n  periodicity?: \"hourly\" | \"monthly\" | \"yearly\";\n};\n```\n\n**Example request:**\n\n```json\nPOST /api/opportunities\nContent-Type: application/json\n\n{\n  \"size\": 10,\n  \"currency\": \"USD\",\n  \"periodicity\": \"yearly\"\n}\n```\n\n**Response: 200 OK**\n\n```typescript\ntype OpportunitiesResponse = {\n  results: Opportunity[];  // from @torre-swipe/types\n  total: number;\n};\n```\n\n**Response: 400 Bad Request**\n\n```json\n{ \"error\": \"Invalid request body\", \"details\": \"...\" }\n```\n\n**Response: 502 Bad Gateway**\n\n```json\n{ \"error\": \"Upstream API error\", \"message\": \"...\" }\n```\n\n### BFF Implementation\n\nThe BFF handler:\n1. Validates the incoming request body (Zod schema recommended).\n2. Constructs a `SearchRequest` for Torre with `status: open` always included.\n3. Calls `TorreClient.searchOpportunities()` from `@torre-swipe/torre-client`.\n4. Returns the `results` array and `total` to the frontend.\n5. Does NOT filter by `seenIds` â€” that is the frontend's responsibility.\n\n**CORS:** Set `Access-Control-Allow-Origin: *` (or restrict to the web app origin in production).\n\n```typescript\n// apps/api/app/api/opportunities/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { TorreClient } from \"@torre-swipe/torre-client\";\nimport { opportunitiesSchema } from \"../../../lib/validation\";\n\nconst torre = new TorreClient(\"https://search.torre.co\");\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json().catch(() => null);\n  const parsed = opportunitiesSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\n  }\n\n  try {\n    const result = await torre.searchOpportunities(parsed.data);\n    return NextResponse.json(result);\n  } catch (err) {\n    return NextResponse.json(\n      { error: \"Upstream API error\", message: String(err) },\n      { status: 502 }\n    );\n  }\n}\n```\n\n---\n\n## 11. Performance Requirements\n\n| Metric | Target |\n|---|---|\n| First Contentful Paint (mobile 3G) | < 2s |\n| Skeleton shown before first card ready | â‰¤ 200ms after page load |\n| Card transition animation | 60 fps, no jank |\n| Time between swipe and next card appearing | < 100ms (card is already in DOM, just z-index change) |\n| Image load for top 3 cards | Pre-cached before card reaches top position |\n| Bundle size (web, gzipped JS) | < 150 KB first load |\n\n### 11.1 Animation Performance Rules\n\n- Use `transform` and `opacity` for all animations (no layout-triggering properties).\n- Apply `will-change: transform` to the top card only (remove after exit).\n- Back cards use CSS transitions (not JS-driven) â€” they only change when the queue changes.\n- Framer Motion's `useMotionValue` + `useTransform` for overlay opacity â€” avoids React re-renders during drag.\n\n### 11.2 Bundle Optimization\n\n- Dynamic import `framer-motion` only in the `SwipeStack` component.\n- No server-side rendering needed for the swipe UI â€” render client-side with `\"use client\"`.\n- Use Next.js Image component for company logos with `priority` on the top card's logo.\n\n---\n\n## 12. Accessibility\n\nThe swipe interface must be fully usable **without gestures**.\n\n### 12.1 Keyboard Support\n\n| Key | Action |\n|---|---|\n| `â†’` Arrow Right | Like (same as â¤ button) |\n| `â†` Arrow Left | Pass (same as âœ• button) |\n| `â†‘` Arrow Up | Super Like (same as â­ button) |\n| `Z` | Undo last swipe |\n| `Enter` / `Space` | Like (when card is focused) |\n\nAdd a global `keydown` event listener on the home page.\n\n### 12.2 ARIA Labels\n\n```html\n<button aria-label=\"Pass this job\">âœ•</button>\n<button aria-label=\"Like this job\">â¤</button>\n<button aria-label=\"Super like this job\">â­</button>\n<button aria-label=\"Undo last swipe\" aria-disabled=\"true\">â†©</button>\n```\n\nThe card itself:\n```html\n<article\n  role=\"article\"\n  aria-label=\"{job.objective} at {company.name}\"\n  tabIndex={0}\n>\n```\n\n### 12.3 Reduced Motion\n\nRespect `prefers-reduced-motion`. When active:\n- Disable drag animations (cards still respond to button taps).\n- Use instant transitions instead of spring animations.\n- Disable celebration overlay animation (show static text instead).\n\n```typescript\nconst prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\nconst springConfig = prefersReducedMotion\n  ? { duration: 0 }\n  : { type: \"spring\", stiffness: 400, damping: 30 };\n```\n\n### 12.4 Touch Target Sizes\n\nAll interactive elements meet the WCAG 2.5.5 AAA minimum of **44Ã—44px** touch target size.\n\n- Action buttons: 56px and 64px diameter âœ“\n- Undo button: minimum 44Ã—44px âœ“\n- Skill chips: not interactive, no requirement\n\n---\n\n## Appendix A â€” Sample API Call\n\n```bash\ncurl -X POST \"https://search.torre.co/opportunities/_search?currency=USD&periodicity=yearly&lang=en&size=10&contextFeature=job_feed\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"and\": [\n      { \"status\": { \"code\": \"open\" } }\n    ]\n  }'\n```\n\n## Appendix B â€” Key File Summaries\n\n| File | Purpose |\n|---|---|\n| `packages/types/src/opportunity.ts` | All shared TypeScript types (Opportunity, Compensation, Skill, etc.) |\n| `packages/torre-client/src/client.ts` | `TorreClient` class with `searchOpportunities()` method |\n| `apps/api/app/api/opportunities/route.ts` | BFF route handler (validates input, calls TorreClient, returns JSON) |\n| `apps/web/store/swipeStore.ts` | Zustand store (queue, undo, celebration state) |\n| `apps/web/hooks/useSwipeQueue.ts` | Preloading logic, refill triggering |\n| `apps/web/hooks/useDragCard.ts` | Framer Motion drag state, threshold detection |\n| `apps/web/components/SwipeStack.tsx` | Renders top 3 cards with correct z-index/transforms |\n| `apps/web/components/JobCard.tsx` | Card UI (logo, title, salary, skills, tagline) |\n| `apps/web/components/ActionBar.tsx` | âœ• â¤ â­ buttons |\n| `apps/web/app/page.tsx` | Home page â€” composes all components, keyboard handler |\n\n## Appendix C â€” `@torre-swipe/torre-client` Interface\n\n```typescript\nexport class TorreClient {\n  constructor(private baseUrl: string) {}\n\n  async searchOpportunities(params: {\n    size?: number;\n    currency?: string;\n    periodicity?: string;\n    lang?: string;\n    contextFeature?: string;\n    keywords?: string;\n    language?: string;\n    fluency?: string;\n  }): Promise<{ total: number; size: number; results: Opportunity[] }>;\n}\n\nexport class TorreApiError extends Error {\n  constructor(\n    public status: number,\n    public body: string\n  ) {\n    super(`Torre API error ${status}: ${body}`);\n  }\n}\n```\n","structuredPatch":[{"oldStart":863,"oldLines":8,"newStart":863,"newLines":10,"lines":[" - Statements: â‰¥ 80%"," - Branches: â‰¥ 75%"," ","-### 9.3 E2E (`apps/web/e2e/`)","+### 9.3 E2E â€” Future Work"," ","+> **Status: Out of scope for v1.** E2E tests are planned but deferred. The scenarios below document the intended coverage once E2E is prioritised.","+"," Use Playwright at mobile viewport (375Ã—812, iPhone 13)."," "," | Test | Scenario |"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"171affe6-afaa-4b97-ab1f-c4f42d0ffe8c"}
{"parentUuid":"f512d75e-7c64-4118-859a-ae598bce6bf8","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01KepwysXSgeJP9Q4Zrxz3kC","type":"message","role":"assistant","content":[{"type":"text","text":"Now also update the tech stack table to mark Playwright as future:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":638,"cache_read_input_tokens":43539,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":638},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYX5tP5sWbobym69VPMSJ","type":"assistant","uuid":"1292aee5-01b9-4c54-8a7d-96f4e789e383","timestamp":"2026-02-26T17:36:10.078Z"}
{"parentUuid":"1292aee5-01b9-4c54-8a7d-96f4e789e383","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01KepwysXSgeJP9Q4Zrxz3kC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0193UpRqYFcYaFYEgNf7ssjA","name":"Edit","input":{"replace_all":false,"file_path":"/Users/agurodriguez/Code/torre-ca/SPEC.md","old_string":"| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |","new_string":"| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport â€” **future work** |"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":638,"cache_read_input_tokens":43539,"output_tokens":175,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":638,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5tP5sWbobym69VPMSJ","type":"assistant","uuid":"91fb532b-95f3-4ce6-b98d-71007925b8ca","timestamp":"2026-02-26T17:36:11.688Z"}
{"parentUuid":"91fb532b-95f3-4ce6-b98d-71007925b8ca","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0193UpRqYFcYaFYEgNf7ssjA","type":"tool_result","content":"The file /Users/agurodriguez/Code/torre-ca/SPEC.md has been updated successfully."}]},"uuid":"c8a8d513-c80c-4e51-a0ef-aa63c09b7291","timestamp":"2026-02-26T17:36:11.703Z","toolUseResult":{"filePath":"/Users/agurodriguez/Code/torre-ca/SPEC.md","oldString":"| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |","newString":"| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport â€” **future work** |","originalFile":"# Torre Swipe â€” Product & Technical Specification\n\n> Hand this document to an LLM and say **\"build this\"** to get a complete, production-ready implementation.\n\n---\n\n## Table of Contents\n\n1. [Product Overview](#1-product-overview)\n2. [Core User Flow](#2-core-user-flow)\n3. [Home Screen Specification](#3-home-screen-specification)\n4. [Background Preloading Strategy](#4-background-preloading-strategy)\n5. [Torre API Integration](#5-torre-api-integration)\n6. [Monorepo Architecture](#6-monorepo-architecture)\n7. [State Management](#7-state-management)\n8. [Tech Stack](#8-tech-stack)\n9. [Test Requirements](#9-test-requirements)\n10. [API Contract (BFF)](#10-api-contract-bff)\n11. [Performance Requirements](#11-performance-requirements)\n12. [Accessibility](#12-accessibility)\n\n---\n\n## 1. Product Overview\n\n**Torre Swipe** is a mobile-first web application that lets job seekers discover Torre.ai job opportunities through a Tinder-style swipe interface. Users swipe right to like a job, left to pass, and up to super-like. Liked and super-liked jobs open the external application URL in a new tab.\n\n**Primary user:** A job seeker on a mobile browser who wants a fast, low-friction way to browse and shortlist job opportunities.\n\n**Why it works:** Traditional job boards require deliberate search queries. Torre Swipe surfaces opportunities serendipitously, making job discovery feel effortless and even fun. The swipe mechanic creates a lightweight commitment signal â€” a flick of the thumb â€” that lowers the psychological cost of engaging with each posting.\n\n**Non-goals (out of scope):**\n- User accounts or authentication\n- Persistent match history beyond `localStorage`\n- Full application flow within the app (redirects to external URLs)\n- Employer-facing features\n\n---\n\n## 2. Core User Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  1. User opens app (mobile browser)                 â”‚\nâ”‚     â†’ Skeleton loading cards appear instantly       â”‚\nâ”‚     â†’ First batch of jobs fetched from BFF          â”‚\nâ”‚                                                     â”‚\nâ”‚  2. Swipe loop (repeated until empty state)         â”‚\nâ”‚     a. Top card is the current job                  â”‚\nâ”‚     b. User swipes or taps a button:                â”‚\nâ”‚        â€¢ Right / â¤  â†’ LIKE  (opens ext. URL)       â”‚\nâ”‚        â€¢ Left  / âœ•  â†’ PASS  (discard)              â”‚\nâ”‚        â€¢ Up    / â­ â†’ SUPER LIKE (opens ext. URL)  â”‚\nâ”‚     c. Card animates off screen                     â”‚\nâ”‚     d. Next card slides up to become top            â”‚\nâ”‚     e. Preloader ensures next cards are ready       â”‚\nâ”‚                                                     â”‚\nâ”‚  3. Undo                                            â”‚\nâ”‚     â†’ One-level undo brings last swiped card back  â”‚\nâ”‚                                                     â”‚\nâ”‚  4. Empty state                                     â”‚\nâ”‚     â†’ \"You've seen all jobs!\" message + Refresh CTA â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Swipe Actions Detail\n\n| Action | Gesture | Button | Effect |\n|--------|---------|--------|--------|\n| LIKE   | Swipe right | â¤ (heart) | Opens `externalApplicationUrl` in new tab; card exits right |\n| PASS   | Swipe left  | âœ• (cross) | Discards; card exits left |\n| SUPER LIKE | Swipe up | â­ (star) | Opens `externalApplicationUrl` in new tab; card exits upward; shows celebration overlay |\n\n---\n\n## 3. Home Screen Specification\n\nThe home screen is the **only screen**. There is no navigation, no search page, no profile page.\n\n### 3.1 Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Torre Swipe          [undo â†©]    â”‚  â† Header (48px)\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                    â”‚\nâ”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚\nâ”‚    â”Œâ”€â”¤   Card (top)     â”œâ”€â”        â”‚\nâ”‚  â”Œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”      â”‚\nâ”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â† Card stack area\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜     â”‚    (fills remaining height)\nâ”‚                                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚      [âœ•]        [â¤]       [â­]    â”‚  â† Action buttons (80px)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3.2 Card Anatomy\n\nEach job card is a rounded rectangle (border-radius: 16px) with a white background and a subtle drop shadow. Content from top to bottom:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [Company Logo 56Ã—56]              â”‚  â† rounded, 4px shadow\nâ”‚  Company Name            [Remote]  â”‚  â† body-sm, gray-500 | badge\nâ”‚                                    â”‚\nâ”‚  Job Title (2 lines max)           â”‚  â† heading-lg, semibold\nâ”‚                                    â”‚\nâ”‚  ğŸ’° $164k â€“ $246k / year          â”‚  â† compensation (if visible)\nâ”‚  ğŸ“ United States Â· Remote        â”‚  â† location + remote badge\nâ”‚  ğŸ• Full-time                     â”‚  â† commitment\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  Tagline text (3 lines max,        â”‚  â† body-sm, gray-600\nâ”‚  ellipsized)                       â”‚\nâ”‚                                    â”‚\nâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚\nâ”‚                                    â”‚\nâ”‚  [Figma] [React.js] [CSS] +4      â”‚  â† skill chips (max 3 shown)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Card data mapping:**\n\n| UI element | API field | Fallback |\n|---|---|---|\n| Company logo | `organizations[0].picture` | Generic building icon |\n| Company name | `organizations[0].name` | \"Unknown Company\" |\n| Job title | `objective` | â€” |\n| Salary | `compensation.data` (if `visible: true`) | \"Salary not disclosed\" |\n| Location | `locations[]` joined with `, ` | \"Location not specified\" |\n| Remote badge | `remote === true` | hidden |\n| Commitment | `commitment` | hidden |\n| Tagline | `tagline` | hidden |\n| Skills | `skills[].name` (first 3) | hidden if empty |\n| Overflow | `skills.length - 3` shown as `+N` | hidden |\n\n**Salary formatting:**\n\n- If `compensation.visible === false`: show \"Salary not disclosed\"\n- If `code === \"range\"`: `$${formatK(minAmount)} â€“ $${formatK(maxAmount)} / ${periodicity}`\n- If `code === \"fixed\"`: `$${formatK(minAmount)} / ${periodicity}`\n- `formatK`: amounts â‰¥ 1000 shown as `Xk` (e.g., `164000` â†’ `$164k`)\n\n**Skill chip colors:** Use a deterministic color from a pastel palette based on skill name hash (so the same skill always gets the same color).\n\n### 3.3 Card Stack Visual\n\nAlways render exactly **3 cards** (or fewer if fewer remain). Cards are layered with CSS `z-index`. The back cards are purely decorative â€” they show the card background/shadow only, not full content.\n\n| Position | z-index | Transform | Opacity |\n|---|---|---|---|\n| Top (active) | 30 | `scale(1)` `translateY(0)` | 1.0 |\n| Middle | 20 | `scale(0.97)` `translateY(10px)` | 1.0 |\n| Back | 10 | `scale(0.94)` `translateY(20px)` | 1.0 |\n\nApply transforms via CSS `transform` (not layout properties) for GPU compositing.\n\n### 3.4 Swipe Gesture & Overlay Stamps\n\n**Drag behavior:**\n- Card follows the pointer/touch position (CSS `transform: translate(x, y) rotate(Î¸)`).\n- Rotation: `Î¸ = x * 0.08` (degrees), clamped to Â±20Â°.\n- Overlay stamp opacity: `Math.min(Math.abs(x) / 80, 1)` for horizontal, `Math.min(-y / 80, 1)` for upward.\n\n**Overlay stamps (shown while dragging):**\n\n| Direction | Text | Color | Position |\n|---|---|---|---|\n| Right | **LIKE** | `#4CAF50` (green) | top-left of card, rotated -20Â° |\n| Left | **NOPE** | `#F44336` (red) | top-right of card, rotated 20Â° |\n| Up | **SUPER** | `#2196F3` (blue) | center of card |\n\nStamps use a bordered label style: 3px solid border, uppercase, bold, 28px font.\n\n**Throw threshold:** If the user releases the card with `|x| > 100px` or `y < -100px`, animate the card off screen. Otherwise spring back to center.\n\n**Exit animations (spring physics):**\n- Right exit: `x` â†’ `window.innerWidth + 300`, slight upward arc\n- Left exit: `x` â†’ `-(window.innerWidth + 300)`, slight upward arc\n- Up exit: `y` â†’ `-(window.innerHeight + 300)`\n- Spring config: `{ stiffness: 400, damping: 30 }` (Framer Motion defaults)\n\n### 3.5 Action Buttons\n\nThree circular buttons centered horizontally in the action bar:\n\n```\n[âœ• 56px red/pink]   [â¤ 64px green]   [â­ 56px blue/gold]\n```\n\n- âœ• (Pass): diameter 56px, border 2px `#F44336`, icon `#F44336`\n- â¤ (Like): diameter 64px, bg `#4CAF50`, icon white â€” slightly larger as primary CTA\n- â­ (Super): diameter 56px, border 2px `#2196F3`, icon `#FFC107` (gold star)\n\nTapping a button triggers the same exit animation as a full swipe gesture. Buttons are disabled (opacity 0.4, pointer-events none) during a card exit animation.\n\n### 3.6 Undo Button\n\nLocated in the top-right of the header. Shows a back-arrow icon (â†©).\n\n- Enabled only if there is a previous card in the undo stack (max depth: 1 â€” only the most recent swipe can be undone).\n- Tapping it brings the last card back to the top of the stack with a reverse spring animation (card flies in from the direction it exited).\n- After undo, the button becomes disabled again until the next swipe.\n\n### 3.7 Super Like Celebration\n\nWhen a super like fires (gesture or button):\n1. Card exits upward.\n2. A full-screen overlay fades in (semi-transparent dark bg).\n3. Center: animated star burst (CSS keyframes) with text **\"Super Like! ğŸŒŸ\"**.\n4. Auto-dismisses after 1.5s, or user can tap anywhere to dismiss early.\n\n### 3.8 Loading Skeleton\n\nShown in place of the card stack while the first fetch is in flight.\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [â–‘â–‘â–‘â–‘ 56Ã—56 circle]               â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘               â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚\nâ”‚                                    â”‚\nâ”‚  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nSkeleton elements use a shimmer animation (gradient sweep left-to-right, 1.5s infinite).\n\n### 3.9 Empty State\n\nWhen the card queue is exhausted:\n\n```\n        ğŸ‰\n\n   You've seen all jobs!\n\n   Check back later or broaden\n   your search.\n\n   [  Refresh  ]\n```\n\n\"Refresh\" re-triggers the API fetch (with a fresh random offset/seed so different results may appear).\n\n---\n\n## 4. Background Preloading Strategy\n\nThe app must **never show a loading spinner** after the initial skeleton load. Achieve this by maintaining a buffer of pre-fetched cards.\n\n### 4.1 Queue Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  DISPLAY QUEUE (cards ready to show)                     â”‚\nâ”‚  [card_1] [card_2] [card_3] [card_4] [card_5] ...       â”‚\nâ”‚      â†‘ top card shown                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â†“ fetch triggered when size < REFILL_THRESHOLD\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FETCH IN FLIGHT (background, non-blocking)              â”‚\nâ”‚  next batch of 10 cards from BFF                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Constants:**\n\n| Constant | Value | Meaning |\n|---|---|---|\n| `INITIAL_FETCH_SIZE` | 20 | Cards fetched on first load |\n| `REFILL_SIZE` | 10 | Cards fetched per refill |\n| `REFILL_THRESHOLD` | 5 | Trigger refill when queue drops below this |\n| `MAX_QUEUE_SIZE` | 50 | Cap to avoid unbounded memory |\n\n### 4.2 Deduplication\n\nTrack all seen `id` values in a `Set<string>` (persisted in `localStorage` under `torre_seen_ids`). When appending new cards from a fetch, filter out any whose `id` is already in the seen set. Add swiped card IDs to the set immediately on swipe (before the exit animation completes).\n\n### 4.3 Image Preloading\n\nAfter cards are added to the queue, preload company logo images for the next 5 cards using `new Image()` instances so images are in browser cache when cards render.\n\n```typescript\nfunction preloadImages(cards: Opportunity[], count = 5) {\n  cards.slice(0, count).forEach(card => {\n    const url = card.organizations[0]?.picture;\n    if (url) {\n      const img = new Image();\n      img.src = url;\n    }\n  });\n}\n```\n\n### 4.4 Fetch Offset Tracking\n\nEach search request uses a random `offset` or relies on Torre's pagination. Since the Torre API does not expose a traditional `page` or `offset` param, achieve variety by rotating through different keyword search terms or using an empty keyword search with the `contextFeature=job_feed` param. Track which batches have been fetched to avoid re-fetching the same page.\n\n---\n\n## 5. Torre API Integration\n\n### 5.1 Upstream API Details\n\n**Base URL:** `https://search.torre.co`\n\n**Endpoint:** `POST /opportunities/_search`\n\n**Query Parameters:**\n\n| Param | Type | Example | Notes |\n|---|---|---|---|\n| `currency` | string | `\"USD\"` | Normalizes compensation display |\n| `periodicity` | string | `\"yearly\"` | `hourly` \\| `monthly` \\| `yearly` |\n| `lang` | string | `\"en\"` | ISO 639-1 language code |\n| `size` | integer | `10` | Results per page (default 10) |\n| `contextFeature` | string | `\"job_feed\"` | Tuning hint for the ranker |\n\n**Request Body:**\n\n```json\n{\n  \"and\": [\n    { \"status\": { \"code\": \"open\" } }\n  ]\n}\n```\n\nTo search by keyword, add:\n```json\n{ \"keywords\": { \"term\": \"Designer\", \"locale\": \"en\" } }\n```\n\nTo filter by language:\n```json\n{ \"language\": { \"term\": \"English\", \"fluency\": \"fully-fluent\" } }\n```\n\nTo filter by skill:\n```json\n{ \"skill/role\": { \"text\": \"React.js\", \"proficiency\": \"proficient\" } }\n```\n\n**Filter operator schema:**\n\n```typescript\ntype SearchFilter =\n  | { keywords: { term: string; locale?: string } }\n  | { language: { term: string; fluency: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\" } }\n  | { \"skill/role\": { text: string; proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\" } }\n  | { status: { code: \"open\" | \"closed\" | \"paused\" } };\n\ntype SearchRequest = {\n  and?: SearchFilter[];\n  or?: SearchFilter[];\n  not?: SearchFilter[];\n};\n```\n\n### 5.2 Response Shape\n\n```typescript\ntype SearchResponse = {\n  total: number;\n  size: number;\n  results: Opportunity[];\n};\n\ntype Opportunity = {\n  id: string;\n  objective: string;\n  slug: string;\n  tagline: string;\n  theme: string;\n  type: \"full-time-employment\" | \"part-time-employment\" | \"contractor\" | \"freelance\";\n  opportunity: \"employee\" | \"freelancer\";\n  organizations: Organization[];\n  locations: string[];\n  timezones: string[] | null;\n  remote: boolean;\n  external: boolean;\n  deadline: string | null;\n  created: string;\n  status: \"open\" | \"closed\" | \"paused\";\n  commitment: \"full-time\" | \"part-time\";\n  externalApplicationUrl: string | null;\n  compensation: Compensation;\n  skills: Skill[];\n  place: Place;\n};\n\ntype Organization = {\n  id: number;\n  hashedId: string;\n  name: string;\n  status: string;\n  size: number;\n  publicId: string;\n  picture: string;\n  theme: string;\n};\n\ntype Compensation = {\n  data: {\n    code: \"range\" | \"fixed\";\n    currency: string;\n    minAmount: number;\n    minHourlyUSD: number;\n    maxAmount: number;\n    maxHourlyUSD: number;\n    periodicity: \"hourly\" | \"monthly\" | \"yearly\";\n    negotiable: boolean;\n    conversionRateUSD: number;\n  };\n  visible: boolean;\n  additionalCompensationDetails: Record<string, unknown>;\n};\n\ntype Skill = {\n  name: string;\n  experience: \"potential-to-develop\" | \"applying\" | \"leading\";\n  proficiency: \"no-experience-required\" | \"beginner\" | \"proficient\" | \"expert\";\n};\n\ntype Place = {\n  remote: boolean;\n  anywhere: boolean;\n  timezone: boolean;\n  locationType: \"remote_countries\" | \"anywhere\" | \"timezone\" | \"onsite\";\n  location: Array<{\n    id: string;\n    timezone: number;\n    countryCode: string | null;\n    latitude: number;\n    longitude: number;\n  }>;\n};\n```\n\n### 5.3 CORS Consideration\n\nThe Torre API is a third-party service. All requests **must** go through the BFF (`apps/api`) to avoid CORS issues and to keep the upstream API call server-side.\n\n---\n\n## 6. Monorepo Architecture\n\n### 6.1 Directory Structure\n\n```\ntorre-swipe/\nâ”œâ”€â”€ apps/\nâ”‚   â”œâ”€â”€ web/                    # Next.js 14 frontend (App Router)\nâ”‚   â”‚   â”œâ”€â”€ app/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # Home screen (swipe UI)\nâ”‚   â”‚   â”‚   â””â”€â”€ globals.css\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SwipeStack.tsx  # Card stack orchestrator\nâ”‚   â”‚   â”‚   â”œâ”€â”€ JobCard.tsx     # Individual card UI\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx   # âœ• â¤ â­ buttons\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SkeletonCard.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ CelebrationOverlay.tsx\nâ”‚   â”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ useSwipeQueue.ts   # Queue management + preloading\nâ”‚   â”‚   â”‚   â””â”€â”€ useDragCard.ts     # Drag gesture state\nâ”‚   â”‚   â”œâ”€â”€ store/\nâ”‚   â”‚   â”‚   â””â”€â”€ swipeStore.ts   # Zustand store\nâ”‚   â”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â”‚   â””â”€â”€ api.ts          # BFF client (fetch wrappers)\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â”œâ”€â”€ next.config.ts\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ api/                    # Next.js API routes (BFF)\nâ”‚       â”œâ”€â”€ app/\nâ”‚       â”‚   â””â”€â”€ api/\nâ”‚       â”‚       â””â”€â”€ opportunities/\nâ”‚       â”‚           â””â”€â”€ route.ts   # POST /api/opportunities\nâ”‚       â”œâ”€â”€ lib/\nâ”‚       â”‚   â””â”€â”€ torre.ts           # Torre API client (server-side)\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â”œâ”€â”€ next.config.ts\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ packages/\nâ”‚   â”œâ”€â”€ types/                  # Shared TypeScript types\nâ”‚   â”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ opportunity.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts\nâ”‚   â”‚   â”œâ”€â”€ package.json\nâ”‚   â”‚   â””â”€â”€ tsconfig.json\nâ”‚   â”‚\nâ”‚   â””â”€â”€ torre-client/           # Torre API HTTP client (reusable)\nâ”‚       â”œâ”€â”€ src/\nâ”‚       â”‚   â”œâ”€â”€ client.ts\nâ”‚       â”‚   â”œâ”€â”€ types.ts        # (re-exported from @torre-swipe/types)\nâ”‚       â”‚   â””â”€â”€ index.ts\nâ”‚       â”œâ”€â”€ package.json\nâ”‚       â””â”€â”€ tsconfig.json\nâ”‚\nâ”œâ”€â”€ package.json                # Root workspace config\nâ”œâ”€â”€ pnpm-workspace.yaml\nâ”œâ”€â”€ turbo.json\nâ””â”€â”€ tsconfig.base.json\n```\n\n### 6.2 Package Naming Convention\n\nAll internal packages use the `@torre-swipe/` scope:\n- `@torre-swipe/types`\n- `@torre-swipe/torre-client`\n\n### 6.3 Root `package.json`\n\n```json\n{\n  \"name\": \"torre-swipe\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"turbo dev\",\n    \"build\": \"turbo build\",\n    \"test\": \"turbo test\",\n    \"lint\": \"turbo lint\",\n    \"type-check\": \"turbo type-check\"\n  },\n  \"devDependencies\": {\n    \"turbo\": \"^2.0.0\",\n    \"typescript\": \"^5.4.0\"\n  }\n}\n```\n\n### 6.4 `pnpm-workspace.yaml`\n\n```yaml\npackages:\n  - \"apps/*\"\n  - \"packages/*\"\n```\n\n### 6.5 `turbo.json`\n\n```json\n{\n  \"$schema\": \"https://turbo.build/schema.json\",\n  \"tasks\": {\n    \"build\": {\n      \"dependsOn\": [\"^build\"],\n      \"outputs\": [\".next/**\", \"dist/**\"]\n    },\n    \"dev\": {\n      \"cache\": false,\n      \"persistent\": true\n    },\n    \"test\": {\n      \"dependsOn\": [\"^build\"]\n    },\n    \"lint\": {},\n    \"type-check\": {\n      \"dependsOn\": [\"^build\"]\n    }\n  }\n}\n```\n\n---\n\n## 7. State Management\n\n### 7.1 Zustand Store (`swipeStore.ts`)\n\n```typescript\ntype SwipeAction = \"like\" | \"pass\" | \"super\";\n\ntype SwipeStore = {\n  // Queue\n  queue: Opportunity[];          // Cards ready to display (index 0 = top)\n  seenIds: Set<string>;          // All IDs ever shown (for dedup)\n  isFetching: boolean;\n  fetchError: string | null;\n\n  // Undo\n  undoCard: Opportunity | null;  // Last swiped card (for 1-level undo)\n  undoAction: SwipeAction | null;\n\n  // UI state\n  isAnimating: boolean;          // True while exit animation runs\n  isCelebrating: boolean;        // Super like celebration overlay\n\n  // Actions\n  addCards: (cards: Opportunity[]) => void;\n  swipe: (action: SwipeAction) => void;\n  undo: () => void;\n  setFetching: (v: boolean) => void;\n  setFetchError: (msg: string | null) => void;\n  setAnimating: (v: boolean) => void;\n  setCelebrating: (v: boolean) => void;\n};\n```\n\n### 7.2 Persistence â€” Storage Strategy\n\nPersistence is abstracted behind a `StorageStrategy` interface so the underlying storage mechanism (localStorage, a remote database, etc.) can be swapped without touching the store or queue logic.\n\n```typescript\n// packages/types/src/storage.ts\n\nexport interface StorageStrategy {\n  /** Load the set of already-seen opportunity IDs. */\n  loadSeenIds(): Promise<Set<string>>;\n  /** Persist the updated set of seen IDs. */\n  saveSeenIds(ids: Set<string>): Promise<void>;\n}\n```\n\n**Provided implementation â€” `LocalStorageStrategy`:**\n\n```typescript\n// packages/torre-client/src/storage/LocalStorageStrategy.ts\n\nconst KEY = \"torre_seen_ids\";\nconst MAX_ENTRIES = 500;\n\nexport class LocalStorageStrategy implements StorageStrategy {\n  async loadSeenIds(): Promise<Set<string>> {\n    const raw = localStorage.getItem(KEY);\n    return raw ? new Set<string>(JSON.parse(raw)) : new Set<string>();\n  }\n\n  async saveSeenIds(ids: Set<string>): Promise<void> {\n    let entries = [...ids];\n    // Cap at MAX_ENTRIES, dropping the oldest (head of the array)\n    if (entries.length > MAX_ENTRIES) {\n      entries = entries.slice(entries.length - MAX_ENTRIES);\n    }\n    localStorage.setItem(KEY, JSON.stringify(entries));\n  }\n}\n```\n\n**Wiring the strategy into the store:**\n\nThe `StorageStrategy` instance is injected at app bootstrap and passed to the Zustand store initializer. This keeps the store agnostic about _how_ data is saved.\n\n```typescript\n// apps/web/app/page.tsx (bootstrap)\nimport { LocalStorageStrategy } from \"@torre-swipe/torre-client\";\nimport { initSwipeStore } from \"../store/swipeStore\";\n\nconst storage = new LocalStorageStrategy();\ninitSwipeStore(storage); // loads seenIds asynchronously before first render\n```\n\n```typescript\n// apps/web/store/swipeStore.ts (excerpt)\ntype SwipeStore = {\n  // ...existing fields...\n  storage: StorageStrategy;\n};\n\nexport function initSwipeStore(storage: StorageStrategy) {\n  storage.loadSeenIds().then(ids => {\n    useSwipeStore.setState({ seenIds: ids, storage });\n  });\n}\n\n// Inside the `swipe` action â€” persist after every swipe:\nswipe: (action) => {\n  set(state => {\n    const newSeenIds = new Set(state.seenIds).add(state.queue[0].id);\n    state.storage.saveSeenIds(newSeenIds); // fire-and-forget\n    return { /* updated queue, seenIds, etc. */ };\n  });\n}\n```\n\n> **Out of scope:** Implementing additional strategies (e.g., a REST/database-backed strategy) is explicitly deferred. The interface above is the extension point.\n\nDo **not** persist the queue itself â€” always re-fetch on page load.\n\n### 7.3 Swipe Queue Hook (`useSwipeQueue.ts`)\n\n```typescript\nexport function useSwipeQueue() {\n  const { queue, seenIds, isFetching, addCards, setFetching } = useSwipeStore();\n\n  // Trigger refill when queue is low\n  useEffect(() => {\n    if (queue.length < REFILL_THRESHOLD && !isFetching) {\n      fetchMore();\n    }\n  }, [queue.length]);\n\n  async function fetchMore() {\n    setFetching(true);\n    try {\n      const data = await fetchOpportunities({ size: REFILL_SIZE });\n      const fresh = data.results.filter(r => !seenIds.has(r.id));\n      addCards(fresh);\n      preloadImages(fresh);\n    } finally {\n      setFetching(false);\n    }\n  }\n\n  return { fetchMore };\n}\n```\n\n---\n\n## 8. Tech Stack\n\n| Layer | Technology | Version | Rationale |\n|---|---|---|---|\n| **Monorepo** | Turborepo | ^2.0 | Fast incremental builds, task graph |\n| **Package manager** | pnpm | ^9.0 | Workspace support, disk efficiency |\n| **Language** | TypeScript | ^5.4 | Strict mode throughout |\n| **Frontend framework** | Next.js (App Router) | ^14.x | SSR/SSG optional, great DX |\n| **Styling** | Tailwind CSS | ^3.4 | Utility-first, no runtime |\n| **Animation / gestures** | Framer Motion | ^11.x | Spring physics, drag gesture built-in |\n| **State management** | Zustand | ^4.x | Minimal boilerplate, localStorage easy |\n| **BFF** | Next.js API Routes | (same as frontend or separate app) | Proxies Torre API, hides CORS |\n| **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |\n| **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |\n| **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |\n| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |\n| **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |\n| **Formatting** | Prettier | ^3.x | Opinionated, zero config |\n\n### 8.1 Tailwind Configuration\n\n```javascript\n// tailwind.config.ts (apps/web)\nexport default {\n  content: [\"./app/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\"],\n  theme: {\n    extend: {\n      colors: {\n        like: \"#4CAF50\",\n        pass: \"#F44336\",\n        super: \"#2196F3\",\n        \"super-star\": \"#FFC107\",\n      },\n      borderRadius: {\n        card: \"16px\",\n      },\n    },\n  },\n};\n```\n\n### 8.2 Framer Motion Drag Setup\n\nThe top card uses Framer Motion's `drag` prop. Only the top card is draggable; back cards are static.\n\n```typescript\n<motion.div\n  drag\n  dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n  dragElastic={0.9}\n  onDragEnd={handleDragEnd}\n  animate={controls}\n  style={{ x, y, rotate }}\n>\n  <JobCard job={currentJob} />\n  <SwipeOverlay x={x} y={y} />\n</motion.div>\n```\n\n---\n\n## 9. Test Requirements\n\n### 9.1 Backend (`apps/api`) â€” Target: ~100% coverage\n\nEvery line of BFF code must be covered by unit tests. Use Vitest with c8 for coverage reporting.\n\n**Coverage targets:**\n- Statements: â‰¥ 98%\n- Branches: â‰¥ 95%\n- Functions: â‰¥ 98%\n- Lines: â‰¥ 98%\n\n**Test files:**\n\n```\napps/api/\nâ””â”€â”€ __tests__/\n    â”œâ”€â”€ route.test.ts          # POST /api/opportunities handler\n    â””â”€â”€ torre.test.ts          # Torre API client unit tests\n```\n\n**`torre.test.ts` must cover:**\n- Happy path: valid request returns parsed Opportunity[]\n- Torre API returns non-200: throws `TorreApiError`\n- Network failure: throws and propagates\n- Response body with missing optional fields (e.g., `compensation.visible = false`)\n- `seenIds` deduplication filter\n- Request body construction with all filter types (keywords, language, skill/role, status)\n- Query param serialization (currency, periodicity, lang, size, contextFeature)\n\n**`route.test.ts` must cover:**\n- Valid POST body â†’ 200 with opportunity list\n- Missing/invalid body â†’ 400\n- Torre client throws â†’ 502\n- CORS headers present in response\n- Empty results array handled gracefully\n\n**Test pattern (mock `fetch` globally):**\n\n```typescript\nimport { vi, describe, it, expect, beforeEach } from \"vitest\";\n\nvi.stubGlobal(\"fetch\", vi.fn());\n\ndescribe(\"TorreClient.searchOpportunities\", () => {\n  it(\"returns parsed results on success\", async () => {\n    (fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ total: 1, size: 1, results: [mockOpportunity] }),\n    });\n    const result = await client.searchOpportunities({ size: 1 });\n    expect(result.results).toHaveLength(1);\n  });\n});\n```\n\n### 9.2 Frontend (`apps/web`) â€” Unit + Integration\n\n**Component tests (`*.test.tsx`):**\n\n| Component | What to test |\n|---|---|\n| `JobCard` | Renders title, company name, salary (visible/hidden), skills (max 3 + overflow), remote badge, missing logo fallback |\n| `ActionBar` | All 3 buttons render; disabled state during animation; click handlers called |\n| `SwipeStack` | Shows skeleton when loading; shows empty state when queue empty; renders correct z-order |\n| `SkeletonCard` | Renders shimmer elements |\n| `EmptyState` | Shows refresh button; calls onRefresh on click |\n\n**Hook tests:**\n\n| Hook | What to test |\n|---|---|\n| `useSwipeQueue` | Triggers fetch on mount; triggers refill when queue < threshold; deduplicates by seenIds |\n\n**Store tests (`swipeStore.test.ts`):**\n- `addCards` appends without duplicates\n- `swipe(\"like\")` removes top card, sets `undoCard`, adds id to `seenIds`\n- `swipe(\"pass\")` same as like for queue management\n- `swipe(\"super\")` same + sets `isCelebrating = true`\n- `undo` restores top card from `undoCard`, clears `undoCard`\n- `undo` when `undoCard === null` is a no-op\n\n**Coverage targets (frontend):**\n- Statements: â‰¥ 80%\n- Branches: â‰¥ 75%\n\n### 9.3 E2E â€” Future Work\n\n> **Status: Out of scope for v1.** E2E tests are planned but deferred. The scenarios below document the intended coverage once E2E is prioritised.\n\nUse Playwright at mobile viewport (375Ã—812, iPhone 13).\n\n| Test | Scenario |\n|---|---|\n| `swipe.spec.ts` | Mock BFF â†’ swipe right via drag â†’ card exits right |\n| `swipe.spec.ts` | Tap â¤ button â†’ card exits right |\n| `swipe.spec.ts` | Tap âœ• button â†’ card exits left |\n| `swipe.spec.ts` | Tap â­ button â†’ celebration overlay appears, auto-dismisses |\n| `swipe.spec.ts` | Swipe left then tap undo â†’ card reappears |\n| `empty.spec.ts` | Empty queue â†’ empty state shown â†’ tap Refresh â†’ fetch triggered |\n| `skeleton.spec.ts` | On load (slow network) â†’ skeletons shown |\n\n---\n\n## 10. API Contract (BFF)\n\nThe BFF (`apps/api`) exposes one endpoint to the frontend.\n\n### `POST /api/opportunities`\n\n**Request body:**\n\n```typescript\ntype OpportunitiesRequest = {\n  size?: number;           // default: 10, max: 20\n  keywords?: string;       // free text search term\n  language?: string;       // e.g. \"English\"\n  fluency?: \"basic\" | \"conversational\" | \"fully-fluent\" | \"native\" | \"fluent\";\n  currency?: string;       // e.g. \"USD\"\n  periodicity?: \"hourly\" | \"monthly\" | \"yearly\";\n};\n```\n\n**Example request:**\n\n```json\nPOST /api/opportunities\nContent-Type: application/json\n\n{\n  \"size\": 10,\n  \"currency\": \"USD\",\n  \"periodicity\": \"yearly\"\n}\n```\n\n**Response: 200 OK**\n\n```typescript\ntype OpportunitiesResponse = {\n  results: Opportunity[];  // from @torre-swipe/types\n  total: number;\n};\n```\n\n**Response: 400 Bad Request**\n\n```json\n{ \"error\": \"Invalid request body\", \"details\": \"...\" }\n```\n\n**Response: 502 Bad Gateway**\n\n```json\n{ \"error\": \"Upstream API error\", \"message\": \"...\" }\n```\n\n### BFF Implementation\n\nThe BFF handler:\n1. Validates the incoming request body (Zod schema recommended).\n2. Constructs a `SearchRequest` for Torre with `status: open` always included.\n3. Calls `TorreClient.searchOpportunities()` from `@torre-swipe/torre-client`.\n4. Returns the `results` array and `total` to the frontend.\n5. Does NOT filter by `seenIds` â€” that is the frontend's responsibility.\n\n**CORS:** Set `Access-Control-Allow-Origin: *` (or restrict to the web app origin in production).\n\n```typescript\n// apps/api/app/api/opportunities/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { TorreClient } from \"@torre-swipe/torre-client\";\nimport { opportunitiesSchema } from \"../../../lib/validation\";\n\nconst torre = new TorreClient(\"https://search.torre.co\");\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json().catch(() => null);\n  const parsed = opportunitiesSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\n  }\n\n  try {\n    const result = await torre.searchOpportunities(parsed.data);\n    return NextResponse.json(result);\n  } catch (err) {\n    return NextResponse.json(\n      { error: \"Upstream API error\", message: String(err) },\n      { status: 502 }\n    );\n  }\n}\n```\n\n---\n\n## 11. Performance Requirements\n\n| Metric | Target |\n|---|---|\n| First Contentful Paint (mobile 3G) | < 2s |\n| Skeleton shown before first card ready | â‰¤ 200ms after page load |\n| Card transition animation | 60 fps, no jank |\n| Time between swipe and next card appearing | < 100ms (card is already in DOM, just z-index change) |\n| Image load for top 3 cards | Pre-cached before card reaches top position |\n| Bundle size (web, gzipped JS) | < 150 KB first load |\n\n### 11.1 Animation Performance Rules\n\n- Use `transform` and `opacity` for all animations (no layout-triggering properties).\n- Apply `will-change: transform` to the top card only (remove after exit).\n- Back cards use CSS transitions (not JS-driven) â€” they only change when the queue changes.\n- Framer Motion's `useMotionValue` + `useTransform` for overlay opacity â€” avoids React re-renders during drag.\n\n### 11.2 Bundle Optimization\n\n- Dynamic import `framer-motion` only in the `SwipeStack` component.\n- No server-side rendering needed for the swipe UI â€” render client-side with `\"use client\"`.\n- Use Next.js Image component for company logos with `priority` on the top card's logo.\n\n---\n\n## 12. Accessibility\n\nThe swipe interface must be fully usable **without gestures**.\n\n### 12.1 Keyboard Support\n\n| Key | Action |\n|---|---|\n| `â†’` Arrow Right | Like (same as â¤ button) |\n| `â†` Arrow Left | Pass (same as âœ• button) |\n| `â†‘` Arrow Up | Super Like (same as â­ button) |\n| `Z` | Undo last swipe |\n| `Enter` / `Space` | Like (when card is focused) |\n\nAdd a global `keydown` event listener on the home page.\n\n### 12.2 ARIA Labels\n\n```html\n<button aria-label=\"Pass this job\">âœ•</button>\n<button aria-label=\"Like this job\">â¤</button>\n<button aria-label=\"Super like this job\">â­</button>\n<button aria-label=\"Undo last swipe\" aria-disabled=\"true\">â†©</button>\n```\n\nThe card itself:\n```html\n<article\n  role=\"article\"\n  aria-label=\"{job.objective} at {company.name}\"\n  tabIndex={0}\n>\n```\n\n### 12.3 Reduced Motion\n\nRespect `prefers-reduced-motion`. When active:\n- Disable drag animations (cards still respond to button taps).\n- Use instant transitions instead of spring animations.\n- Disable celebration overlay animation (show static text instead).\n\n```typescript\nconst prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\nconst springConfig = prefersReducedMotion\n  ? { duration: 0 }\n  : { type: \"spring\", stiffness: 400, damping: 30 };\n```\n\n### 12.4 Touch Target Sizes\n\nAll interactive elements meet the WCAG 2.5.5 AAA minimum of **44Ã—44px** touch target size.\n\n- Action buttons: 56px and 64px diameter âœ“\n- Undo button: minimum 44Ã—44px âœ“\n- Skill chips: not interactive, no requirement\n\n---\n\n## Appendix A â€” Sample API Call\n\n```bash\ncurl -X POST \"https://search.torre.co/opportunities/_search?currency=USD&periodicity=yearly&lang=en&size=10&contextFeature=job_feed\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"and\": [\n      { \"status\": { \"code\": \"open\" } }\n    ]\n  }'\n```\n\n## Appendix B â€” Key File Summaries\n\n| File | Purpose |\n|---|---|\n| `packages/types/src/opportunity.ts` | All shared TypeScript types (Opportunity, Compensation, Skill, etc.) |\n| `packages/torre-client/src/client.ts` | `TorreClient` class with `searchOpportunities()` method |\n| `apps/api/app/api/opportunities/route.ts` | BFF route handler (validates input, calls TorreClient, returns JSON) |\n| `apps/web/store/swipeStore.ts` | Zustand store (queue, undo, celebration state) |\n| `apps/web/hooks/useSwipeQueue.ts` | Preloading logic, refill triggering |\n| `apps/web/hooks/useDragCard.ts` | Framer Motion drag state, threshold detection |\n| `apps/web/components/SwipeStack.tsx` | Renders top 3 cards with correct z-index/transforms |\n| `apps/web/components/JobCard.tsx` | Card UI (logo, title, salary, skills, tagline) |\n| `apps/web/components/ActionBar.tsx` | âœ• â¤ â­ buttons |\n| `apps/web/app/page.tsx` | Home page â€” composes all components, keyboard handler |\n\n## Appendix C â€” `@torre-swipe/torre-client` Interface\n\n```typescript\nexport class TorreClient {\n  constructor(private baseUrl: string) {}\n\n  async searchOpportunities(params: {\n    size?: number;\n    currency?: string;\n    periodicity?: string;\n    lang?: string;\n    contextFeature?: string;\n    keywords?: string;\n    language?: string;\n    fluency?: string;\n  }): Promise<{ total: number; size: number; results: Opportunity[] }>;\n}\n\nexport class TorreApiError extends Error {\n  constructor(\n    public status: number,\n    public body: string\n  ) {\n    super(`Torre API error ${status}: ${body}`);\n  }\n}\n```\n","structuredPatch":[{"oldStart":731,"oldLines":7,"newStart":731,"newLines":7,"lines":[" | **HTTP client** | Native `fetch` | â€” | Built into Node 18+ and browsers |"," | **Testing (unit)** | Vitest | ^1.x | Fast, native ESM, c8 coverage |"," | **Testing (component)** | React Testing Library | ^14.x | Behavior-focused component tests |","-| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport |","+| **Testing (e2e)** | Playwright | ^1.x | Cross-browser, mobile viewport â€” **future work** |"," | **Linting** | ESLint + eslint-config-next | â€” | Consistent code style |"," | **Formatting** | Prettier | ^3.x | Opinionated, zero config |"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"91fb532b-95f3-4ce6-b98d-71007925b8ca"}
{"parentUuid":"c8a8d513-c80c-4e51-a0ef-aa63c09b7291","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01UTgQH9gkUSasaxxkk8x6E7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S8KyQ2GrxsXUuTDtuxqysL","name":"TodoWrite","input":{"todos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"completed","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"completed","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":229,"cache_read_input_tokens":44177,"output_tokens":139,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":229,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5turJ8rV3sKLJxsvzY","type":"assistant","uuid":"5d0c10c9-b737-4a39-a385-c2e91f84f1c3","timestamp":"2026-02-26T17:36:18.069Z"}
{"parentUuid":"5d0c10c9-b737-4a39-a385-c2e91f84f1c3","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S8KyQ2GrxsXUuTDtuxqysL","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"3271bac3-860f-4bb6-926c-61d20c89a4be","timestamp":"2026-02-26T17:36:18.081Z","toolUseResult":{"oldTodos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"completed","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"in_progress","activeForm":"Marking E2E testing as future work in SPEC.md"}],"newTodos":[{"content":"Add Storage Strategy pattern to persistence section in SPEC.md","status":"completed","activeForm":"Adding Storage Strategy pattern to persistence section in SPEC.md"},{"content":"Mark E2E testing as future work in SPEC.md","status":"completed","activeForm":"Marking E2E testing as future work in SPEC.md"}]},"sourceToolAssistantUUID":"5d0c10c9-b737-4a39-a385-c2e91f84f1c3"}
{"parentUuid":"3271bac3-860f-4bb6-926c-61d20c89a4be","isSidechain":false,"userType":"external","cwd":"/Users/agurodriguez/Code/torre-ca","sessionId":"ffb3ce9b-4e27-4cf1-889c-b7817ad140f3","version":"2.1.59","gitBranch":"HEAD","slug":"functional-soaring-sloth","message":{"model":"claude-sonnet-4-6","id":"msg_01BaPKRAPNUEz4Bh5cjjGHkJ","type":"message","role":"assistant","content":[{"type":"text","text":"Done. Here's a summary of what changed in [SPEC.md](SPEC.md):\n\n**Section 7.2 â€” Persistence (Strategy pattern):**\n- Introduced a `StorageStrategy` interface with `loadSeenIds()` / `saveSeenIds()` methods\n- `LocalStorageStrategy` is the only provided implementation (capped at 500 entries, as before)\n- The strategy is injected at bootstrap into the Zustand store, keeping the store storage-agnostic\n- Added a clear note that other strategies (e.g., database-backed) are out of scope\n\n**Section 9.3 & Tech Stack table â€” E2E:**\n- Section 9.3 is now headed \"E2E â€” Future Work\" with a status callout marking it out of scope for v1\n- The Playwright row in the tech stack table is annotated with \"future work\""}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":181,"cache_read_input_tokens":44406,"output_tokens":207,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":181,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYX5uKFTit8UgRTyamiVq","type":"assistant","uuid":"885e0505-9f10-4d14-8c30-9d0a1bd09570","timestamp":"2026-02-26T17:36:27.273Z"}
